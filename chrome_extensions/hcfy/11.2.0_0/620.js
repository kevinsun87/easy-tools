(globalThis.webpackChunkbrowser_extension=globalThis.webpackChunkbrowser_extension||[]).push([[620,544],{26964:(e,t,n)=>{"use strict";n.d(t,{B9:()=>a,OR:()=>i,xL:()=>l});var s=n(6839),r=n(24671),o=n(72431);const i=[r.ql,s.aN],a={[o.eA.WebSpeech]:r.u8,[o.eA.TencentRealtime]:s.Er},l={[o.eA.WebSpeech]:r.HO,[o.eA.TencentRealtime]:s.AH}},18861:(e,t,n)=>{"use strict";n.d(t,{A:()=>fn});n(69375);var s=n(14041),r=n(72531),o=n(53373),i=n.n(o),a=n(78220),l=n(32413),c=n(17088),d=n(46250);const u="static"!==getComputedStyle(document.documentElement).position;var p=n(79859),h=n.n(p);function f(){return{edges:{left:!0,right:!0,bottom:!1,top:!1},modifiers:[h().modifiers.restrictSize({min:{width:250,height:100}})]}}function m(e){if(!e||!e.startsWith("translate"))return null;const t=e.startsWith("translate3d"),n=e.replace("translate"+(t?"3d":""),"").match(/-?\d+(\.\d+)?/g);if(!n)return null;const s=Number(n[0]),r=Number(n[1]);return Number.isNaN(s)||Number.isNaN(r)?null:{x:s,y:r,is3d:t}}function g(e){return`translate${e.is3d?"3d":""}(${Math.round(e.x)}px,${Math.round(e.y)}px${e.is3d?",0":""})`}var y=n(25148),x=n(74874),b=n.n(x),w=n(16224),v=n(20124),T=n.n(v);function S(e,t){switch(t.type){case"overload":return t.payload;case"incremental":if(!e||!t.payload.placement)return e;const n=m(e.transform);if(!n)throw new Error("未解析到箭头的位置信息");return t.payload.placement.startsWith("bottom")||t.payload.placement.startsWith("top")?n.x=n.x-t.payload.x:(t.payload.placement.startsWith("left")||t.payload.placement.startsWith("right"))&&(n.y=n.y-t.payload.y),{...e,transform:g(n)}}}var C=n(93963),E=n(38792),_=n.n(E),k=n(64795),j=n(68046);function N(e,t){const n=e.pos;switch(t.type){case"setWidth":const s=e.width,r=t.payload;return s===r?e:{...e,width:r};case"readWidth":return t.payload(e.width),e;case"setPosSafe":const{pos:o,containerWidth:i=0,containerHeight:a=0}=t.payload,l=(0,k.D)(document.documentElement),c=(0,j.V)()||0;let d=o.x;const p=d+i-(window.innerWidth-(l.v?c:0));p>0&&(d-=p),d<0&&(d=0);let h=o.y;if(a){const e=h+a-(window.innerHeight-(l.h?c:0));e>0&&(h-=e)}return h<0&&(h=0),d===n.x&&h===n.y?null==e.otherStyles?e:{...e,otherStyles:null}:{...e,pos:{x:d,y:h,is3d:n.is3d},otherStyles:null};case"readPos":return t.payload(e.pos),e;case"importPopperStyles":const f=t.payload,g={pos:m(f.transform)||{x:0,y:0,is3d:!1},otherStyles:f};return _()(g,b()(e,["pos","otherStyles"]))?e:{...e,...g};case"incrementalPos":const{dx:y,dy:x}=t.payload;return 0===y&&0===x?e:{...e,pos:{x:n.x+y,y:n.y+x,is3d:n.is3d}};case"switch2fixed":const{pageXOffset:w,pageYOffset:v}=window,T={...e,otherStyles:null};return u||0===w&&0===v||(T.pos={x:n.x-w,y:n.y-v,is3d:n.is3d}),T;default:return e}}var R=n(31085);const L=T()("popperContainer"),A=b()(w.g2,["width","pinPos","pinAfterDrag"]),I=(0,s.forwardRef)((function(e,t){const{pin:n,setPin:r,range:o,show:p,placement:m,setMaxHeight:x,targetRef:w}=e,[v,T]=(0,s.useState)(!1);(0,s.useEffect)((()=>{p&&T(!1)}),[p]),(0,s.useEffect)((()=>{n||T(!1)}),[n]);const[E,_]=(0,s.useState)(null),k=(0,s.useRef)(null),j=(0,s.useMemo)((()=>p&&!n&&o?o:null),[o,p,n]),[I,P]=(0,s.useReducer)(N,{width:A.width,pos:{x:0,y:0,is3d:!1},otherStyles:null}),[O,z]=(0,y.A)(A),M=O?O.width:A.width,F=e=>{L("保存窗口宽度",e),z({width:e})};(0,s.useEffect)((()=>{L("同步 storage 中的宽度",M),P({type:"setWidth",payload:M})}),[M]);const $=O?O.pinPos:A.pinPos,D=e=>{const t=e&&b()(e,["x","y"]);L("保存窗口位置",t),z({pinPos:t})},B=()=>{n?P({type:"readPos",payload:D}):L("保存窗口位置时由于不是 pin 状态，取消保存")},H=(0,s.useCallback)((()=>{$&&(L("设置窗口位置"),P({type:"setPosSafe",payload:{pos:$,containerWidth:E?.clientWidth,containerHeight:E?.clientHeight}}))}),[E,$]);(0,s.useEffect)((()=>{if(n&&p)return H(),window.addEventListener("resize",H),()=>{window.removeEventListener("resize",H)}}),[H,n,p]);const[W,U]=(0,s.useReducer)(S,null),{realtimePlacement:V,updatePopper:Y,popperStyles:K,popperAttrs:q,arrowStyles:X,maxSizeObj:Z}=function(e,t,n,s){const{styles:r,attributes:o,update:i,state:a}=(0,c.E)(e,t,{placement:s,strategy:u?"fixed":void 0,modifiers:[{name:"arrow",options:{element:n}},{name:"computeStyles",options:{adaptive:!1}},{name:"offset",options:{offset:[0,12]}},d.A]});return{realtimePlacement:e&&a?.placement||null,updatePopper:e?i:null,popperStyles:e?r.popper:null,popperAttrs:e?o.popper:null,arrowStyles:e?r.arrow:null,maxSizeObj:e&&a?.modifiersData.maxSize||null}}(j,E,k.current,m);(0,s.useEffect)((()=>{U({type:"overload",payload:X})}),[X]),(0,s.useEffect)((()=>{!n&&Z&&x(Z.height)}),[Z,n,x]),(0,C.A)((()=>{K&&(L("导入 popperjs 的样式",K),P({type:"importPopperStyles",payload:K}))}),[K]);const J=function(e,t,n,r){const[o,i]=(0,s.useState)(null),[a,l]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{if(!e)return;const t=h()(e);return t.resizable({...f(),onstart(){l(!0)}}),i(t),()=>{t.unset(),i(null)}}),[e]),(0,s.useEffect)((()=>{if(!o)return;let e;if(t){const n=t.indexOf("-");switch(e=n>0?t.slice(0,n):t,e){case"top":e="bottom";break;case"bottom":e="top";break;case"left":e="right";break;case"right":e="left"}if("top"===e||"bottom"===e)return}const n=f();e&&(n.edges[e]=!1),o.set({resize:n})}),[t,o]),(0,s.useEffect)((()=>{if(!o)return;const e=function(e){n(e.rect.width,e.deltaRect.left,e.deltaRect.top)};return o.on("resizemove",e),()=>{o.off("resizemove",e)}}),[n,o]),(0,s.useEffect)((()=>{if(!o)return;const e=function(){l(!1),r()};return o.on("resizeend",e),()=>{o.off("resizeend",e)}}),[o,r]),a}(E,V,((e,t,n)=>{P({type:"setWidth",payload:e}),P({type:"incrementalPos",payload:{dx:t,dy:n}}),U({type:"incremental",payload:{x:t,y:n,placement:V}})}),(()=>{P({type:"readWidth",payload:F}),B()}));!function(e,t,n,r,o){const[i,a]=(0,s.useState)(null),[l,c]=(0,s.useState)(!1);(0,s.useEffect)((()=>{if(!e)return;const n=e.querySelector(t);if(!n)return void console.warn("未找到 selector “"+t+"”对应的元素，将不会启动拖拽功能。");const s=h()(n);return s.draggable(!0).styleCursor(!1),a(s),()=>{s.unset(),a(null)}}),[e,t]),(0,s.useEffect)((()=>{if(!i)return;const e=()=>{c(!0),n()};return i.on("dragstart",e),()=>{i.off("dragstart",e)}}),[i,n]),(0,s.useEffect)((()=>{if(!i)return;const e=e=>{r(e.dx,e.dy)};return i.on("dragmove",e),()=>{i.off("dragmove",e)}}),[i,r]),(0,s.useEffect)((()=>{if(!i)return;const e=()=>{c(!1),o()};return i.on("dragend",e),()=>{i.off("dragend",e)}}),[i,o])}(E,".drag-block",(0,s.useCallback)((()=>{T(!0),(null==O?.pinAfterDrag?A.pinAfterDrag:O.pinAfterDrag)&&r((e=>(e||(L("拖拽过程中将窗口转为固定模式位置"),P({type:"switch2fixed"})),!0)))}),[r,O?.pinAfterDrag]),((e,t)=>{P({type:"incrementalPos",payload:{dx:e,dy:t}})}),(()=>{B()})),(0,s.useImperativeHandle)(t,(()=>({switch2pin(){L("主动调用 switch2pin 方法转为固定模式"),P({type:"switch2fixed"}),B()},clearPos(){L("由于转为了非固定模式，所以清空了 storage 里的位置"),D(null),window.setTimeout((()=>{Y&&Y()}))}})));const G=(0,s.useMemo)((()=>{const e={...I.otherStyles,width:I.width,transform:g(I.pos)};return L("合成 container 样式",e),e}),[I]);return(0,R.jsxs)("div",{id:"popper-container",ref:_,style:G,...q,className:i()({show:p,pin:n},a.Nzu),children:[(0,R.jsx)(l.P,{onResize:()=>{n&&p&&!J&&H()},targetRef:w,children:e.children}),!v&&(0,R.jsx)("div",{className:"arrow",ref:k,style:W||void 0})]})}));var P=n(19687),O=n(23590),z=n(10435),M=n(16342),F=n(3444),$=n(63446),D=n(22067),B=n(54449),H=n(98087),W=n.n(H),U=n(79071),V=n.n(U),Y=n(62269),K=n(4225),q=n(91307),X=n(81152),Z=n(20760),J=n(83813),G=n(5877),Q=n(3040),ee=n(96072),te=n(74703),ne=n(98009),se=n(74070),re=n(66690),oe=n(81215),ie=n(67116);const ae=b()(w.g2,"secondDestinationLatestSource","selectedAPIs","collapsedAPIs","selectedExternalLinks","source","destination","autoPlay","autoCopy","recentUseLangFrom","recentUseLangTo","sourceTransformNCaml","sourceTransformNoBr","sourceTransformNoComment","sourceLower","sourceTransformRegExps","tipPanelSettingsClosed","historyEnabled","favoritesEnabled","quickLinks","tipQuickLinksClosed","panelCustomStyle","customAPINames","panelSize","panelButtons","textAreaAuto"),le=b()(w.Ne,["user","noticesUnreadNum"]),ce={small:14,middle:18,large:22},de=(0,s.forwardRef)((function(e,t){const{toaster:n,headerLeft:r,headerRight:o,extendOptions:i,showTextArea:l=!1,size:c="small",style:d,hasDragTip:u,portalContainer:p,showOptionsTip:h=!0,onTranslate:f,elementRef:m}=e,[g,x,w]=(0,y.A)(ae),[v]=(0,y.A)(le),T=v?.user||null,S=(0,s.useMemo)((()=>{const e=g?.selectedAPIs,t=g?.customAPINames;if(e&&t)return[...e,...t]}),[g?.customAPINames,g?.selectedAPIs]),C=(0,s.useMemo)((()=>{const e=g?.collapsedAPIs;return e&&e.length?(0,J.jM)(S,(t=>{t&&e.forEach((e=>{const n=t.indexOf(e);n>=0&&t.splice(n,1)}))})):S}),[S,g?.collapsedAPIs]),E=g?.quickLinks.filter((e=>e.panel))||[],_=g||ae,k=ce[c],j="small"===c,N="large"===c,L=g?.source||"",A=(0,s.useCallback)((e=>{x({source:e})}),[x]),[I,H]=(0,s.useState)(""),[U,de]=(0,s.useState)(""),ue=I===U,pe=(0,s.useRef)(null),[he,fe]=(0,s.useState)(!1),{results:me,queryResult:ge,dispatchResults:ye}=(0,X.L)(U,C,L,g?.destination,f),[xe,be]=(0,s.useState)([]),[,we]=(0,K.A)(),{isInFavorites:ve,saveOrDelete:Te}=(0,Z.A)(U,ye,C),Se=(0,te.O)(n),{sourceTransformNCaml:Ce,sourceTransformNoBr:Ee,sourceTransformNoComment:_e,sourceLower:ke,sourceTransformRegExps:je}=b()(g||ae,["sourceTransformNCaml","sourceTransformNoBr","sourceTransformNoComment","sourceLower","sourceTransformRegExps"]),Ne=(0,s.useRef)(""),Re=(0,s.useCallback)((e=>{if(e===Ne.current)return;Ne.current=e,be((e=>(0,J.jM)(e,(e=>{e.splice(0)}))));const t=(0,oe.W)(e,{sourceTransformNCaml:Ce,sourceTransformNoBr:Ee,sourceTransformNoComment:_e,sourceLower:ke,sourceTransformRegExps:je});H(t),de(t)}),[Ce,Ee,_e,ke,je]),Le=(0,s.useRef)(Re);Le.current=Re;const Ae=(0,G.A)(U);(0,s.useEffect)((()=>{_.historyEnabled&&Ae!==U&&U&&we({type:"save translate record",text:U})}),[we,U,_.historyEnabled]),(0,s.useEffect)((()=>{_.secondDestinationLatestSource&&Ae!==U&&U&&(0,re.o)(U).then((e=>{null!=e&&"中文(简体)"!==e&&chrome.storage.local.set({latestSource:e})}))}),[U,_.secondDestinationLatestSource]),(0,s.useImperativeHandle)(t,(()=>({select(){pe.current?.select()},async play(){if(!S)return;const e=S[0],t=me.results[e]?.result;return e&&t?.text===Ne.current?(0,B.Z)({apiId:e,source:t.from,text:t.text,ttsURI:t.phonetic?.[0].ttsURI||t.ttsURI}):void 0},async setText(e){if(await w,"text"===e.type)H(e.text);else if("image"===e.type)return Se(e.dataURI).then((e=>{H(e)}))},async translate(e,t){if(await w,"text"===e.type)Le.current(e.text),t&&this.select();else if("image"===e.type)return Se(e.dataURI).then((e=>{Le.current(e),t&&this.select()}))}})),[Se,w,me.results,S]);const Ie=(0,s.useMemo)((()=>j?{width:6,height:6,borderRadius:3,right:3,top:1}:N?{width:10,height:10,borderRadius:5,right:8,top:6}:{width:8,height:8,borderRadius:4,right:5,top:3}),[N,j]),Pe=(0,R.jsx)(P.$,{icon:(0,R.jsx)(O.I,{icon:"cog",size:k}),small:j,large:N,minimal:!0,active:he,className:"settings",onClick:()=>{fe((e=>!e))},title:"快捷设置"});return(0,R.jsxs)(R.Fragment,{children:[g?.panelCustomStyle&&(0,R.jsx)("style",{children:g.panelCustomStyle.replace(/bp3/g,"bp4").replace(/bp4/g,"bp5")}),(0,R.jsxs)("div",{id:"translate-panel",className:"size-"+c,style:d,ref:m,children:[(0,R.jsxs)("div",{className:"fixed",children:[(0,R.jsxs)("div",{className:"header",children:[(0,R.jsxs)("div",{className:"left",children:[r,g?.panelButtons.includes("media")&&(0,R.jsx)(ne.m,{isSmall:j,isLarge:N,iconSize:k,onSelect:e=>{Se(e).then(Re,V())},portalContainer:p}),g?.panelButtons.includes("microphone")&&(0,R.jsx)(se.h,{isSmall:j,isLarge:N,iconSize:k,onSelect:Re,portalContainer:p}),g?.panelButtons.includes("folder-open")&&(0,R.jsx)(P.$,{small:j,large:N,minimal:!0,icon:(0,R.jsx)(O.I,{icon:"folder-open",size:k}),onClick:()=>{(0,ie._)({action:"open options page",suffix:"#/stars"})},title:"打开收藏夹"}),g?.panelButtons.includes("history")&&(0,R.jsx)(P.$,{small:j,large:N,minimal:!0,icon:(0,R.jsx)(O.I,{icon:"history",size:k}),onClick:()=>{(0,ie._)({action:"open options page",suffix:"#/history"})},title:"打开历史记录"})]}),(0,R.jsx)("div",{className:"drag-block",title:u?"按住不放可以拖动":void 0}),(0,R.jsxs)("div",{className:"right",children:[!!xe.length&&(0,R.jsx)(P.$,{icon:(0,R.jsx)(O.I,{icon:"undo",size:k}),small:j,large:N,minimal:!0,title:"返回上一次翻译",onClick:()=>{const e=W()(xe);e&&(H(e),de(e)),be((e=>(0,J.jM)(e,(e=>{e.pop()}))))}}),!!v?.noticesUnreadNum&&(0,R.jsxs)("div",{style:{fontSize:0,position:"relative"},children:[(0,R.jsx)(P.$,{icon:(0,R.jsx)(O.I,{icon:"notifications",size:k}),small:j,large:N,minimal:!0,title:`你有 ${v.noticesUnreadNum} 条未读消息`,onClick:()=>{(0,ie._)({action:"open options page",suffix:"?notices"})}}),(0,R.jsx)("div",{style:{position:"absolute",background:"rgb(243,1,1)",...Ie}})]}),g&&(0,R.jsxs)(R.Fragment,{children:[g.favoritesEnabled&&(0,R.jsx)(P.$,{icon:(0,R.jsx)(O.I,{icon:ve?"star":"star-empty",size:k}),disabled:!U,small:j,large:N,minimal:!0,title:ve?"从收藏夹中删除":"添加到收藏夹",onClick:Te}),g.tipPanelSettingsClosed&&Pe,!g.tipPanelSettingsClosed&&(0,R.jsx)(z.A,{enforceFocus:!1,content:(0,R.jsxs)("div",{className:a.KJG,style:{width:"200px",padding:"5px"},children:["添加 / 隐藏翻译源、语种切换、鼠标悬浮取词开关和显示翻译文本开关在这里。",(0,R.jsx)("a",{onClick:()=>{x({tipPanelSettingsClosed:!0})},children:"不再提示"})]}),canEscapeKeyClose:!1,isOpen:!g.tipPanelSettingsClosed&&h,portalContainer:p,children:Pe})]}),o]})]}),(0,R.jsx)(M.S,{isOpen:he,keepChildrenMounted:!0,children:(0,R.jsx)(q.A,{source:L,setSource:A,options:g,setOptions:x,user:T,size:c,portalContainer:p,children:i})}),l&&(0,R.jsx)(ee.j,{isLarge:N,isSmall:j,iconSize:k,value:I,onChange:H,onTranslate:e=>{Re(null==e?I:e)},ref:pe,hideBtn:ue||!I,auto:g?.textAreaAuto||!1})]}),(0,R.jsxs)("div",{className:"body",style:ue?void 0:{opacity:.7},children:[!U&&(0,R.jsx)("p",{children:"请输入需要翻译的文本。"}),U&&g&&S?.map(((e,t)=>{const n=me.results[e];return(0,R.jsx)(B.A,{portalContainer:p,apiId:e,result:n,size:c,queryResult:t=>{ge(U,e,t||L)},autoPlay:g.autoPlay&&0===t,autoCopy:g.autoCopy&&0===t,setQuery:e=>{be((e=>(0,J.jM)(e,(e=>{e.push(U)})))),de(e),H(e)},collapse:g.collapsedAPIs.includes(e),onCollapseChange:()=>{x((t=>{const n=t.collapsedAPIs.indexOf(e);n>=0?t.collapsedAPIs.splice(n,1):t.collapsedAPIs.push(e)}))}},e)})),S&&!S.length&&(0,R.jsx)(F.I,{className:"no-api",title:"你隐藏了所有翻译源",description:"请添加一个翻译源来显示翻译结果。",action:(0,R.jsx)(z.A,{portalContainer:p,content:(0,R.jsx)($.W,{children:(0,R.jsx)(Y.A,{})}),children:(0,R.jsx)(P.$,{icon:"add",small:j,large:N,text:"添加翻译源"})})}),!!g?.selectedExternalLinks.length&&(0,R.jsx)("div",{className:"external-translators",children:g.selectedExternalLinks.map((e=>{const t=Q.j.find((t=>t.id===e));return t?(0,R.jsx)("div",{children:(0,R.jsx)(P.A,{small:j,large:N,text:t.name,target:"_blank",href:t.generateLink(U,g.destination,L)})},e):null}))}),g&&!g.tipQuickLinksClosed&&U&&(0,R.jsxs)(D.P,{style:{marginBottom:8,fontSize:12},children:["下方是预定义的三个快捷链接，你可以前往",(0,R.jsx)("a",{onClick:()=>{(0,ie._)({action:"open options page",suffix:"#/panel"})},children:"“设置” - “翻译面板”"})," ","- “快捷链接”中修改或删除它们。",(0,R.jsx)("a",{onClick:()=>{x({tipQuickLinksClosed:!0})},children:"不再提示"})]}),!!E.length&&U&&(0,R.jsx)("div",{className:"quick-links",children:E.map((e=>(0,R.jsx)("a",{href:e.link.replace("%s",encodeURIComponent(U)),target:"_blank",rel:"noreferrer",children:e.name},e.name)))})]})]})]})})),ue=function(e){e.preventDefault()},pe=b()(w.g2,["buttonAutoClose","buttonOffsetTop","buttonOffsetLeft"]);function he(e){const{btnPos:t,setBtnPos:n,onBtnClick:r}=e,o=t?"show":void 0,[i]=(0,y.A)(pe),a=(0,s.useRef)(),[l,c]=(0,s.useState)(!1),d=t?{transform:`translate(${t.x+10-(i?.buttonOffsetLeft||0)}px,${t.y+10-(i?.buttonOffsetTop||0)}px)`}:void 0;return(0,s.useEffect)((()=>{if(!i?.buttonAutoClose)return c(!1),void window.clearTimeout(a.current);t?l?window.clearTimeout(a.current):a.current=window.setTimeout((()=>{n(null)}),2e3):(c(!1),window.clearTimeout(a.current))}),[t,l,n,i?.buttonAutoClose]),(0,R.jsx)("div",{id:"translate-btn",className:o,style:d,onPointerDown:ue,onPointerEnter:()=>{c(!0)},onPointerLeave:()=>{c(!1)},children:(0,R.jsx)(P.$,{icon:(0,R.jsx)("span",{className:"btn-icon"}),onClick:r})})}var fe=n(81100),me=n(96538);function ge(e){const t=e.match(/^(([^:]+):\/\/)?([^/]+)?(\/.*)?$/);if(!t)return;let n=t[3]||"";const s=n.indexOf(":");s>=0&&(n=n.slice(0,s));let r=t[4]||"";const o=r.indexOf("#");if(o>=0&&(r=r.slice(0,o)),!n.startsWith(".")){if(!r){if(!n)return;r="/"}return{host:n,path:r}}}function ye(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace("*",".*").replace(/^\.\*\\\./,"(.*\\.)?")+"$").test(t)}function xe(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$").test(t)}function be(e,t,n){let s,r;s="string"==typeof e?ge(e):e;let o=!1,i=!1;if(s){const e=e=>{const t=function(e,t){let n;if(n="string"==typeof t?ge(t):t,n)return ye(e.host,n.host)&&xe(e.path,n.path)}(e,s);return t&&(r=e),t};o=n.some(e),o||(i=t.some(e))}return{urlParts:s,matchedRule:r,whiteListMatched:o,blackListMatched:i}}var we=n(78107),ve=n(95805),Te=n(6747),Se=n(23593),Ce=n(83657),Ee=n.n(Ce),_e=n(38285),ke=n.n(_e),je=n(43785),Ne=n(90274);const Re=T()("detector master");function Le(e){const t=e.selection;let n=null;if(t){const s=t.text,r=t.event;let o,i,a;if("function"==typeof t.rect)o=t.rect(),i={getBoundingClientRect:t.rect},a=r?{x:r.clientX+e.path[0].scrollLeft,y:r.clientY+e.path[0].scrollTop}:null;else{a=r?{x:r.clientX,y:r.clientY}:null;const n=e.path;o=b()(t.rect,["top","left","width","height","right","bottom"]),Ee()(n,(e=>{if(e.rect&&e.computedStyles){const t=e.rect.left+e.computedStyles.paddingLeft+e.computedStyles.borderLeftWidth,n=e.rect.top+e.computedStyles.paddingTop+e.computedStyles.borderTopWidth;o.left+=t,o.top+=n,a&&(a.x+=t,a.y+=n)}})),o.right=o.left+o.width,o.bottom=o.top+o.height,i={getBoundingClientRect:()=>o};const s=W()(e.path);a=a?{x:a.x+s.scrollLeft,y:a.y+s.scrollTop}:null}n={text:s,mouseUpEvent:r,multiClick:t.multiClick,isTop:t.isTop,isInTextarea:t.isInTextarea,isInContentEditable:t.isInContentEditable,range:i,btnPos:a}}return{parsedData:n,activeFrameIndex:e.path.map((e=>e.frameIndex))}}var Ae=n(28820),Ie=n.n(Ae),Pe=n(41938),Oe=n(30819);const ze=b()(w.g2,["localOCR"]);function Me(e){const{imgSrc:t,isShow:n,setIsShow:r,onText:o,isLocalOCR:i,portalContainer:a}=e,[l,c]=(0,y.A)(ze),d=(0,s.useRef)(null),u=(0,s.useRef)(),p=(0,s.useRef)(null),[h,f]=(0,s.useState)(null);return(0,s.useLayoutEffect)((()=>{if(!n)return;const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}),[n]),(0,s.useLayoutEffect)((()=>{if(!n||!d.current)return;const e=d.current,t=new(Ie())(d.current,{viewMode:1,guides:!1,center:!1,minContainerWidth:e.clientWidth,minContainerHeight:e.clientHeight,autoCrop:!1,movable:!1,rotatable:!1,scalable:!1,zoomable:!1,zoomOnTouch:!1,zoomOnWheel:!1,cropstart(){f(null)},cropend(){const e=t.getCropBoxData();f({left:-9999,top:-9999}),window.setTimeout((()=>{f({left:e.left+e.width-(p.current?.clientWidth||0),top:e.top+e.height+5})}))}});return u.current=t,()=>{f(null),t.destroy(),u.current=void 0}}),[n]),(0,s.useEffect)((()=>{if(!n)return;const e=e=>{27===e.keyCode&&(e.stopPropagation(),r(!1))};return window.addEventListener("keyup",e,!0),()=>{window.removeEventListener("keyup",e,!0)}}),[r,n]),n?(0,R.jsxs)("div",{id:"ocr-container",children:[(0,R.jsxs)("div",{ref:p,className:"toolbar",style:{display:h?"block":"none",left:h?.left,top:h?.top},children:[(0,R.jsx)(P.$,{onClick:()=>{if(!window.isSecureContext)return void window.alert("受限于浏览器的安全策略，复制截图只能在 https 网站使用。");if(!navigator.clipboard?.write)return void window.alert(Oe.KA?"复制截图的功能需要在 Chrome 66 / Edge 79 及以上的版本中才能使用。":"Firefox 浏览器暂时不支持复制截图，请在别的浏览器上使用。");const e=u.current;e&&e.getCroppedCanvas({imageSmoothingEnabled:!1}).toBlob((e=>{e&&navigator.clipboard.write([new ClipboardItem({[e.type]:e})]).then((()=>{r(!1)}),(e=>{window.alert("复制失败，错误消息："+e.message)}))}))},children:"复制截图"}),i&&(0,R.jsx)(Pe._,{value:l?.localOCR.lang||ze.localOCR.lang,onChange:e=>{c((t=>{t.localOCR.lang=e}))},portalContainer:a}),(0,R.jsx)(P.$,{onClick:()=>r(!1),children:"取消 (Esc)"}),(0,R.jsx)(P.$,{onClick:()=>{const e=u.current;if(!e)return;const t=e.getCroppedCanvas().toDataURL(),n=e.getCropBoxData();o(t,n),r(!1)},children:"确定"})]}),(0,R.jsx)("img",{ref:d,src:t,alt:"屏幕截图"})]}):null}var Fe=n(12128),$e=n(22053),De=n.n($e),Be=n(18785),He=n(27429),We=n(72431);const Ue=[We.VI.ChatGPT,We.VI.Claude,We.VI.Gemini,We.VI.TongYi,We.VI.LingYi,We.VI.Moonshot,We.VI.DeepSeek,We.VI.ZhiPu,We.VI.MiniMax,We.VI.BaiChuan,We.VI.DouBao,We.VI.WenXin,We.VI.HunYuan,We.VI.SiliConflow];class Ve extends He.A{stream=[];streamTextLength=0;queue=[];handling=!1;constructor(e,t){super(),this.apiCode=e,this.options=t}addStream(e){const t=e.text.length;t&&(Ue.includes(this.apiCode)?(this.queue.push([e]),this.handleTask()):(this.streamTextLength+t>3e3&&(this.queue.push(this.stream),this.stream=[],this.streamTextLength=0,this.handleTask()),this.stream.push(e),this.streamTextLength+=t,setTimeout((()=>{this.handleTask()}),500)))}handleTask(){if(this.handling)return;let e=this.queue.shift();if(!e){if(!this.stream.length)return;e=this.stream,this.stream=[],this.streamTextLength=0}this.handling=!0;const t=[],n=[];e.forEach((e=>{const s=e.text.split("\n").map((e=>e.trim())).filter(De());n.push({start:t.length,end:t.length+s.length}),t.push(...s)})),this.emit("translate-before"),(0,ie._)({action:"translate",data:{apiCode:this.apiCode,source:this.options.source,destinations:this.options.dest,text:t.join("\n")}}).finally((()=>{this.emit("translate-after")})).then((t=>{let s;if(t.result)s=t.result;else{const e=t.dict?.[0].terms[0];e&&(s=[e])}const r=t.error;var o;r?.message&&(r.message=`【${o=this.apiCode,Be.v.find((e=>e.id===o))?.name}】${r.message}`),e.forEach(((e,t)=>{if(r)return void e.reject(r);if(!s)return void e.reject(new Error("没有翻译结果"));const o=n[t],i=o.end-o.start,a=s.slice(o.start,o.end);e.resolve(a.length===i?a.join("\n"):null)})),this.handling=!1}),(t=>{e.forEach((e=>{e.reject(t)})),this.handling=!1})).then((()=>{this.handleTask()}))}}var Ye=n(94903);function Ke(){const e=document.body.childNodes;return 1===e.length&&e[0]instanceof HTMLPreElement}class qe{constructor(e,t=Ye.a.source,n){let s;if(n)s=n;else{if(!Ke())throw new TypeError("当前页面不是 txt 文件。");s=document.body.firstElementChild}this.preElement=s,this.showType=Ye.a.source,this.originText=s.textContent||"",this.originParagraphs=this.originText.split(/\n{2,}/),this.resultParagraphs=[],this.originParagraphs.forEach(((t,n)=>{const s=t.replace(/\n/g," ").trim();s?(this.resultParagraphs[n]="正在翻译，请稍候……",e(s).then((e=>{this.resultParagraphs[n]=e||"",this.renderResult()}))):this.resultParagraphs[n]=""})),this.switchShowType(t)}renderResult(){switch(this.showType){case Ye.a.source:this.preElement.textContent=this.originText;break;case Ye.a.result:this.preElement.textContent=this.resultParagraphs.join("\n\n");break;case Ye.a.both:this.preElement.textContent=this.originParagraphs.reduce(((e,t,n)=>t.trim()?e+t+"\n【译文】"+this.resultParagraphs[n]+"\n\n":e),"")}}switchShowType(e){this.showType!==e&&(this.showType=e,this.renderResult())}destroy(){this.switchShowType(Ye.a.source),this.destroyed=!0}}class Xe{constructor(e,t,n,s){this.rootNode=e,this.staticChildNodes=t,this.translateNodes=[],this.translateFn=n,this.options=s}add(e,t){const{rootNode:n,staticChildNodes:s,translateNodes:r,translateFn:o}=this,i=s.slice(e,t+1),a=new Ye.r(n,i,o,this.options);return r.push(a),a}translate(){this.translateNodes.forEach((e=>e.translate()))}setOnlyChild(){this.translateNodes[0]?.setOnlyChild()}switchShowType(e){this.translateNodes.forEach((t=>t.switchShowType(e)))}destroy(){this.translateNodes.forEach((e=>e.destroy()))}}const Ze=["base","head","link","meta","style","body","hr","pre","br","area","audio","img","map","track","video","embed","iframe","object","param","picture","portal","source","svg","math","canvas","noscript","script","input","meter","progress","textarea","select"],Je=["article","aside","footer","header","h1","h2","h3","h4","h5","h6","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","li","ol","p","ul","details","dialog","menu","summary","form","table","thead","tbody","tr","th","td","center","label"].concat(Ze);function Ge(e){return e.nodeType===Node.ELEMENT_NODE}function Qe(e){const t=e.tagName.toLowerCase();return Je.includes(t)||t.includes("-")&&"g-emoji"!==t}function et(e){const t=e.tagName.toLowerCase();return"button"===e.getAttribute("role")?!Ze.includes(t):"button"===t||"a"===t}function tt(e,t,n=(()=>!1),s){const r={element:e,paragraphs:[],children:[]};if(e instanceof Element&&n(e))return r;if(e instanceof Element){const o=e.shadowRoot;if(o){const e=tt(o,t,n,s);r.children.push(e)}}let o;const i=Array.from(e.childNodes);let a=!1;const l=i.filter((e=>{if(e.nodeType===Node.TEXT_NODE){const t=!!e.nodeValue?.trim();return t&&(a=!0),t}return e.nodeType===Node.ELEMENT_NODE})),c=e=>i.indexOf(l[e]);if(l.forEach(((d,u)=>{if(null==o&&(o=u),Ge(d)&&(Qe(d)||function(e,t,n){const s=e[t];if(!Ge(s))return!1;const r=e[t-1],o=e[t+1];if(et(s)&&!n){if(r&&Ge(r)&&et(r))return!0;if(o&&Ge(o)&&et(o))return!0}return r?Ge(r)&&Qe(r):!o||Ge(o)&&Qe(o)}(l,u,a))){const a=u-1;if(a>=o){const n=c(o),s=c(a);r.paragraphs.push([n,s]),t?.(e,i,n,s)}if(o=void 0,!function(e){if(et(e))return!1;const t=e.tagName.toLowerCase();return Ze.includes(t)}(d)&&!n(d)){const e=tt(d,t,n,s);r.children.push(e)}}})),null!=o){const n=l.length-1,s=c(o),a=c(n);r.paragraphs.push([s,a]),t?.(e,i,s,a)}return 1===r.paragraphs.length&&0===r.children.length&&s?.(r),r}class nt{text=document.title;translateResult="";translating=!1;translated=!1;showType=Ye.a.source;destroyed=!1;constructor(e){this.translateFn=e}destroy(){document.title=this.text,this.destroyed=!0}switchShowType(e){if(!this.destroyed){switch(e){case Ye.a.both:document.title=`${this.text} ~ ${this.translateResult}`;break;case Ye.a.source:document.title=this.text;break;case Ye.a.result:document.title=this.translateResult}this.showType=e}}async translate(){if(this.destroyed||!this.text||this.translating||this.translated)return;let e;this.translating=!0,this.translateResult="正在翻译……",this.switchShowType(this.showType);try{e=await this.translateFn(this.text)}catch(e){return this.translating=!1,this.translated=!0,this.translateResult="翻译出错："+e.message,void this.switchShowType(this.showType)}if(this.translating=!1,null==e)return this.translate();this.translated=!0,this.translateResult=e,this.switchShowType(this.showType)}}var st=n(62337),rt=n(69675);const ot={STYLE_NONE:st.P9,STYLE_DOTTED_CLASSIC:st.O,STYLE_DOTTED:st.pb,STYLE_WAVY:st.UU,STYLE_LINE:st.Zi,STYLE_BACKGROUND:st.dd,STYLE_QUOTE:st.PD};let it;function at(){if(it)return;it=document.createElement("style"),it.dataset.title="这是由划词翻译创建的节点，用于控制全文翻译的译文样式。",document.head.appendChild(it);const e=b()(w.g2,["pageTrsResultStyleId","pageTrsResultStyleMainColor","pageTrsResultStyleTextColor","pageTrsResultStyleTextSize","pageTrsResultStyleTextWeight","pageTrsResultStyleCustom"]);(0,rt.A)(e,(t=>{t.pageTrsResultStyleId&&(e.pageTrsResultStyleId=t.pageTrsResultStyleId),void 0!==t.pageTrsResultStyleCustom&&(e.pageTrsResultStyleCustom=t.pageTrsResultStyleCustom),void 0!==t.pageTrsResultStyleMainColor&&(e.pageTrsResultStyleMainColor=t.pageTrsResultStyleMainColor),void 0!==t.pageTrsResultStyleTextColor&&(e.pageTrsResultStyleTextColor=t.pageTrsResultStyleTextColor),void 0!==t.pageTrsResultStyleTextSize&&(e.pageTrsResultStyleTextSize=t.pageTrsResultStyleTextSize),void 0!==t.pageTrsResultStyleTextWeight&&(e.pageTrsResultStyleTextWeight=t.pageTrsResultStyleTextWeight),function(){if(!it)return;let t="hcfy-result{";e.pageTrsResultStyleMainColor&&(t+=`--hcfy-result-main-color:${e.pageTrsResultStyleMainColor};`),e.pageTrsResultStyleTextColor&&(t+=`--hcfy-result-text-color:${e.pageTrsResultStyleTextColor};`),e.pageTrsResultStyleTextSize&&(t+=`--hcfy-result-text-size:${e.pageTrsResultStyleTextSize}em;`),e.pageTrsResultStyleTextWeight&&(t+=`--hcfy-result-text-weight:${e.pageTrsResultStyleTextWeight};`),t+="}","STYLE_CUSTOM"===e.pageTrsResultStyleId?t+=e.pageTrsResultStyleCustom:t+=ot[e.pageTrsResultStyleId]||"",it.textContent=t}()}))}function lt(e){const t=e.nodeName.toLowerCase();return"body"!==t&&"html"!==t}function ct(e){return Array.prototype.some.call(e.childNodes,(e=>"hcfy-result"===e.nodeName.toLowerCase()))}class dt{groups=new Map;mutationObserver=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{Ge(e)&&!function(e,t){let n=e;do{if(t(n))return!0;n=n.parentElement}while(n&&lt(n));return!1}(e,(e=>{const t=e.tagName.toLowerCase();return"pre"===t||"hcfy-result"===t||(!!ct(e)||void 0)}))&&this.analysis(e)})),e.removedNodes.forEach((e=>{if(Ge(e)){const t=e=>{this.groups.delete(e),Array.prototype.forEach.call(e.children,t)};t(e)}}))}))}));intersectionObserver=new IntersectionObserver((e=>{e.forEach((e=>{if(0===e.intersectionRatio)return;const t=this.groups.get(e.target);t&&t.translate()}))}),{rootMargin:`${window.screen.availHeight*window.devicePixelRatio}px ${window.screen.availWidth*window.devicePixelRatio}px`});constructor(e,t=Ye.a.both,n=document.body,s){at(),this.options=s,this.translateFn=e,this.showType=t,this.titleNode=new nt(e),this.titleNode.switchShowType(t),this.titleNode.translate(),this.analysis(n);const r=document.getElementsByTagName("sr-read")[0];r&&this.analysis(r),this.mutationObserver.observe(n,{childList:!0,subtree:!0})}analysis(e){const{groups:t,translateFn:n}=this;tt(e,((e,s,r,o)=>{let i=t.get(e);i||(i=new Xe(e,s,n,this.options),t.set(e,i),e instanceof Element&&this.intersectionObserver.observe(e));i.add(r,o).switchShowType(this.showType)}),(e=>"hcfy-result"===e.tagName.toLowerCase()||ct(e)),(e=>{const n=t.get(e.element);n&&n.setOnlyChild()}))}switchShowType(e){this.showType=e,this.titleNode.switchShowType(e);for(const t of this.groups.values())t.switchShowType(e)}destroy(){this.intersectionObserver.disconnect(),this.mutationObserver.disconnect(),this.titleNode.destroy();for(const e of this.groups.values())e.destroy()}}const ut=b()(w.g2,["pageTrsEditable"]);var pt=n(59596),ht=n(61707),ft=n(20269);const mt=T()("useHoverShow"),gt=Oe.UP?2e3:500;function yt(e,t){(0,s.useEffect)((()=>{if(!e)return;let n=!1;const s=e.clientWidth;let r;mt("第一次读取面板的宽度为 %dpx",s),e.style.transform=`translateX(${t.includes("left")?"-":""}${s}px)`,e.style.transition="none",setTimeout((()=>{if(!n){if(e.style.transform){const n=e.clientWidth;mt("第二次读取面板的宽度为 %dpx",n),e.style.transform=`translateX(${t.includes("left")?"-":""}${n}px)`}setTimeout((()=>{n||(e.style.transition="transform 0.2s")}),0)}}),16);const o=()=>{null!=r&&clearTimeout(r)},i=()=>{o(),e.style.transform=""},a=()=>{var n;n=gt,o(),r=setTimeout((()=>{e.style.transform=`translateX(${t.includes("left")?"-":""}${e.clientWidth}px)`}),n)};return e.addEventListener("mouseenter",i),e.addEventListener("mouseleave",a),()=>{n=!0,o(),e.style.transform="",e.style.transition="",e.removeEventListener("mouseenter",i),e.removeEventListener("mouseleave",a)}}),[e,t])}var xt=n(22221);function bt(e){const{children:t,portalContainer:n,showTip:s,clearTip:r}=e;return s?(0,R.jsx)(xt.m,{isOpen:!0,portalContainer:n,placement:"left",content:(0,R.jsxs)("div",{style:{width:180},children:["可以在这里切换翻译服务和双语 / 原文 / 译文。",(0,R.jsx)("a",{onClick:r,children:"不再提示"})]}),children:t}):(0,R.jsx)(R.Fragment,{children:t})}var wt=n(25812);const vt=b()(w.Ne,"tipForSaveSourceSelectClosed");function Tt(){const[e,t]=(0,y.A)(vt);return null==e||e.tipForSaveSourceSelectClosed?null:(0,R.jsxs)(D.P,{children:["从现在起，划词翻译会记住你选择的“源语种”，在下次开启全文翻译时会自动使用你之前选择的源语种。",(0,R.jsx)("a",{onClick:()=>{t({tipForSaveSourceSelectClosed:!0})},children:"不再提示"})]})}const St=[{label:"关闭",value:"close"},{label:"当前标签页",value:"tab"},{label:"当前窗口",value:"window"}];function Ct(e){return(0,R.jsx)(ht.g,{options:St,value:e.value,onChange:t=>{const n=t.currentTarget.value;e.setValue(n)}})}const Et=[{name:"双语",value:Ye.a.both},{name:"原文",value:Ye.a.source},{name:"译文",value:Ye.a.result}],_t=chrome.runtime.getURL("/logodark.png");function kt(){(0,ie._)({action:"open options page",suffix:"#/fulltext"})}const jt={...b()(w.g2,["pageTrsApiOptions","customAPINames","tipForSlowDeepLPageTrsClosed","tipForPageTrsClosed"]),...b()(w.Ne,["tipForShortKeyForPageTrsTypeClosed","tipForAddJumpTwoClosed"])};function Nt(e){const{apiCode:t,source:n,onSourceChange:r,target:o,onTargetChange:i,showType:l,onShowTypeChange:c,onAPIChange:d,auto:u,onAutoChange:p,loading:h,portalContainer:f,pos:m}=e,[g,x]=(0,y.A)(jt),b=(0,s.useMemo)((()=>{let e=g?.pageTrsApiOptions||jt.pageTrsApiOptions;e.includes(t)||(e=e.concat(t));const n=Be.B.filter((t=>e.includes(t.id))),s=(g?.customAPINames||jt.customAPINames).map((e=>({id:e,name:e})));return s.length?[...n,...s]:n}),[g?.pageTrsApiOptions,g?.customAPINames,t]),[w,v]=(0,s.useState)(null),[T,S]=(0,s.useState)(null);(0,s.useEffect)((()=>{if(w)return S(w.closest("."+a._Y0)),()=>{S(null)}}),[w]),yt(T,m);const C=!!g&&!g.tipForPageTrsClosed,E={position:"absolute",width:30,top:0,bottom:0,padding:"0 3px",...m.includes("right")?{left:-30}:{right:-30}};return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(P.$,{ref:v,loading:h,style:E,children:(0,R.jsx)(bt,{portalContainer:f,showTip:C,clearTip:C?()=>{x({tipForPageTrsClosed:!0})}:void 0,children:(0,R.jsx)("img",{src:_t,style:{width:"100%"},alt:"展开"})})}),(0,R.jsxs)(pt.g,{label:"翻译服务：",inline:!0,className:"page-trs-form-group",style:{margin:"0 0 5px 0"},children:[(0,R.jsx)(ht.g,{value:t,onChange:e=>{const t=e.currentTarget.value;d(t)},children:b.map((e=>"BingDictWeb"===e.id?null:(0,R.jsx)("option",{value:e.id,children:e.name},e.id)))}),"DeepLWeb"===t&&g&&!g.tipForSlowDeepLPageTrsClosed&&(0,R.jsxs)(D.P,{intent:"warning",icon:null,style:{width:200},children:[(0,R.jsxs)("p",{children:["DeepL 首次翻译速度较慢，请耐心等待。若遇到问题（报错、翻译结果不全等）请",(0,R.jsx)("a",{href:"https://hcfy.ai/docs/services/free/#deepl",target:"_blank",rel:"noreferrer",children:"点击查看解决方案"}),"。"]}),(0,R.jsx)(P.$,{small:!0,intent:"primary",onClick:()=>{x({tipForSlowDeepLPageTrsClosed:!0})},children:"不再提示"})]})]}),(0,R.jsxs)(pt.g,{label:"模式：",inline:!0,className:"page-trs-form-group",children:[(0,R.jsx)(ft.e,{style:{padding:0},children:Et.map((e=>(0,R.jsx)(P.$,{active:l===e.value,onClick:()=>{e.value!==l&&c(e.value)},text:e.name},e.value)))}),g&&!g.tipForShortKeyForPageTrsTypeClosed&&(0,R.jsxs)(D.P,{style:{width:160},children:["你可以用快捷键来切换双语 / 原文 / 译文。",(0,R.jsxs)("div",{children:[(0,R.jsx)("a",{onClick:()=>{(0,ie._)({action:"open options page"})},style:{marginRight:15},children:"前往设置"}),(0,R.jsx)("a",{onClick:()=>{x({tipForShortKeyForPageTrsTypeClosed:!0})},children:"不再提示"})]})]}),g&&!g.tipForAddJumpTwoClosed&&(0,R.jsxs)(D.P,{style:{width:160},children:["切换双语 / 原文 / 译文的快捷键现在可以选择【跳过双语】了。",(0,R.jsxs)("div",{children:[(0,R.jsx)("a",{onClick:()=>{(0,ie._)({action:"open options page"})},style:{marginRight:15},children:"前往设置"}),(0,R.jsx)("a",{onClick:()=>{x({tipForAddJumpTwoClosed:!0})},children:"不再提示"})]})]})]}),(0,R.jsx)(pt.g,{label:"自动开启：",inline:!0,className:"page-trs-form-group",children:(0,R.jsx)(Ct,{value:u,setValue:p})}),(0,R.jsxs)(pt.g,{label:"源语种：",inline:!0,className:"page-trs-form-group",children:[(0,R.jsx)(wt.A,{lang:n,setLang:r,addAuto:!0,portalContainer:f}),(0,R.jsx)(Tt,{})]}),(0,R.jsx)(pt.g,{label:"目标语种：",inline:!0,className:"page-trs-form-group",children:(0,R.jsx)(wt.A,{lang:o,setLang:i,portalContainer:f})}),(0,R.jsx)("div",{children:(0,R.jsx)("a",{onClick:kt,children:"打开设置"})})]})}var Rt=n(20916);const Lt=b()(w.Ne,"tipForFullTextClosed");function At(e){const{fullTextOpen:t,portalContainer:n}=e,[r,o]=(0,s.useState)(!1),[i,l]=(0,s.useState)(!1),[c,d]=(0,y.A)(Lt),u=c?.tipForFullTextClosed;return(0,s.useEffect)((()=>{!1===u&&t&&o(!0)}),[t,u]),!0===u?null:(0,R.jsxs)(Rt.l,{isOpen:r,title:"全文翻译功能的重要提示",portalContainer:n,canEscapeKeyClose:!1,canOutsideClickClose:!1,isCloseButtonShown:!1,children:[(0,R.jsxs)("div",{className:a.sar,children:[(0,R.jsxs)("p",{children:["全文翻译功能默认使用谷歌翻译，但",(0,R.jsx)("a",{href:"https://hcfy.ai/blog/2022/09/28/ggg",target:"_blank",rel:"noreferrer",children:"谷歌翻译可能需要额外配置才能使用"}),"。"]}),(0,R.jsxs)("p",{children:["你还可以切换为别的翻译服务，如 DeepL、Yandex 等，",(0,R.jsx)("b",{children:"将鼠标移动至右下角的划词翻译图标上，在弹出来的面板里即可切换"}),"。"]}),(0,R.jsxs)("p",{children:[(0,R.jsx)("b",{children:"DeepL 和 Yandex 是可以直接使用的"}),"，其它翻译服务需要自行申请后才能使用。"]}),(0,R.jsx)("div",{style:{textAlign:"right"},children:(0,R.jsx)(we.Sc,{inline:!0,style:{margin:0},checked:i,onChange:e=>{l(e.currentTarget.checked)},label:"不再提示"})})]}),(0,R.jsx)("div",{className:a.DBf,style:{marginTop:0},children:(0,R.jsx)("div",{className:a.Nu2,children:(0,R.jsx)(P.$,{intent:"primary",text:"我知道了",onClick:()=>{o(!1),i&&d({tipForFullTextClosed:!0})}})})})]})}var It=n(5090);const Pt=v("@hcfyapp/aftr");class Ot extends He.b{constructor(){super(),chrome.runtime.onMessage.addListener((e=>{var t;if((t=e,(0,It.Z4)(t)&&"__aftrMessage__"in t)&&(Pt("收到消息 %o",e),"setMode"===e.__aftrAction__))this.emit("change",e.__aftrPayload__)}))}getMode(){return chrome.runtime.sendMessage({__aftrMessage__:!0,__aftrAction__:"getMode"})}setMode(e){return chrome.runtime.sendMessage({__aftrMessage__:!0,__aftrAction__:"setMode",__aftrPayload__:e})}}const zt=new Ot;const Mt=50,Ft=new Fe.y("pageTranslateLimit",Mt);const $t={...b()(w.g2,["pageTrsApi","pageTrsSource","pageTrsDest"]),...b()(w.Ne,["pageTrsType"])},Dt=b()(w.g2,["pageTrsJumpTwo"]);function Bt(e){const{open:t,setOpen:n,portalContainer:r,pos:o="bottom-right"}=e,{mode:i,setMode:a}=function(e){const[t,n]=(0,s.useState)(null),r=(0,s.useRef)(e);return(0,s.useEffect)((()=>{r.current=e}),[e]),(0,s.useEffect)((()=>{zt.getMode().then((e=>{n(e),r.current?.(e)}))}),[]),(0,s.useEffect)((()=>(zt.on("change",n),()=>{zt.off("change",n)})),[]),{mode:t,setMode:(0,s.useCallback)((e=>{n(e),zt.setMode(e)}),[])}}((e=>{"close"!==e&&n(!0)})),[l,c]=(0,s.useState)(null),d=(0,s.useRef)(),u=(0,s.useRef)(""),[p,h]=(0,s.useState)(Ye.a.both),[f,m]=(0,s.useState)(""),g=(0,s.useCallback)((e=>{chrome.storage.local.set({pageTrsType:e}),h(e),d.current?d.current.switchShowType(e):console.warn("不应该在未开启全文翻译时切换显示类型。")}),[]),[y,x]=(0,s.useState)($t.pageTrsSource),[b,w]=(0,s.useState)($t.pageTrsDest[0]),[v,T]=(0,s.useState)(!1),S=(0,s.useCallback)((async()=>{d.current&&(d.current.destroy(),d.current=void 0);if(await Ft.isOver(!0)){if(n(!1),a("close"),!l)throw new Error("toaster 不应该为空。");!function(e){e.show({action:{text:"开通会员",onClick:q.$},message:`非会员每七天只能使用 ${Mt} 次网页全文翻译功能，下次重置时间：${Ft.dateEnd}。成为会员即可解除此限制。`,intent:"primary",timeout:0})}(l)}else d.current=await async function(){const{pageTrsType:e,pageTrsApi:t,pageTrsDest:n,pageTrsSource:s}=await chrome.storage.local.get($t);h(e),m(t),w(n[0]),x(s);const r=new Ve(t,{dest:n,source:s});return r.on("translate-before",(()=>{T(!0)})),r.on("translate-after",(()=>{T(!1)})),async function(e,t=Ye.a.both){if(Ke())return new qe(e,t);{const n=await chrome.storage.local.get(ut);return new dt(e,t,document.body,{editable:n.pageTrsEditable})}}((e=>new Promise(((t,n)=>r.addStream({text:e,resolve:t,reject:n})))),e)}()}),[n,a,l]);return(0,s.useEffect)((()=>{if(!l||!t)return;const e={message:(0,R.jsx)(Nt,{loading:v,source:y,onSourceChange:e=>{chrome.storage.local.set({pageTrsSource:e}).then((()=>{S()}))},target:b,onTargetChange:e=>{chrome.storage.local.set({pageTrsDest:[e]}).then((()=>{S()}))},showType:p,onShowTypeChange:g,auto:i||"close",onAutoChange:e=>{a(e)},apiCode:f,onAPIChange:e=>{chrome.storage.local.set({pageTrsApi:e}),m(e),S()},portalContainer:r,pos:o}),timeout:0,onDismiss(){u.current="",n(!1)}};u.current?l.show(e,u.current):u.current=l.show(e)}),[v,t,S,f,i,p,r,o,n,a,y,g,b,l]),(0,s.useEffect)((()=>{t&&S()}),[t,S]),(0,s.useEffect)((()=>{l&&!t&&(d.current&&(d.current.destroy(),d.current=void 0),u.current&&(l.dismiss(u.current),u.current=""))}),[t,l]),(0,s.useEffect)((()=>{if(t)return chrome.runtime.onMessage.addListener(e),()=>{chrome.runtime.onMessage.removeListener(e)};function e(e){if("page translate switch mode"===e){const e=Et.findIndex((e=>e.value===p));if(e<0)return;let t=e+1;t>=Et.length?chrome.storage.local.get(Dt).then((({pageTrsJumpTwo:e})=>{t=e?1:0,g(Et[t].value)})):g(Et[t].value)}}}),[t,p,g]),(0,R.jsxs)("div",{id:"web-trs-panel",children:[(0,R.jsx)(At,{fullTextOpen:t,portalContainer:r}),(0,R.jsx)(ve.V,{position:o,ref:c,className:"app-toaster-container",usePortal:!1})]})}var Ht=n(86234),Wt=n(29842);function Ut(e){const{mediaElement:t,serviceImplement:n,lang:r,onStart:o,onStop:i}=e,[a,l]=(0,s.useState)(!1),[c,d]=(0,s.useState)([]),[u,p]=(0,s.useState)(""),h=t instanceof HTMLAudioElement?"音频":"视频",f=(0,s.useRef)(!1),m=(0,s.useRef)(),g=()=>{d([]),p("")},y=(0,s.useCallback)((()=>{if(!t)return;if(a)throw new Error("识别服务正在运行，在停止前无法直接开始。");f.current=!1,l(!0),t.pause();const e=e=>{const t=(0,Wt.H8)(e);window.alert(t.message),g(),l(!1),i()};n.mediaStream({mediaStream:t,lang:r,options:{onInterim:e=>{f.current||p(e)},onSentence:e=>{f.current||(p(""),d((t=>(0,J.jM)(t,(t=>{t.push(e)})))))},onStop:e=>{if(f.current)return;g();const t=e.join("\n");t.length?i(t):i()},onError:t=>{f.current||e(t)}}}).then((e=>{f.current?e.abort():(m.current=e,t.play(),o())}),e)}),[r,t,o,i,a,n]),x=(0,s.useCallback)((()=>{l(!1),m.current?.stop(),m.current=void 0,t?.pause()}),[t]),b=(0,s.useCallback)((()=>{f.current=!0,l(!1),m.current?.abort(),m.current=void 0}),[]);return(0,s.useEffect)((()=>b),[b]),{start:y,stop:x,abort:b,running:a,mediaText:h,allSentences:c,interimSentence:u}}const Vt=new Fe.y("videoLimit",1/0);let Yt="";function Kt(e){e.show({action:{text:"开通会员",onClick:q.$},message:`非会员每七天只能翻译 ${Vt.max} 个音视频，下次重置时间：${Vt.dateEnd}。成为会员即可解除此限制。`,intent:"primary",timeout:0})}function qt(e){const{disabled:t,toaster:n}=e,{start:s,stop:r,running:o,mediaText:i,allSentences:a,interimSentence:l}=Ut(e);return(0,R.jsxs)("div",{children:[(0,R.jsxs)("div",{children:[o&&(0,R.jsx)(P.$,{disabled:t,icon:"stop",intent:"primary",onClick:r,children:"停止识别并翻译"}),!o&&(0,R.jsxs)(P.$,{disabled:t,icon:"play",intent:"primary",onClick:()=>{Vt.isOver().then((e=>{e?Kt(n):s()}))},children:["播放",i,"并开始识别"]})]}),(0,R.jsxs)("div",{children:[a.map(((e,t)=>(0,R.jsx)("div",{children:e},t))),(0,R.jsx)("span",{style:{opacity:.6},children:l})]})]})}var Xt=n(26964);function Zt(e){const{disabled:t,serviceImplement:n,onStop:r,toaster:o}=e,{start:i,abort:a,running:l,mediaText:c,allSentences:d,interimSentence:u}=Ut(e),p=!n.service.realtime,h=t||p,f=d[d.length-1],[m,g]=(0,s.useState)({text:"正在等待识别出一个完整的句子……",result:""});return(0,s.useEffect)((()=>{if(!f)return;let e=!1;return g({text:f,result:"正在翻译，请稍候……"}),(0,ie._)({action:"translate",data:{apiCode:"GoogleWeb",text:f}}).then((t=>{if(e)return;const n=t.error?t.error.message:t.result?.join("")||"没有翻译结果";g({text:f,result:n})}),(t=>{e||g({text:f,result:t.message})})),()=>{e=!0}}),[f]),(0,R.jsxs)("div",{children:[p&&(0,R.jsxs)(D.P,{intent:"primary",children:[n.service.name,"不支持实时翻译功能，请选择名称中带有“实时语音识别”的服务。"]}),!l&&(0,R.jsxs)(P.$,{intent:"primary",icon:"play",disabled:h,onClick:()=>{Vt.isOver().then((e=>{e?Kt(o):i()}))},children:["播放",c,"并开始实时翻译"]}),l&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(P.$,{intent:"primary",icon:"stop",onClick:()=>{a(),r()},children:"停止实时翻译"}),(0,R.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",textAlign:"center",color:"white"},children:(0,R.jsxs)("div",{style:{width:"80%",margin:"0 auto"},children:[(0,R.jsx)("div",{style:{marginBottom:10,fontSize:18},children:(0,R.jsx)("span",{style:{backgroundColor:"rgba(0,0,0,0.8)"},children:m.text})}),(0,R.jsx)("div",{style:{fontSize:24},children:(0,R.jsx)("span",{style:{backgroundColor:"rgba(0,0,0,0.8)"},children:m.result})})]})})]}),(0,R.jsx)("div",{style:{opacity:.6},children:u})]})}var Jt=n(6839),Gt=function(e){return e.PerSentence="0",e.Realtime="1",e}(Gt||{});const Qt={[Gt.PerSentence]:"逐句翻译",[Gt.Realtime]:"实时翻译"};function en(e){const{onText:t}=e,[n]=(0,s.useState)((()=>Array.from(document.querySelectorAll("video,audio")))),[r,o]=(0,s.useState)(0),[i,a]=(0,s.useState)(Gt.PerSentence),[l,c]=(0,s.useState)(We.eA.TencentRealtime),[d,u]=(0,s.useState)(Jt.AH),[p,h]=(0,s.useState)(Jt.aN.defaultLang),[f,m]=(0,s.useState)(!1),g=Xt.B9[l];(0,s.useEffect)((()=>{u(Xt.xL[g.service.id]),h(g.service.defaultLang)}),[g]);const y=(0,s.useCallback)((()=>{m(!0),function(){const e=window.location.href;Yt!==e&&(Yt=e,Vt.addOne())}()}),[]),x=(0,s.useCallback)((e=>{m(!1),e&&t(e)}),[t]),b=n[r],w=!b,v=l===We.eA.WebSpeech,T=w||v;(0,s.useEffect)((()=>{b?.pause()}),[b]);const S=b instanceof HTMLAudioElement?"音频":"视频";return(0,R.jsxs)(R.Fragment,{children:[w&&(0,R.jsx)(D.P,{intent:"primary",style:{marginBottom:10},children:"当前页面没有视频或音频。"}),v&&(0,R.jsxs)(D.P,{intent:"primary",style:{marginBottom:10},children:[g.service.name,"不支持音视频翻译功能，请选择其它语音服务。"]}),n.length>1&&(0,R.jsxs)("div",{children:["选择要翻译的音 / 视频：",(0,R.jsx)(ht.g,{disabled:f,value:r,onChange:e=>{const t=Number(e.currentTarget.value);o(t)},children:n.map(((e,t)=>(0,R.jsx)("option",{value:t,children:t},t)))})]}),(0,R.jsxs)(Ht.z,{inline:!0,className:"translate-type-selector",label:"翻译方式：",selectedValue:i,onChange:e=>{a(e.currentTarget.value)},disabled:f||T,children:[Object.keys(Qt).map((e=>(0,R.jsx)(we.sx,{value:e,children:Qt[e]},e))),(0,R.jsx)("a",{href:"https://hcfy.ai/docs/guides/video/",target:"_blank",rel:"noreferrer",children:"查看使用说明"})]}),(0,R.jsxs)("div",{children:["选择要使用的语音识别服务：",(0,R.jsx)(ht.g,{disabled:f||T,value:l,onChange:e=>{c(e.currentTarget.value)},children:Xt.OR.map((e=>(0,R.jsx)("option",{value:e.id,children:e.name},e.id)))})]}),(0,R.jsxs)("div",{children:["选择",S,"的语种：",(0,R.jsx)(ht.g,{disabled:f||T,value:p,onChange:e=>{h(e.currentTarget.value)},children:Object.keys(d).map((e=>(0,R.jsx)("option",{value:e,children:d[e]},e)))})]}),i===Gt.PerSentence&&(0,R.jsx)(qt,{toaster:e.toaster,disabled:T,mediaElement:b,serviceImplement:g,lang:p,onStart:y,onStop:x}),i===Gt.Realtime&&(0,R.jsx)(Zt,{toaster:e.toaster,disabled:T,mediaElement:b,serviceImplement:g,lang:p,onStart:y,onStop:x})]})}function tn(e){const{show:t,onClose:n,onText:r}=e,[o,i]=(0,s.useState)(null),a=(0,s.useRef)();return(0,s.useEffect)((()=>{o&&(t?Vt.isOver().then((e=>{e?(n(),Kt(o)):a.current=o.show({message:(0,R.jsx)(en,{onText:r,toaster:o}),timeout:0,onDismiss:()=>{a.current=void 0,n()}},a.current)})):a.current&&o.dismiss(a.current))}),[n,r,t,o]),(0,R.jsx)(ve.V,{position:"bottom-right",ref:i,className:"app-toaster-container",usePortal:!1})}const nn=3e3,sn=new Fe.y("crossTranslateLimit",nn);function rn(e){const[t,n]=(0,s.useState)(null),[r,o]=(0,s.useState)(""),i=async e=>{const t=await sn.isOver(e);n(t),o(sn.dateEnd)};return(0,s.useEffect)((()=>{i()}),[]),t?(0,R.jsxs)("div",{style:{textAlign:"center",padding:15},children:[(0,R.jsxs)("p",{children:["非会员用户每七天只能使用 ",nn," ","次网页划词功能，下次重置时间：",r,"。成为会员即可解除此次数限制。"]}),(0,R.jsx)("p",{children:(0,R.jsx)(P.$,{onClick:q.$,intent:"primary",text:"开通会员"})}),(0,R.jsx)("p",{className:`${a.E4k} ${a.KJG}`,children:"开通会员或到达重置时间后，点击下方按钮即可恢复使用。"}),(0,R.jsx)(P.$,{onClick:()=>{i()},children:"确认开通 / 重置状态"})]}):e.children((()=>{i(!0)}))}const on={...b()(w.g2,["button","closeAfterMove","disableInTextarea","domainBlackList","domainWhiteList","textList","placement","pin","pinPos","pinIgnoreDomainList","showTextArea","panelSize","modifierKeys","modifierKeyPressedAction","modifierKeyTranslate","modifierKeyLink","ocrService","panelButtons","charsLimit","pageTrsPanelPos","pinEnhance"]),...b()(w.Ne,["hoverTranslate"])};function an(e,t,n,s){return!(!e&&!n)&&!s?.some((e=>e.test(t)))}function ln(e){const{pin:t,onClick:n,size:s}=e;return(0,R.jsx)("div",{className:"switch-pin",children:(0,R.jsx)(P.$,{icon:(0,R.jsx)(O.I,{icon:"pin",size:ce[s]}),small:"small"===s,large:"large"===s,minimal:!0,active:t,onClick:n})})}const cn=new class{topParsedData=null;activeFrameIndex=null;msgMap=new Map;listeners=null;constructor(){this.topWorker=new je.Z((e=>{Re("收到来自顶层 worker 发送的消息",e),this.sendMsg(e)})),this.messagePassingBetweenFrames=new Ne.B,this.messagePassingBetweenFrames.on("message",(e=>{const t=e;t&&(Re("收到来自 iframe worker 发送的消息",t),this.sendMsg(t))}))}sendMsg(e){switch(e.type){case"HCFY_SELECTION_EVENT_MOUSEDOWN":this.clearSelectionData(),this.listeners?.onMouseDown(e.event);break;case"HCFY_SELECTION_EVENT_RECEIVE_SELECTION_INFO":const{parsedData:t,activeFrameIndex:n}=Le(e.data);this.topParsedData=t?.isTop?t:null,this.activeFrameIndex=n;const{reason:s}=e.meta;if("mouseup"===s)t&&this.listeners?.onMouseUp(t,t.mouseUpEvent);else if("hover"===s)t&&this.listeners?.onHoverSelection(t);else if("proactive"===s){const n=e.meta.mid;if(n){const e=this.msgMap.get(n);e&&(this.msgMap.delete(n),e(t||void 0))}}break;case"HCFY_SELECTION_EVENT_SCROLL":if(this.topParsedData)this.listeners?.onScroll(this.topParsedData,e.event);else if(this.isTopFrameActivated()){const t=this.getInfoSync();t&&this.listeners?.onScroll(t,e.event)}else this.getInfo().then((t=>{t&&this.listeners?.onScroll(t,e.event)}));break;case"HCFY_SELECTION_EVENT_ESC_KEY":this.clearSelectionData(),this.listeners?.onEsc();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_ACTIVE":this.listeners?.onModifierKeysActive();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_RELEASED":this.listeners?.onModifierKeysReleased();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_INTERRUPTED":this.listeners?.onModifierKeysInterrupted()}}isTopFrameActivated(){return-1===this.activeFrameIndex?.[0]}getInfoSync(){const e=this.topWorker.sendMsg({type:"HCFY_SELECTION_EVENT_REPORT_INFO_PROACTIVE",mid:"sync"});if(e)return Le(e.data).parsedData}getInfo(){return new Promise((e=>{if(!this.activeFrameIndex)return void e(void 0);if(this.isTopFrameActivated())return void e(this.getInfoSync());const t=ke()();this.msgMap.set(t,e),this.messagePassingBetweenFrames.tell({type:"HCFY_SELECTION_EVENT_REPORT_INFO_PROACTIVE",mid:t},this.isTopFrameActivated()?"top":this.activeFrameIndex.reverse().slice(1))}))}clearSelectionData(){this.topParsedData=null}sendToAllFrames(e){this.topWorker.sendMsg(e),this.messagePassingBetweenFrames.tell(e,"all")}disableLink(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_DISABLE_LINK"})}enableLink(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_ENABLE_LINK"})}enableHoverTranslate(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_ENABLE_HOVER_TRANSLATE"})}disableHoverTranslate(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_DISABLE_HOVER_TRANSLATE"})}};function dn(e){const{portalContainer:t}=e,[n,o]=(0,y.A)(on),i="tesseractocr"===n?.ocrService,l=n?.button,c=n?.closeAfterMove||on.closeAfterMove,d=n?.domainBlackList,u=n?.domainWhiteList,p=n?.textList,h=n?.placement||on.placement,f=n?n.pin:on.pin,m=n?n.pinIgnoreDomainList:on.pinIgnoreDomainList,g=n?n.pinEnhance:on.pinEnhance,x=n?.panelSize||on.panelSize,b="small"===x,w="large"===x,v=(0,s.useMemo)((()=>p?.reduce(((e,t)=>(t.enabled&&e.push(new RegExp(t.value)),e)),[])),[p]),T=(0,s.useCallback)((e=>{o("function"==typeof e?t=>{t.pin=e(t.pin)}:{pin:e})}),[o]),[S,C]=(0,s.useState)(null),[E,_]=(0,s.useState)(!1),k=(0,s.useRef)(null),[j,N]=(0,s.useState)(),L=n?n.hoverTranslate:on.hoverTranslate,[A,z]=(0,s.useState)(void 0),M=(()=>{const e=window.location.href;return!!(0,Te.Ay)(e)||(!!(f&&m&&E)||(void 0!==u&&void 0!==d?function(e,t,n){const s=be(e,t,n);return!s.urlParts||s.whiteListMatched||!s.blackListMatched}(e,d,u):void 0))})();(0,s.useEffect)((()=>{if(f){function e(){z(window.innerHeight)}return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}z(void 0)}),[f]);const F=(0,s.useRef)(null);(0,me.A)(t),(0,me.A)(F.current);const[$,D]=(0,s.useState)(!1),[B,H]=(0,s.useState)(""),[W,U]=(0,s.useState)(null);async function Y(){const e=await cn.getInfo();e&&(N(e.range),q.current?.translate({type:"text",text:e.text}),_(!0))}(0,s.useEffect)((()=>{if(!t)return;const e=new r.y(t,a.iYh);return e.start(),()=>{e.stop()}}),[t]);const K=(0,s.useRef)(E),q=(0,s.useRef)(null);async function X(){H(await(0,ie._)({action:"take screenshot"})),D(!0)}(0,s.useEffect)((()=>(E&&!K.current&&chrome.storage.local.get("autoPlay").then((({autoPlay:e})=>{e&&q.current?.play()})),()=>{K.current=E})),[E]);const Z=(0,s.useCallback)((()=>{C(null),Y()}),[]);(0,s.useEffect)((()=>{(0,ie.x)((e=>{switch(e){case"translate":return void Z();case"getSelectionText":return cn.getInfo().then((e=>e?.text||""));case"screenshot translate":X();break;case"hover translate":o((e=>{e.hoverTranslate=!e.hoverTranslate}));break;case"page translate":te((e=>!e));break;case"video translate":re((e=>!e));break;case"play":q.current?.play()}}))}),[Z,o]),(0,s.useEffect)((()=>{function e(){cn.enableLink(),"hover"===n?.modifierKeyPressedAction&&o({hoverTranslate:!1})}void 0!==M&&void 0!==l&&v&&(cn.listeners={onMouseUp(e,t){if(n?.disableInTextarea&&(e.isInTextarea||e.isInContentEditable))return;if(n?.charsLimit&&e.text.length>n.charsLimit)return;const s=t&&"selection"===n?.modifierKeyPressedAction&&(0,Se.dw)(t,n.modifierKeys);an(M,e.text,s||!1,v)&&(E||!l||s||e.multiClick?Y():C(e.btnPos))},onMouseDown(){C(null),f&&g||_(!1)},onScroll(e,t){e.isTop&&t?.target===document||N(e.isTop?Object.assign({},e.range):e.range)},onEsc(){C(null),_(!1)},onModifierKeysActive(){n?.modifierKeyLink&&cn.disableLink(),"hover"===n?.modifierKeyPressedAction&&o({hoverTranslate:!0})},onModifierKeysReleased(){e(),n?.modifierKeyTranslate&&Z()},onModifierKeysInterrupted(){e()},onHoverSelection(e){an(!0,e.text,!1,v)&&Y()}})}),[l,M,v,E,n?.modifierKeyLink,n?.modifierKeyPressedAction,n?.modifierKeyTranslate,n?.modifierKeys,n?.disableInTextarea,n?.charsLimit,f,Z,o,g]),(0,s.useEffect)((()=>{fe.F||(L?cn.enableHoverTranslate():cn.disableHoverTranslate())}),[L]),(0,s.useEffect)((()=>{if(!E)return;if(!c)return;const e=()=>{_(!1)};return document.addEventListener("mousemove",e),()=>{document.removeEventListener("mousemove",e)}}),[E,c]);const J=()=>{_(!1)},G=()=>{o((e=>{const t=!e.pin;e.pin=t,window.setTimeout((()=>{t?k.current?.switch2pin():k.current?.clearPos()}))}))},Q=(0,R.jsx)(P.$,{className:"cut-btn",onClick:X,icon:(0,R.jsx)(O.I,{icon:"cut",size:ce[x]}),small:"small"===x,large:"large"===x,minimal:!0,title:"截图翻译"}),[ee,te]=(0,s.useState)(!1),ne=(0,R.jsx)(P.$,{className:"cut-btn",onClick:()=>te(!0),icon:(0,R.jsx)(O.I,{icon:"translate",size:ce[x]}),small:"small"===x,large:"large"===x,minimal:!0,title:"网页全文翻译"}),[se,re]=(0,s.useState)(!1),oe=(0,R.jsx)(P.$,{className:"cut-btn",onClick:()=>re(!0),icon:(0,R.jsx)(O.I,{icon:"video",size:ce[x]}),small:"small"===x,large:"large"===x,minimal:!0,title:"音视频翻译",style:{marginRight:2}}),ae=(0,s.useRef)(null);return(0,R.jsxs)("div",{id:"app",ref:F,children:[n&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(he,{btnPos:S,setBtnPos:C,onBtnClick:Z}),(0,R.jsx)(I,{show:E,pin:f,setMaxHeight:z,setPin:T,range:j,placement:h,ref:k,targetRef:ae,children:(0,R.jsx)(rn,{children:e=>(0,R.jsx)(de,{onTranslate:e,hasDragTip:!0,ref:q,elementRef:ae,style:{maxHeight:A},showOptionsTip:E,headerLeft:(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(ln,{pin:f,onClick:G,size:x}),n?.panelButtons.includes("cut")&&Q,n?.panelButtons.includes("translate")&&ne,n?.panelButtons.includes("video")&&oe]}),headerRight:(0,R.jsx)(P.$,{icon:(0,R.jsx)(O.I,{icon:"cross",size:ce[x]+4}),onClick:J,small:b,large:w,minimal:!0,title:"关闭(Esc)"}),extendOptions:(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(we.Sc,{inline:!0,large:w,label:"显示文本框",checked:n.showTextArea,onChange:e=>{o({showTextArea:e.target.checked})}}),(0,R.jsx)(we.Sc,{large:w,style:{marginRight:"0"},disabled:fe.F,label:"鼠标悬浮取词",inline:!0,checked:L,onChange:()=>o((e=>{e.hoverTranslate=!e.hoverTranslate}))})]}),showTextArea:n.showTextArea,toaster:W||void 0,size:x,portalContainer:t})})})]}),(0,R.jsx)(ve.V,{position:"top",ref:U,className:"app-toaster-container",usePortal:!1}),(0,R.jsx)(Bt,{open:ee,setOpen:te,portalContainer:t,pos:n?n.pageTrsPanelPos:on.pageTrsPanelPos}),(0,R.jsx)(Me,{isShow:$,setIsShow:D,isLocalOCR:i,imgSrc:B,portalContainer:t,onText:(e,t)=>{q.current?.translate({type:"image",dataURI:e}).then((()=>{const e=window.pageXOffset,n=window.pageYOffset;N({getBoundingClientRect(){const s=t.top-(window.pageYOffset-n),r=t.left-(window.pageXOffset-e);return{top:s,left:r,width:t.width,height:t.height,right:r+t.width,bottom:s+t.height}}}),_(!0)}),V())}}),(0,R.jsx)(tn,{show:se,onClose:()=>re(!1),onText:e=>{q.current?.translate({type:"text",text:e}),_(!0)}})]})}var un=n(69791),pn=n.n(un);var hn=n(42631);function fn(){return(0,R.jsx)(hn.A,{id:"__hcfy__",stylesheetURLs:["blueprint-select.css","cropper.css"],cssText:(e=pn(),e.replace(/url\((["']?)(.*?)\1\)/g,(function(e,t,n){return n.startsWith("data:")?e:`url(${chrome.runtime.getURL(n)})`}))),children:e=>(0,R.jsx)(dn,{portalContainer:e||void 0})});var e}},81100:(e,t,n)=>{"use strict";n.d(t,{A:()=>a,F:()=>i});var s=n(12784),r=n.n(s);const o=document.caretPositionFromPoint?function(e,t){const n=document.caretPositionFromPoint(e,t);return n&&{offsetNode:n.offsetNode,offset:n.offset}}:document.caretRangeFromPoint?function(e,t){const n=document.caretRangeFromPoint(e,t);return n&&{offsetNode:n.startContainer,offset:n.startOffset}}:void 0;const i=!o;class a{constructor(e,t=1e3,n,s=document.body){this.destroyed=!1,this.context=s,this.onMouseMove=r()((t=>{n&&!t[n]||(!function(e,t){if(!o)return null;const n=window.getSelection();if(!n)return null;const s=o(e,t);if(!s)return null;const{offset:r,offsetNode:i}=s;if(i.nodeType!==Node.TEXT_NODE)return null;const a=n.rangeCount>0?n.getRangeAt(0):void 0;n.removeAllRanges();const l=document.createRange();l.setStart(i,r),l.setEnd(i,r),n.addRange(l),n.modify("move","backward","word"),n.modify("extend","forward","word");const c=n.getRangeAt(0).getBoundingClientRect();(c.left>e||c.left+c.width<e||c.top>t||c.top+c.height<t)&&(n.removeAllRanges(),a&&n.addRange(a))}(t.clientX,t.clientY),e(t))}),t),s.addEventListener("pointermove",this.onMouseMove)}destroy(){this.destroyed=!0,this.context.removeEventListener("pointermove",this.onMouseMove)}}},23593:(e,t,n)=>{"use strict";n.d(t,{c_:()=>i,dw:()=>l,ot:()=>c});n(85100),n(27162),n(66403),n(94154),n(64777),n(16465),n(62896);var s=n(30819),r=n(20124);const o=n.n(r)()("hotkeys"),i={ctrl:s.U0?"metaKey":"ctrlKey",alt:"altKey",shift:"shiftKey"},a={ctrl:s.U0?s.gm?[224]:[91,93]:[17],alt:[18],shift:[16]};function l(e,t){return!(!t||!t.length)&&t.every((t=>e[i[t]]))}function c(e,t,n,s){const r=new Set;let i=!1;function l(){r.clear(),i?(i=!1,o("辅助键处于激活状态，执行中断回调"),s()):o("辅助键未处于激活状态")}function c(){o("页面失去了焦点，执行中断操作"),l()}function d(n){const s=n.keyCode,c=r.size;if(!e.some((e=>{if(a[e].includes(s))return r.add(e),!0})))return o("按下了不是辅助键的其它键，执行中断操作"),void l();c!==r.size&&(o("按下了新的辅助键，当前已经按下的辅助键：",[...r]),r.size===e.length&&(o("全部辅助键已按下，将辅助键改为激活状态，并执行辅助键按下回调"),i=!0,t()))}function u(t){const s=t.keyCode,l=r.size;if(!l)return;e.some((e=>{if(a[e].includes(s))return r.delete(e),!0}))&&l!==r.size&&(o("松开了新的辅助键，当前已经按下的辅助键：",[...r]),i=!1,e.length-r.size==1&&(o("一个辅助键已松开，执行辅助键松开回调"),n()))}return window.addEventListener("keydown",d),window.addEventListener("blur",c),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",d),window.removeEventListener("blur",c),window.removeEventListener("keyup",u)}}},30819:(e,t,n)=>{"use strict";n.d(t,{KA:()=>o,U0:()=>r,UP:()=>i,gm:()=>a});const s=navigator.userAgent,r=s.includes("Mac"),o=s.includes("Chrome"),i=s.includes("Edg"),a=s.includes("Firefox")},42631:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var s=n(16089),r=n(79482),o=n.n(r),i=n(14041),a=n(31085);function l(e){const{children:t,id:n,stylesheetURLs:r,cssText:l}=e,[c,d]=(0,i.useState)(null),u=(0,i.useRef)(null);return(0,i.useEffect)((()=>{const e=document.getElementById("dark-mode");if(!e)return;const t=()=>{if(e.getAttribute("href")){const e=u.current?.shadowRoot;e&&setTimeout((()=>{e.adoptedStyleSheets=[]}),800)}};t();const n=new MutationObserver(t);return n.observe(e,{attributeFilter:["href"]}),()=>{n.disconnect()}}),[]),(0,a.jsxs)(s.Ay.div,{style:{all:"initial"},id:n,ref:u,children:[(0,a.jsx)("style",{children:o()}),(0,a.jsx)("link",{rel:"stylesheet",href:chrome.runtime.getURL("normalize.css")}),(0,a.jsx)("link",{rel:"stylesheet",href:chrome.runtime.getURL("blueprint.css")}),r?.map((e=>(0,a.jsx)("link",{rel:"stylesheet",href:chrome.runtime.getURL(e)},e))),l&&(0,a.jsx)("style",{children:l}),(0,a.jsx)("div",{id:"root",ref:d,dir:"ltr",children:t(c)})]})}},64795:(e,t,n)=>{"use strict";n.d(t,{D:()=>r,W:()=>o});var s=n(14041);function r(e){return{h:e.scrollWidth>e.clientWidth,v:e.scrollHeight>e.clientHeight}}function o(e){const[t,n]=(0,s.useState)({v:!1,h:!1});return(0,s.useEffect)((()=>{if(!e)return;const t=()=>{n(r(e))};t();const s=new ResizeObserver(t);return s.observe(e),()=>{s.unobserve(e)}}),[e]),t}},94903:(e,t,n)=>{"use strict";n.d(t,{a:()=>o,r:()=>i});var s=n(71651),r=n(62337);let o=function(e){return e.both="both",e.source="source",e.result="result",e}({});class i{inited=!1;valid=!0;isOnlyChild=!1;destroyed=!1;innerText="";translating=!1;translated=!1;inline=!1;showType=o.source;#e;#t;constructor(e,t,n,s){this.rootNode=e,this.sourceNodes=t,this.translateFn=n,this.#e=new r.HT,this.#e.props.editable=null!=s?.editable&&s.editable,this.#e.props.onRetry=()=>this.retry(),function(e,t,n){const s=n.nextSibling;s?e.insertBefore(t,s):e.appendChild(t)}(e,this.#e.container,t[t.length-1])}init(){this.destroyed||this.inited||(this.calcInnerText(),this.valid=function(e){const t=e.trim();return!!t&&!/^[0-9\s.\-_#:()!•+~@$%^&*\n\/`]+$/.test(t)}(this.innerText),this.valid||this.destroy(),this.inited=!0)}calcInnerText(){const{sourceNodes:e,rootNode:t}=this;let n;if(this.isOnlyChild){const e=this.showType;this.switchShowType(o.source),n=function(e){if(e instanceof HTMLElement)return e.innerText;const t=document.createElement("hcfy-result");Array.from(e.childNodes).forEach((e=>{t.appendChild(e)})),e.appendChild(t);const n=t.innerText;return e.removeChild(t),Array.from(t.childNodes).forEach((t=>{e.appendChild(t)})),n}(t).trim(),this.switchShowType(e)}else{const t=document.createElement("span");e.forEach((e=>{t.appendChild(e)})),document.documentElement.appendChild(t),n=t.innerText.trim(),document.documentElement.removeChild(t),this.showType!==o.result&&this.appendSourceNodes()}this.innerText=n}setOnlyChild(){if(this.destroyed)return;const{rootNode:e}=this;this.isOnlyChild=!0,this.inited&&this.calcInnerText(),e instanceof Element&&("span"===e.nodeName.toLowerCase()||function(e,t,n=3){let s=e,r=0;do{if(r+=1,s.matches(t))return s;if(r===n)return null;s=s.parentElement}while(s);return null}(e,"a, button, [role=button], h1,h2,h3,h4,h5,h6"))&&(this.inline=!0,this.inited&&this.renderResult())}destroy(){this.switchShowType(o.source),this.removeResult(),this.#e.destroy(),this.destroyed=!0}renderResult(e){this.translating?this.#e.props.mode="hide":this.showType===o.both?this.#e.props.mode="comparison":this.showType===o.result?this.#e.props.mode="plain":this.#e.props.mode="hide",this.#e.props.comparison.newLine=!this.inline,e&&(this.#e.props.content=e),this.#e.render()}async translate(){if(this.inited||this.init(),this.destroyed||!this.innerText)return;if(this.translating||this.translated)return;let e;this.translating=!0;try{e=await this.translateFn(this.innerText)}catch(e){if(this.destroyed)return;if(this.translating=!1,this.translated=!0,this.renderResult({error:(0,s.sanitize)(e.message+(e.link?`<a target='_blank' href='${e.link.url}'>${e.link.name}</a>`:""),{ALLOWED_TAGS:["a","#text","b","i"],ALLOWED_ATTR:["target","rel","href","class"]}),type:"html"}),this.#t){const e=this.#t;this.#t=void 0,this.switchShowType(e)}return}if(!this.destroyed){if(this.translating=!1,null==e)return this.translate();if(this.translated=!0,this.renderResult({value:e,type:"text"}),this.#t){const e=this.#t;this.#t=void 0,this.switchShowType(e)}}}retry(){if(!this.translated)throw new Error("未翻译过");this.#t=this.showType,this.switchShowType(o.source),this.#e.props.content=void 0,this.#e.renderInner(),this.translated=!1,this.translate()}removeSourceNodes(){const{rootNode:e,sourceNodes:t}=this;t.forEach((t=>{try{e.removeChild(t)}catch(e){}}))}appendSourceNodes(){const{rootNode:e}=this,t=this.#e.container;this.sourceNodes.forEach((n=>{try{e.insertBefore(n,t)}catch(e){}}))}removeResult(){try{this.rootNode.removeChild(this.#e.container)}catch(e){}}switchShowType(e){if(this.destroyed||e===this.showType)return;if(!this.translated)return void(this.#t=e);const t=this.showType;switch(this.showType=e,e){case o.source:t===o.result&&this.appendSourceNodes(),this.#e.props.mode="hide",this.renderResult();break;case o.result:this.#e.props.mode="plain",this.renderResult(),this.removeSourceNodes();break;case o.both:this.#e.props.mode="comparison",this.renderResult(),t===o.result&&this.appendSourceNodes();break;default:throw this.showType=t,new TypeError(`不支持的显示类型：${e}`)}}}},17840:(e,t,n)=>{"use strict";function s(e,t=!0){return(t?e.slice(1):e).split("&").reduce(((e,t)=>{const[n,s]=t.split("=");return e[n]=s?decodeURIComponent(s):"",e}),{})}n.d(t,{q:()=>s})},65838:(e,t,n)=>{var s=n(36758),r=n(40935),o=n(20062),i=n(13974),a=n(23724),l=r(s),c=o(i),d=o(a);l.push([e.id,`#translate-panel{background-color:#f6f7f9;display:flex;flex-direction:column;padding-bottom:8px}.bp5-dark #translate-panel{background-color:#252a31}#translate-panel .fixed{flex-shrink:0;margin-bottom:10px}#translate-panel .body{flex-grow:1;overflow:auto;overscroll-behavior:contain}#translate-panel .body::-webkit-scrollbar{width:8px;background-color:rgba(0,0,0,0);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar:hover{background-color:rgba(0,0,0,.09)}#translate-panel .body::-webkit-scrollbar-thumb:vertical{background:rgba(0,0,0,.5);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar-thumb:vertical:active{background:rgba(0,0,0,.61);-webkit-border-radius:100px}#translate-panel.size-small,#translate-panel.size-small h6.bp5-heading,#translate-panel.size-small .bp5-control.bp5-large,#translate-panel.size-small textarea.bp5-input.bp5-small{font-size:14px}#translate-panel.size-small .phonetic-item,#translate-panel.size-small .quick-settings a{font-size:12px}#translate-panel.size-middle,#translate-panel.size-middle h6.bp5-heading,#translate-panel.size-middle .bp5-control.bp5-large,#translate-panel.size-middle textarea.bp5-input{font-size:18px}#translate-panel.size-middle .phonetic-item,#translate-panel.size-middle .quick-settings a{font-size:14px}#translate-panel.size-large,#translate-panel.size-large h6.bp5-heading,#translate-panel.size-large .bp5-control.bp5-large,#translate-panel.size-large textarea.bp5-input.bp5-large{font-size:22px}#translate-panel.size-large .source,#translate-panel.size-large .phonetic-item,#translate-panel.size-large .quick-settings a{font-size:18px}#translate-panel .bp5-button.bp5-small,#translate-panel .bp5-small .bp5-button{min-height:20px;min-width:20px}#translate-panel .header{display:flex;align-items:center;padding:4px 6px 4px 10px;border-bottom:1px solid #d1d1d1}.bp5-dark #translate-panel .header{border-bottom-color:rgba(17,20,24,.4)}#translate-panel .header .drag-block{min-width:5px;flex-shrink:0;flex-grow:1;align-self:stretch}#translate-panel .header .left{flex-shrink:0;display:flex}#translate-panel .header .right{flex-shrink:0;display:flex;align-items:center}#translate-panel .header .right .bp5-icon-arrow-right{flex-shrink:0;margin:0 5px}#translate-panel .header .right>.bp5-button{flex-shrink:0;margin:0 1px}#translate-panel .header .right>.bp5-button:last-child{margin-right:0}#translate-panel .quick-settings{padding:4px 9px;margin:0 1px}#translate-panel .quick-settings>div{margin-bottom:5px}#translate-panel .quick-settings .bp5-control{margin-bottom:0}#translate-panel .query-text{position:relative;padding:10px 10px 2px 10px}#translate-panel .query-text textarea.bp5-input{min-height:44px;font-family:system-ui,-apple-system,"Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";overscroll-behavior:contain}#translate-panel .query-text .translate-btn{position:absolute;opacity:.6}#translate-panel .query-text .translate-btn:hover{opacity:1}#translate-panel .body{padding:0 10px}#translate-panel .body .bp5-card:first-child{margin-top:1px}#translate-panel .body .bp5-card:last-child{margin-bottom:1px}#translate-panel .body .no-api{margin:20px 0}.result-block{margin:8px 0;padding:2px 5px}.result-block .bp5-button{visibility:hidden}.result-block .error .bp5-button,.result-block:hover .bp5-button{visibility:visible}.result-block .legend{display:flex;align-items:center;justify-content:space-between}.result-block .legend .legend-left{display:flex;align-items:center}.result-block .legend .api-ico,.result-block .legend .bp5-heading{flex-shrink:0;white-space:nowrap}.result-block .legend .api-ico{display:inline-block;width:14px;height:14px;background-size:contain;margin-right:3px}.result-block .legend .bp5-heading{margin-bottom:0;margin-right:10px}.result-block .legend .source{cursor:pointer;font-size:12px;display:inline-flex;align-items:center}.result-block .legend .source .source-text{overflow:hidden}.result-block .legend .source .bp5-icon{position:relative;top:-1px;margin-left:1px}.result-block .phonetic{display:flex;flex-wrap:wrap}.result-block .phonetic .phonetic-item{display:flex;align-items:center;font-size:12px}.result-block .phonetic .phonetic-item:not(:last-child){margin-right:12px}.result-block .common-result p{line-height:1.3;margin:2px 0;overflow-wrap:break-word}.result-block .common-result .dict a{text-decoration:underline}.result-block .error{font-size:12px;padding:5px 10px}.result-block .dict-pos{margin-right:5px}.external-translators{margin-bottom:3px;padding:0;display:flex;flex-wrap:wrap}.external-translators>div{margin:0 5px 5px 0}.quick-links a{margin:0 5px 5px 0}#popper-container{width:250px;max-width:100%;position:absolute;left:0;top:0;z-index:9999999998;touch-action:none;transition:opacity .2s;background-color:#f6f7f9}.bp5-dark #popper-container{background-color:#252a31}#popper-container.show{opacity:1;pointer-events:auto;user-select:auto}#popper-container,#popper-container[data-popper-reference-hidden=true]{opacity:0;pointer-events:none;user-select:none}#popper-container .drag-block{cursor:grab}#popper-container.pin{position:fixed}#popper-container.pin .arrow{display:none}#popper-container .arrow,#popper-container .arrow::before{position:absolute;width:8px;height:8px;z-index:-1}#popper-container .arrow::before{content:"";transform:rotate(45deg);background:#f6f7f9}.bp5-dark #popper-container .arrow::before{background-color:#252a31}#popper-container .arrow{display:none}#popper-container.show[data-popper-placement]:not([data-popper-reference-hidden=true]) .arrow{display:block}#popper-container[data-popper-placement^=top] .arrow{bottom:-5px}#popper-container[data-popper-placement^=top] .arrow::before{border-right:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#popper-container[data-popper-placement^=bottom] .arrow{top:-5px}#popper-container[data-popper-placement^=bottom] .arrow::before{border-left:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=left] .arrow{right:-5px}#popper-container[data-popper-placement^=left] .arrow::before{border-right:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=right] .arrow{left:-5px}#popper-container[data-popper-placement^=right] .arrow::before{border-left:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#translate-btn{display:none;position:absolute;z-index:9999999999;left:0;top:0}#translate-btn .bp5-button{padding:2px;min-width:0;min-height:0}#translate-btn .btn-icon{width:18px;height:18px;background-image:url(${c});background-size:contain}.bp5-dark #translate-btn .btn-icon{background-image:url(${d})}#translate-btn.show{display:block}.translate-type-selector .bp5-label{display:inline}.translate-type-selector .bp5-radio{margin-bottom:0}#ocr-container{position:fixed;z-index:99999999999999;left:0;top:0;right:0;bottom:0}#ocr-container .toolbar{display:none;position:absolute;z-index:1}#ocr-container img{max-width:100%}#app{cursor:default}.switch-pin{flex-shrink:0;cursor:pointer}.switch-pin .bp5-icon-pin{transition:transform .2s,color .2s;transform:rotate(-45deg)}.pin .switch-pin .bp5-icon-pin{transform:rotate(-70deg)}.cut-btn{margin-left:2px}.app-toaster-container{position:fixed !important;z-index:9999999999 !important}.app-toaster-container .bp5-toast{min-width:auto}#web-trs-panel .app-toaster-container{padding-right:0;padding-left:0}#web-trs-panel .page-trs-form-group{margin:0 0 0 0;align-items:center}#web-trs-panel .page-trs-form-group>label{width:70px}`,""]),e.exports=l},77239:(e,t,n)=>{var s=n(36758),r=n(40935)(s);r.push([e.id,'#root{-webkit-text-size-adjust:100%;box-sizing:border-box;font-size:14px;font-weight:400;letter-spacing:0;line-height:1.28581;text-transform:none;color:#182026;font-family:-apple-system,"BlinkMacSystemFont","Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Open Sans","Helvetica Neue","Icons16",sans-serif;touch-action:manipulation}#root>.bp5-portal{z-index:9999999999}',""]),e.exports=r},13974:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});const s=n.p+"logo.png"},23724:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});const s=n.p+"logowhite36.png"},69791:(e,t,n)=>{var s=n(65838);s&&s.__esModule&&(s=s.default),e.exports="string"==typeof s?s:s.toString()},79482:(e,t,n)=>{var s=n(77239);s&&s.__esModule&&(s=s.default),e.exports="string"==typeof s?s:s.toString()},67116:(e,t,n)=>{"use strict";n.d(t,{_:()=>r._,x:()=>s.x});var s=n(52304),r=n(47781)},52304:(e,t,n)=>{"use strict";n.d(t,{x:()=>a});var s=n(5090),r=n(20124),o=n(97933);const i=r("@hcfyapp/messaging:onMessage");function a(e){const t=(t,n,r)=>{const a=e=>{i("resolve",e),r({__messaging:!0,__messaging_resolve:e})},l=e=>{i("reject",e),r({__messaging:!0,__messaging_reject:(0,o.U)(e)})},c=e(t,{sender:n,resolve:a,reject:l});return(0,s.$X)(c)?(c.then(a,l),!0):c};return chrome.runtime.onMessage.addListener(t),()=>{chrome.runtime.onMessage.removeListener(t)}}},97933:(e,t,n)=>{"use strict";function s(e){return null==e?e:"object"==typeof e&&"toJSON"in e&&"function"==typeof e.toJSON?e.toJSON():e instanceof Error?{name:e.name,message:e.message}:e}n.d(t,{U:()=>s})},96959:(e,t,n)=>{"use strict";n.d(t,{H:()=>c});var s=n(31085),r=n(14041);n(60807),n(1729);function o(e,t,n,s="text"){const[o,i]=(0,r.useState)(!1);return function(e,t){const n=(0,r.useRef)(null),s=(0,r.useRef)(t);(0,r.useEffect)((()=>{s.current=t}),[t]),(0,r.useEffect)((()=>{if(!e)return;const t=t=>{n.current={x:t.pageX,y:t.pageY},e.addEventListener("pointerup",r)},r=t=>{e.removeEventListener("pointerup",r);const o=n.current;o&&(n.current=null,o.x===t.pageX&&o.y===t.pageY&&s.current())};return e.addEventListener("pointerdown",t),()=>{e.removeEventListener("pointerdown",t),e.removeEventListener("pointerup",r)}}),[e])}(t?e:null,(()=>{i(!0)})),(0,r.useEffect)((()=>{t||i(!1)}),[t]),(0,r.useEffect)((()=>{o&&e&&e.focus()}),[e,o]),(0,r.useEffect)((()=>{if(!o||!e)return;const t=t=>{const n=t.target;e.contains(n)||i(!1)};return document.addEventListener("pointerup",t),()=>{document.removeEventListener("pointerup",t)}}),[o,e]),(0,r.useEffect)((()=>{if(!o||!e||!n)return;const t=e=>{const t=e.target;n({value:"html"===s?t.innerHTML:t.innerText,type:s})};return e.addEventListener("input",t),()=>{e.removeEventListener("input",t)}}),[e,o,n,s]),t?{isEditing:o,props:{contentEditable:o?"true":void 0}}:{isEditing:o}}const i={visibility:"visible"};function a(e){const{content:t,onRetry:n,editable:a,onEdit:l}=e,[c,d]=(0,r.useState)(null),{isEditing:u,props:p}=o(c,a&&!!t&&"value"in t,l,t?.type);return(0,r.useEffect)((()=>{if(u&&c)return c.closest("hcfy-result").classList.add("__hcfy-result-editing__"),()=>{c.closest("hcfy-result").classList.remove("__hcfy-result-editing__")}}),[c,u]),t?(0,s.jsxs)(s.Fragment,{children:["html"===t.type?(0,s.jsx)("hcfy-result-content",{style:i,ref:d,...p,dangerouslySetInnerHTML:{__html:"value"in t?t.value:t.error}}):(0,s.jsx)("hcfy-result-content",{style:i,ref:d,...p,children:"value"in t?t.value:t.error}),(0,s.jsx)("hcfy-result-actions",{style:i,children:"error"in t&&(0,s.jsx)("button",{onClick:n,children:"点击重试"})})]}):null}var l=n(25873);class c{container;#n;props;constructor(){const e=document.createElement("hcfy-result");e.style.display="none";const t=(0,l.H)(e);this.container=e,this.#n=t,this.props={mode:"hide",comparison:{newLine:!0},editable:!1}}renderContainer(){switch(this.props.mode){case"hide":this.container.style.display="none",this.container.className="";break;case"plain":this.container.style.display="inline-block",this.container.className="";break;case"comparison":this.container.style.display=this.props.comparison.newLine?"block":"inline-block",this.container.className="__hcfy-result-comparison__ "+(this.props.comparison.newLine?"__hcfy-result-comparison-block__":"__hcfy-result-comparison-inline__")}}renderInner(){this.#n.render((0,s.jsx)(a,{content:this.props.content,editable:this.props.editable,onEdit:e=>{this.props.onEdit?.(e),this.props.content=e},onRetry:this.props.onRetry}))}render(){this.renderContainer(),this.renderInner()}destroy(){this.#n.unmount()}}},54493:(e,t,n)=>{"use strict";n.d(t,{O:()=>r,P9:()=>s,PD:()=>c,UU:()=>i,Zi:()=>a,dd:()=>l,pb:()=>o});const s="",r=".__hcfy-result-comparison__ {\n  outline: 1px dotted;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}",o=".__hcfy-result-comparison__ {\n  outline: 1px dotted var(--hcfy-result-main-color, #008B45);\n}\n\n.__hcfy-result-comparison__ hcfy-result-content {\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ {\n  margin-left: 0.4em;\n}",i=".__hcfy-result-comparison__ hcfy-result-content {\n  text-decoration: var(--hcfy-result-main-color, #008B45) wavy underline;\n  text-underline-offset: 0.2em;\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ hcfy-result-content {\n  text-decoration: none;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ hcfy-result-content {\n  margin-left: 0.4em;\n}",a=".__hcfy-result-comparison__ hcfy-result-content {\n  text-decoration: var(--hcfy-result-main-color, #008B45) underline;\n  text-underline-offset: 0.2em;\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ hcfy-result-content {\n  text-decoration: none;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ hcfy-result-content {\n  margin-left: 0.4em;\n}",l=".__hcfy-result-comparison__ hcfy-result-content {\n  background-color: var(--hcfy-result-main-color, #008B45);\n  color: var(--hcfy-result-text-color, white);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ hcfy-result-content {\n  background: unset;\n  color: unset;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ hcfy-result-content {\n  margin-left: 0.4em;\n}",c=".__hcfy-result-comparison__ {\n  border-left: 3px solid var(--hcfy-result-main-color, #008B45);\n  padding-left: 6px;\n}\n\n.__hcfy-result-comparison__ hcfy-result-content {\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-comparison-block__ {\n  padding: 6px 0 6px 12px;\n}\n\n.__hcfy-result-comparison-inline__ {\n  margin-left: 0.4em;\n}\n\n.__hcfy-result-editing__ {\n  border-left-color: transparent;\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}"},62337:(e,t,n)=>{"use strict";n.d(t,{HT:()=>s.H,dd:()=>r.dd,pb:()=>r.pb,O:()=>r.O,Zi:()=>r.Zi,P9:()=>r.P9,PD:()=>r.PD,UU:()=>r.UU});var s=n(96959),r=n(54493)},5090:(e,t,n)=>{"use strict";n.d(t,{Z5:()=>d,NF:()=>u,Z4:()=>i.Z,$X:()=>o.$,$2:()=>l.$,qs:()=>s.qs,_:()=>a._,fm:()=>r.f});var s=n(37767),r=(n(29516),n(64347)),o=n(85981),i=n(2643),a=n(74976),l=n(73109);n(12980),n(51934),n(99687);class c extends Error{request;response;url;constructor(e,t,n){const s=t instanceof Response;var r;super(s?`Request failed with status code ${t.status}.`:(r=t)instanceof Error?r.message:"Unknown error. See `error.cause` for details."),this.request=n,this.url=e,this.name="FetchError",s?this.response=t:this.cause=t}}function d(e,t){return fetch(e,t).then((n=>{if(!n.ok)throw new c(e,n,t);return n}),(n=>{throw new c(e,n,t)}))}function u(e){return e instanceof c}},85981:(e,t,n)=>{"use strict";function s(e){return"function"==typeof e?.then}n.d(t,{$:()=>s})},37767:(e,t,n)=>{"use strict";n.d(t,{qs:()=>r});n(69375);var s=n(17546);function r(e){const t=[];return s(e,((e,n)=>{const s=Array.isArray(e)?e:[e];t.push(...s.map((e=>`${n}=${null==e?"":encodeURIComponent(e)}`)))})),t.join("&")}},74976:(e,t,n)=>{"use strict";n.d(t,{_:()=>s});const s=AbortSignal.timeout?function(e){return AbortSignal.timeout(e)}:function(e){const t=new AbortController;return setTimeout((()=>{t.abort()}),e),t.signal}}}]);