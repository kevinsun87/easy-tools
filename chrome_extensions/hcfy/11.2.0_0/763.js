"use strict";(globalThis.webpackChunkbrowser_extension=globalThis.webpackChunkbrowser_extension||[]).push([[763],{50657:(e,t,a)=>{a.d(t,{pR:()=>l});a(69375);var s=a(56357),n=a(72431),r=a(34975),i=a(20843),o=a(5090);const l=!0,c={id:n.P2.BaiDu,name:"百度文字识别",package:!0,points:!0,secretKeys:{get:()=>chrome.storage.local.get({baiDuOCRKey:[]}).then((({baiDuOCRKey:e})=>(Array.isArray(e)?e:[e]).map((e=>({id:e.key,key:e.secret}))))),set:e=>chrome.storage.local.set({baiDuOCRKey:e.map((e=>({key:e.id,secret:e.key})))}),isComplete:e=>(0,i.hP)(e,["id"])},pointsEnable:{get:()=>chrome.storage.local.get({bdOcrPoints:l}).then((({bdOcrPoints:e})=>e)),set:e=>chrome.storage.local.set({bdOcrPoints:e})}};class u extends s.m{constructor(){super(c,!0)}async callByPackage(e){const t=await(0,o.Z5)("https://hs-api.limingkai.cn/v2/services/baidu/ocr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e.image,paragraph:!0,language_type:"auto_detect"})}),a=await t.json();if(!(0,r.E)(a))throw new Error("识别图片时出错了，错误消息："+a.error_msg);return a}async callBySecretKey(e,t){const a=await(0,r.l)(e,{image:t.image,paragraph:!0,language_type:"auto_detect"});if((0,r.E)(a))return a;throw new Error("识别图片时出错了，错误消息："+a.error_msg)}transform(e){if(!e.paragraphs_result)throw new Error("百度文字识别服务配置有误，请确认你领取过免费资源包，且密钥填写无误。");return e.paragraphs_result.reduce(((t,{words_result_idx:a})=>(t.push(a.reduce(((t,a)=>t+e.words_result[a].words),"")),t)),[]).join("\n")}}new u},24671:(e,t,a)=>{a.d(t,{HO:()=>d,Zj:()=>c,ql:()=>m,u8:()=>x});a(69375);var s=a(20124),n=a.n(s),r=a(72431),i=a(5270);const o=n()("web-speech"),l=window.SpeechRecognition||window.webkitSpeechRecognition,c=!!l;var u=function(e){return e.zh="cnm-Hans-CN",e.enUS="en-US",e.ja="ja-JP",e.ko="ko-KR",e.fr="fr-FR",e.de="de-DE",e.ru="ru-RU",e}(u||{});const d={[u.zh]:"中文(简体)",[u.enUS]:"英语(美国)",[u.ja]:"日语",[u.ko]:"韩语",[u.fr]:"法语",[u.de]:"德语",[u.ru]:"俄语"},p={"audio-capture":"你的电脑没有连接麦克风。","no-speech":"没有检测到语音。","not-allowed":"请在浏览器询问是否允许使用麦克风时选择“允许”。如果你之前选择过“禁止”，请点击浏览器地址栏左侧的锁或感叹号图标，然后将“麦克风”改为“允许”。如果浏览器从未询问过，则说明当前页面由于未知的原因不允许使用麦克风。","service-not-allowed":"你的浏览器当前不允许使用划词翻译的内置语音识别服务。",network:"网络出错，请检查你的网络连接。注意：划词翻译内置的语音转文字服务需要能连接外网才可使用。","language-not-supported":"你的浏览器不支持识别此语种。",aborted:"识别过程被中断了。","bad-grammar":"语法错误。"},h=/\S/;const m={id:r.eA.WebSpeech,name:"划词翻译内置语音转文字",realtime:!0,defaultLang:u.zh};class g extends i.L{constructor(){super(m)}async microphone(e){const{lang:t,options:a}=e;if(!c)throw new Error("划词翻译的内置语音转文字服务不支持在 Firefox 上使用，请选用腾讯云语音转文字服务。");let s=!1,n=!1;const r=new l;r.lang=t,r.interimResults=!!a.onInterim,r.continuous=!a.stopOnFirstSentence,r.addEventListener("error",(e=>{o("error 事件",e),"aborted"===e.error&&s||(s=!0,a.onError?.(new Error(`${p[e.error]||e.error+". "}${e.message||""}`)))}));const i=[];return r.addEventListener("result",(e=>{const t=e.results[e.resultIndex],s=t[0].transcript;if(t.isFinal){const e=s.replace(h,(function(e){return e.toUpperCase()}));o("识别到一句完整的话：",e),a.onSentence?.(e),i.push(e)}else o("识别到一句话的临时结果：",s),a.onInterim?.(s)})),r.addEventListener("nomatch",(e=>{o("nomatch 事件",e),n=!0,a.onError?.(new Error(`${this.service.name}无法准确识别你的语音，请确保在安静的环境中，并吐字清晰。`))})),r.addEventListener("end",(e=>{o("end 事件",e,"识别出来的文本：",i,`是否已经中断：${s}`,`是否已经 nomatch：${n}`),s||n||a.onStop?.(i)})),r.start(),{stop:()=>{o("调用 stop 方法"),r.stop()},abort:()=>{o("调用 abort 方法"),s=!0,r.abort()}}}mediaStream(e){return Promise.reject(new Error("划词翻译的内置语音转文字服务只支持通过麦克风使用。"))}}const x=new g},74070:(e,t,a)=>{a.d(t,{h:()=>b});a(69375);var s=a(14041),n=a(19687),r=a(20916),i=a(78220),o=a(61707),l=a(92170),c=a(60244),u=a(12128),d=a(16224),p=a(74874),h=a.n(p),m=a(25148),g=a(24671),x=a(6839),v=a(29842),f=a(72431),y=a(26964),w=a(31085);const C=50,j=new u.y("sttLimit",C),S=h()(d.g2,["tipForSTTClosed"]);function b(e){const{isLarge:t,isSmall:a,iconSize:u,onSelect:d,portalContainer:p}=e,[h,b]=(0,m.A)(S),[T,P]=(0,s.useState)(!1),[k,A]=(0,s.useState)(f.eA.WebSpeech),[E,I]=(0,s.useState)(""),[D,L]=(0,s.useState)(""),[F,R]=(0,s.useState)(""),{serviceImplement:O,langMap:N}=(0,s.useMemo)((()=>{switch(k){case f.eA.TencentRealtime:return{serviceImplement:x.Er,langMap:x.AH};case f.eA.WebSpeech:return{serviceImplement:g.u8,langMap:g.HO}}}),[k]);return(0,s.useEffect)((()=>{switch(k){case f.eA.TencentRealtime:I(x.aN.defaultLang);break;case f.eA.WebSpeech:I(g.ql.defaultLang)}}),[k]),(0,s.useEffect)((()=>{if(!T)return;const e=[];let t,a=!1;const s=e=>{window.alert((0,v.H8)(e).message),P(!1)};return O.microphone({lang:E,options:{stopOnFirstSentence:!0,onError:s,onSentence:t=>{e.push(t),L(e.join(""))},onInterim:t=>{R(e.join("")+t)},onStop:e=>{e.length?(j.addOne(),d(e.join(""))):window.alert("未识别出任何文本，请重试。"),P(!1)}}}).then((e=>{a?e?.abort():t=e}),s),()=>{a=!0,t?.abort(),L(""),R("")}}),[T,E,d,O]),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(n.$,{icon:(0,w.jsx)(c.x,{iconSize:u}),small:a,large:t,minimal:!0,title:"语音翻译",onClick:g.Zj?()=>{h&&!h.tipForSTTClosed&&(window.alert("语音翻译功能目前只有在你的电脑能访问外网的情况下才能使用。未来的版本中会改善此情况，届时会另行通知。"),b({tipForSTTClosed:!0})),j.isOver().then((e=>{if(e){const e=j.dateEnd;window.alert(`非会员用户每七天只能使用 ${C} 次语音翻译功能，下次重置时间：${e}。成为会员即可解除此限制。`)}else P(!0)}))}:()=>{window.alert("Firefox 暂时不支持语音翻译功能，请在其它浏览器上使用。未来的版本中会添加对 Firefox 浏览器的支持，届时会另行通知。")}}),(0,w.jsxs)(r.l,{isOpen:T,enforceFocus:!1,portalContainer:p,children:[(0,w.jsxs)("div",{className:i.sar,children:[(0,w.jsxs)("div",{style:{marginBottom:10},children:["选择服务：",(0,w.jsx)(o.g,{onChange:e=>{A(e.currentTarget.value)},large:t,value:k,children:y.OR.map((e=>(0,w.jsx)("option",{value:e.id,children:e.name},e.id)))}),"切换语种：",(0,w.jsx)(o.g,{onChange:e=>{I(e.currentTarget.value)},large:t,value:E,children:Object.keys(N).map((e=>(0,w.jsx)("option",{value:e,children:N[e]||e},e)))})]}),(0,w.jsx)(l.M,{value:D||F,readOnly:!0,placeholder:"请讲，我正在听……"})]}),(0,w.jsx)("div",{className:i.DBf,children:(0,w.jsx)("div",{className:i.Nu2,children:(0,w.jsx)(n.$,{large:t,onClick:()=>{P(!1)},children:"取消"})})})]})]})}},98009:(e,t,a)=>{a.d(t,{m:()=>f});var s=a(14041),n=a(19687),r=a(23590),i=a(20916),o=a(78220),l=a(63820),c=a(31085);function u(e){const{fileInputProps:t,initialText:a="请选择",onInputChange:n}=e,[r,i]=(0,s.useState)(!1),[o,u]=(0,s.useState)(a);return(0,c.jsx)(l.z,{text:o,hasSelection:r,buttonText:"浏览",onInputChange:e=>{const t=e.target,s=t.files?.[0];s?(i(!0),u(s.name)):(i(!1),u(a)),n?.(e)},...t})}var d=a(41938),p=a(74874),h=a.n(p),m=a(16224),g=a(25148),x=a(67116);const v=h()(m.g2,["localOCR","ocrService"]);function f(e){const{isLarge:t,isSmall:a,iconSize:l,onSelect:p,portalContainer:h}=e,[m,f]=(0,g.A)(v),[y,w]=(0,s.useState)(""),[C,j]=(0,s.useState)(!1),S="tesseractocr"===m?.ocrService,[b,T]=(0,s.useState)(!1),P=()=>{T(!1),w(""),j(!1)};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.$,{icon:(0,c.jsx)(r.I,{icon:"media",size:l}),small:a,large:t,minimal:!0,title:"图片翻译",onClick:()=>{T(!0)}}),(0,c.jsx)(i.l,{isOpen:b,enforceFocus:!1,portalContainer:h,children:(0,c.jsxs)("form",{children:[(0,c.jsxs)("div",{className:o.sar,children:[(0,c.jsx)("p",{children:(0,c.jsx)(u,{initialText:"选择图片",onInputChange:e=>{const t=e.target,a=t.files?.[0];a&&function(e){return new Promise(((t,a)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=()=>a(s.error),s.readAsDataURL(e)}))}(a).then((e=>{S?(w(e),j(!1)):(P(),p(e))}),(e=>{window.alert(`读取图片失败，错误消息：${e.message}`)}))},fileInputProps:{inputProps:{accept:"image/*",required:!0},fill:!0,large:t}})}),(0,c.jsxs)("p",{children:["或者"," ",(0,c.jsx)(n.$,{small:a,large:t,onClick:()=>{(0,x._)({action:"read clipboard image"}).then((e=>{e?S?(w(e),j(!0)):(P(),p(e)):window.alert("剪切板内没有图片。")}))},children:"读取剪切板内的图片"}),C&&(0,c.jsx)("span",{style:{marginLeft:5},children:"已读取"})]}),S&&y&&(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{children:["选择语种：",(0,c.jsx)(d._,{value:m?.localOCR?.lang||v.localOCR.lang,onChange:e=>{f((t=>{t.localOCR.lang=e}))},isLarge:t,isSmall:a,portalContainer:h})]}),(0,c.jsx)(n.$,{small:a,large:t,intent:"primary",onClick:()=>{P(),p(y)},children:"确定"})]})]}),(0,c.jsx)("div",{className:o.DBf,children:(0,c.jsx)("div",{className:o.Nu2,children:(0,c.jsx)(n.$,{small:a,large:t,type:"reset",onClick:P,children:"取消"})})})]})})]})}},91307:(e,t,a)=>{a.d(t,{$:()=>h,A:()=>m});var s=a(25812),n=a(18392),r=a(23590),i=a(78107),o=a(78220),l=a(59468),c=a(73345),u=a(67116),d=a(31085);const p={small:12,middle:16,large:20};function h(){(0,u._)({action:"open options page",suffix:"#/store"}).catch((e=>{window.alert("打开设置页时发生了一个错误。错误消息："+e?.message)}))}function m(e){const{source:t,setSource:a,options:h,setOptions:m,children:g,size:x,portalContainer:v}=e;if(!h)return null;const f="large"===x,y=(e,t)=>{m((a=>{const s=a[t],n=s.indexOf(e);n>=0?s.splice(n,1):4===s.length&&s.pop(),s.unshift(e)}))};return(0,d.jsxs)(n.Z,{className:"quick-settings",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(s.A,{lang:t,setLang:e=>{a(e),y(e,"recentUseLangFrom")},addAuto:!0,recentUse:h.recentUseLangFrom,size:x,portalContainer:v}),(0,d.jsx)(r.I,{icon:"arrow-right",size:p[x],style:{margin:"0 10px"}}),(0,d.jsx)(s.A,{lang:h.destination,setLang:e=>{m({destination:e}),y(e,"recentUseLangTo")},recentUse:h.recentUseLangTo,size:x,portalContainer:v})]}),(0,d.jsx)("div",{children:(0,d.jsx)(c.f,{useShortName:!0,selectedAPIs:h.selectedAPIs,onChange:e=>{m({selectedAPIs:e})}})}),(0,d.jsxs)("div",{children:[(0,d.jsx)(i.Sc,{inline:!0,label:"自动朗读",large:f,checked:h.autoPlay,onChange:e=>{m({autoPlay:e.target.checked})}}),(0,d.jsx)(i.Sc,{inline:!0,label:"自动复制",checked:h.autoCopy,onChange:e=>{m({autoCopy:e.target.checked})}})]}),(0,d.jsx)(l.y,{value:h.panelSize,onChange:e=>{m({panelSize:e})}}),g&&(0,d.jsx)("div",{children:g}),(0,d.jsx)("a",{onClick:()=>{var e;(0,u._)({action:"open options page",suffix:e}).catch((e=>{window.alert("打开设置页时发生了一个错误。错误消息："+e?.message)}))},className:o.KJG,children:"打开完整设置"})]})}},62269:(e,t,a)=>{a.d(t,{A:()=>d});a(69375);var s=a(11234),n=a(25148),r=a(74874),i=a.n(r),o=a(16224),l=a(18785),c=a(31085);const u=i()(o.g2,"selectedAPIs");function d(){const[e,t]=(0,n.A)(u);return(0,c.jsx)(c.Fragment,{children:l.v.map((a=>(0,c.jsx)(s.D,{text:a.name,onClick:()=>(e=>{const a=e.id;t((e=>{const t=e.selectedAPIs;t.indexOf(a)<0&&t.push(a)}))})(a),disabled:!e||e.selectedAPIs.includes(a.id)},a.id)))})}},54449:(e,t,a)=>{a.d(t,{A:()=>O,Z:()=>P});a(69375);var s=a(14041),n=a(19687),r=a(23590),i=a(18392),o=a(22067),l=a(68802),c=a(16342),u=a(78220),d=a(53373),p=a.n(d),h=a(79071),m=a.n(h),g=a(74874),x=a.n(g),v=a(16224),f=a(25812),y=a(66126),w=a(18785),C=a(12752),j=a(76352),S=a(25148),b=a(67116),T=a(31085);async function P(e){(0,b._)({action:"audio",url:e}).catch((e=>{window.alert("朗读时出错："+e?.message)}))}function k(e){const t=e.uri,a=e.size,s=e.style;return(0,T.jsx)(n.$,{style:s,icon:(0,T.jsx)(r.I,{icon:"volume-up",size:L[a]}),small:"small"===a,large:"large"===a,minimal:!0,disabled:!t,onClick:t?()=>P(t):void 0,title:t?"朗读":"不支持此语种"})}function A(e,t){const a="GoogleWeb"===t,s=[];return!e.phonetic||a&&!e.dict||s.push(e.phonetic.map((e=>`${e.name?e.name+" ":""}/${e.value}/`))),e.dict?s.push(...e.dict.map((e=>`${e.pos?e.pos+(a?": ":" "):""}${e.terms.join(", ")}`))):e.result&&s.push(...e.result),(0,b._)({action:"write to clipboard",text:s.join("\n")})}function E(e){e.stopPropagation()}const I=/\b[A-Z\s\-'a-z]+\b/g;function D(e,t){const a=Array.from(e.matchAll(I)),n=e.split(I);return(0,T.jsx)(T.Fragment,{children:n.map(((e,n)=>{const r=a[n];return(0,T.jsxs)(s.Fragment,{children:[e,r?(0,T.jsx)("a",{onClick:()=>t(r[0]),children:r[0]}):""]},n)}))})}const L={small:12,middle:16,large:20};function F(e){switch(e){case"美":return"英语(美国)";case"英":return"英语(英国)";default:return}}const R={...x()(v.g2,"googleHidePhonetic"),...x()(v.Ne,["tipForGoogleTranslateClosed","tipForDeepLLimitClosed"])};function O(e){const{apiId:t,result:{loading:a,result:d}={loading:!1,result:null},queryResult:h,autoCopy:g=!1,autoPlay:x=!1,wordClickable:v=!0,setQuery:b=m(),size:I="small",collapse:O,onCollapseChange:N,portalContainer:_}=e,[z,K]=(0,S.A)(R),$=L[I],U="small"===I,M="large"===I,[B,G]=(0,s.useState)("duplicate"),[W,q]=(0,s.useState)(),H=w.v.find((e=>e.id===t))||{name:t,id:t},Y="GoogleWeb"===t&&!!z?.googleHidePhonetic,Z=()=>{G("tick"),q("success"),window.setTimeout((()=>{G("duplicate"),q(void 0)}),1e3)};(0,s.useEffect)((()=>{d&&x&&d.text.length<30&&P({apiId:t,source:d.from,text:d.text,ttsURI:d.phonetic?.[0].ttsURI||d.ttsURI})}),[t,x,d]),(0,s.useEffect)((()=>{d&&g&&A(d,t).then((e=>{e?Z():window.alert("自动复制翻译结果失败，请稍后重试。")}),(e=>{window.alert(`自动复制翻译结果时发生了一个错误：${e?.message}`)}))}),[d,g,t]);const V=C.K[t];return(0,T.jsxs)(i.Z,{className:"result-block",onClick:E,children:["GoogleWeb"===t&&!z?.tipForGoogleTranslateClosed&&(0,T.jsxs)(o.P,{intent:"warning",icon:null,children:[(0,T.jsx)("p",{children:"谷歌翻译可能需要额外配置才能使用。"}),(0,T.jsx)(n.A,{small:!0,style:{visibility:"visible"},intent:"primary",href:"https://hcfy.ai/blog/2022/09/28/ggg",target:"_blank",children:"查看详情"}),(0,T.jsx)("a",{style:{marginLeft:15},onClick:()=>{K({tipForGoogleTranslateClosed:!0})},children:"不再提示"})]}),"DeepLWeb"===t&&!z?.tipForDeepLLimitClosed&&(0,T.jsxs)(o.P,{intent:"warning",icon:null,children:[(0,T.jsx)("p",{children:"DeepL 首次翻译速度较慢，请耐心等待。若遇到问题（报错、翻译结果不全等）请点击下方按钮。"}),(0,T.jsx)(n.A,{small:!0,style:{visibility:"visible"},intent:"primary",href:"https://hcfy.ai/docs/services/free/#deepl",target:"_blank",children:"查看解决方案"}),(0,T.jsx)("a",{style:{marginLeft:15},onClick:()=>{K({tipForDeepLLimitClosed:!0})},children:"不再提示"})]}),(0,T.jsxs)("div",{className:"legend",children:[(0,T.jsxs)("div",{className:"legend-left",children:[(0,T.jsx)("span",{className:"api-ico",style:V?{backgroundImage:`url(${V})`}:void 0}),(0,T.jsx)(l.H6,{children:H.name}),d&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(f.A,{lang:d.from,setLang:h,size:"small",maxHeight:212,portalContainer:_,children:(0,T.jsxs)("span",{className:"source",children:[(0,T.jsx)("span",{className:"source-text",children:d.from}),(0,T.jsx)(r.I,{icon:"caret-down",size:12})]})}),(0,T.jsx)(k,{uri:{apiId:t,source:d.from,text:d.text,ttsURI:d.phonetic?.[0].ttsURI||d.ttsURI},size:I})]})]}),(0,T.jsxs)("div",{style:{flexShrink:0},children:[void 0!==O&&(0,T.jsx)(n.$,{minimal:!0,small:U,large:M,title:O?"展开":"收起",onClick:()=>{N&&N(!O)},icon:(0,T.jsx)(r.I,{icon:O?"chevron-down":"chevron-up",size:$+2})}),(0,T.jsx)(n.$,{onClick:()=>{d&&A(d,t).then((e=>{e?Z():window.alert("复制翻译结果失败，请稍后重试。")}),(e=>{window.alert(`复制翻译结果时发生了一个错误：${e?.message}`)}))},disabled:!d||!!d.error,icon:(0,T.jsx)(r.I,{icon:B,size:$}),minimal:!0,small:U,large:M,intent:W,title:"复制翻译结果"}),(0,T.jsx)(n.A,{disabled:!d?.link,target:"_blank",href:d?.link||"",icon:(0,T.jsx)(r.I,{icon:"share",size:$}),minimal:!0,small:U,large:M,title:"查看详细结果"})]})]}),(0,T.jsxs)(c.S,{isOpen:!O,children:[(0,T.jsxs)("div",{style:{display:a?"block":"none"},children:[(0,T.jsx)("p",{className:p()({[u.w24]:a}),children:"1"}),(0,T.jsx)("p",{className:p()({[u.w24]:a}),style:{width:"150px"},children:"1"})]}),d?.error&&(0,T.jsx)("div",{className:"error",children:(0,T.jsx)(j.Q,{error:d.error,onRetry:()=>h()})}),d?.phonetic&&!Y&&(0,T.jsx)("div",{className:"phonetic",children:d.phonetic.map(((e,a)=>(0,T.jsxs)("div",{className:"phonetic-item",style:{maxWidth:"100%"},children:[e.name&&(0,T.jsx)("span",{style:{flexShrink:0,marginRight:5},children:e.name}),e.value&&(0,T.jsxs)(y.A,{children:["/",e.value,"/"]}),e.ttsURI&&(0,T.jsx)(k,{style:{flexShrink:0},uri:{apiId:t,source:F(e.name)||d.from,text:d.text,ttsURI:e.ttsURI},size:I})]},a)))}),d&&(0,T.jsxs)("div",{className:"common-result",children:[d.dict&&(0,T.jsx)("div",{className:"dict",children:d.dict.map(((e,t)=>{const a=e.terms.join(", ");return(0,T.jsxs)("p",{children:[e.pos&&(0,T.jsx)("span",{className:"dict-pos",children:e.pos}),v?D(a,b):a]},t)}))}),!d.dict&&d.result&&(0,T.jsx)("div",{className:"general-result",children:d.result.map(((e,a)=>(0,T.jsxs)("p",{children:[e,(0,T.jsx)(k,{uri:{text:e,apiId:t,source:d?.to},size:I})]},a)))})]})]})]})}},96072:(e,t,a)=>{a.d(t,{j:()=>w});var s=a(46313),n=a(22067),r=a(19687),i=a(23590),o=a(14041),l=a(64795),c=a(85746),u=a(23593),d=a(74874),p=a.n(d),h=a(16224),m=a(25148),g=a(67116),x=a(31085);const v=location.href.startsWith(chrome.runtime.getURL("/panel.html")),f=u.c_.ctrl,y={...p()(h.g2,["textAreaShortKey","autoPaste"]),...p()(h.Ne,["tipForPasteTranslateClosed"])},w=(0,o.forwardRef)((function(e,t){const{isSmall:a,isLarge:u,value:d,onChange:p,onTranslate:w,iconSize:C,hideBtn:j,auto:S}=e,[b,T]=(0,m.A)(y),P=b?.textAreaShortKey||y.textAreaShortKey,k=(0,o.useRef)(null),[A,E]=(0,o.useState)(!1),{msg:I,textareaPlaceholder:D}=(0,o.useMemo)((()=>{const e=(P===h.o0.ctrlEnter?"Ctrl / ⌘ + ":"")+"Enter";return{msg:`翻译文本框内的文本(${e})`,textareaPlaceholder:`按下 ${e} 也可以翻译文本框内的文本`}}),[P]),L=(0,c.y)(),F=(0,l.W)(k.current);return(0,o.useEffect)((()=>{if(!S)return;const e=setTimeout(w,1e3);return()=>{clearTimeout(e)}}),[S,w]),(0,o.useImperativeHandle)(t,(()=>({select(){k.current?.select()}})),[]),(0,x.jsxs)("div",{className:"query-text",children:[(0,x.jsx)(s.f,{fill:!0,small:a,large:u,inputRef:k,value:d,placeholder:D,onChange:e=>{p(e.target.value)},onKeyDown:e=>{if(v||e.stopPropagation(),13===e.keyCode){if(P===h.o0.enter){if(e.preventDefault(),e[f]){const t=e.currentTarget,a=t.selectionStart,s=t.selectionEnd,n=t.value,r=n.substring(0,a)+"\n"+n.substring(s);return p(r),void setTimeout((()=>{t.setSelectionRange(a+1,a+1)}))}return e.preventDefault(),void w()}e[f]&&(e.preventDefault(),w())}},onPaste:b?.autoPaste?e=>{e.clipboardData.getData("text").trim()&&(E(!0),setTimeout((()=>{w(e.target.value)})))}:void 0}),!b?.tipForPasteTranslateClosed&&A&&(0,x.jsxs)(n.P,{title:"自 v8.6.5 起，在文本框中粘贴文本后会立刻触发翻译。",children:["你可以在",(0,x.jsx)("a",{onClick:()=>{(0,g._)({action:"open options page",suffix:"#/panel"})},children:"“设置” - “翻译面板”"})," ","- “文本框”中关闭此功能。",(0,x.jsx)("a",{onClick:()=>{T({tipForPasteTranslateClosed:!0})},children:"不再提示"})]}),(0,x.jsx)(r.$,{className:"translate-btn",style:{display:j?"none":void 0,right:18+(F.v&&L||0),bottom:8+(F.h&&L||0)},title:I,icon:(0,x.jsx)(i.I,{icon:"search",size:C}),small:a,large:u,intent:"primary",onClick:()=>{w(),k.current?.focus()}}),(0,x.jsx)(r.$,{className:"clear-btn",style:{position:"absolute",display:d?void 0:"none",right:11+(F.v&&L||0),top:11},minimal:!0,title:"清空文本",icon:(0,x.jsx)(i.I,{icon:"cross",size:C}),small:a,large:u,onClick:()=>{p(""),k.current?.focus()}})]})}))},20760:(e,t,a)=>{a.d(t,{A:()=>r});var s=a(14041),n=a(67116);function r(e,t,a){const[r,i]=(0,s.useState)(!1);(0,s.useEffect)((()=>{(0,n._)({action:"is text in favorites",text:e}).then(i)}),[e]);const o=(0,s.useCallback)((()=>{(0,n._)({action:"delete record in favorites",text:e}).catch((e=>{window.alert(`从收藏夹中删除时发生了一个错误：${e?.message}`)})),i(!1)}),[e]),l=(0,s.useCallback)((()=>{e&&a&&(t({type:"save favorites",text:e,selectedAPIs:a}),i(!0))}),[t,a,e]);return{isInFavorites:r,saveOrDelete:r?o:l}}},81152:(e,t,a)=>{a.d(t,{L:()=>v});var s=a(14041),n=a(83813),r=a(17546),i=a.n(r),o=a(41263),l=a.n(o),c=a(67116);const u={results:{}},d=(e,t)=>(0,n.jM)(e,(e=>{switch(t.type){case"set loading":return void(t.value?e.results[t.apiId]={loading:!0,result:null}:l()(e.results,[t.apiId,"loading"],!1));case"set result":return void l()(e.results,[t.apiId,"result"],t.result);case"clear results":return void(e.results={});case"save favorites":const a=t.selectedAPIs,s={};return i()(e.results,((e,t)=>{if(!e||e.loading)return;const r=e.result;r&&a.includes(t)&&(s[t]=(0,n.c2)(r))})),void(0,c._)({action:"save favorite",record:{text:t.text,results:s}}).catch((e=>{window.alert(`保存到收藏夹时发生了一个错误：${e?.message}`)}))}}));var p=a(5877),h=a(38285),m=a.n(h),g=a(65707),x=a.n(g);function v(e,t,a,n,r){const i=(0,s.useRef)(""),[o,l]=(0,s.useReducer)(d,u),h=(0,s.useRef)();h.current=r;const g=(0,p.A)(e),v=(0,p.A)(a),f=(0,p.A)(t),y=(0,p.A)(n),w=async(e,t,a,s=(()=>!1))=>{let n;l({type:"set loading",apiId:t,value:!0});try{n=await(0,c._)({action:"translate",data:{apiCode:t,text:e,source:a}})}catch(a){if(s())return;return l({type:"set loading",apiId:t,value:!1}),void l({type:"set result",apiId:t,result:{text:e,error:{message:a?.message||"未知错误"}}})}if(!s()&&(l({type:"set loading",apiId:t,value:!1}),n)){if("GoogleWeb"===t){const e=n.from;e&&"中文(简体)"!==e&&chrome.storage.local.set({latestSource:e})}l({type:"set result",apiId:t,result:n})}};return(0,s.useEffect)((()=>{if(!n)return;if(e===g&&a===v&&n===y)return;l({type:"clear results"});const s=m()();if(i.current=s,!e)return;h.current?.();const r=()=>s!==i.current;t?.forEach((t=>{w(e,t,a,r)}))}),[n,e,t,a]),(0,s.useEffect)((()=>{if(!f||!t)return;const s=x()(t,f);if(!s.length)return;const n=i.current,r=()=>n!==i.current;s.forEach((t=>{o.results[t]||w(e,t,a,r)}))}),[e,o.results,t,a]),{results:o,queryResult:w,dispatchResults:l}}},4225:(e,t,a)=>{a.d(t,{A:()=>d});var s=a(83813),n=a(38285),r=a.n(n),i=a(14041),o=a(67116);let l="";const c=document.querySelector('link[rel=icon],link[rel="shortcut icon"]');l=c?c.href:window.location.origin+"/favicon.ico";const u=(0,s.jM)(((e,t)=>{if("save translate record"===t.type){const a=Date.now(),s=r()(a+"-");return e.translateId=s,void(0,o._)({action:"save history record",record:{text:t.text,date:a,url:window.location.href,title:document.title,favicon:l}}).catch((e=>{window.alert(`保存历史记录时发生了一个错误：${e?.message}`)}))}}));function d(){return(0,i.useReducer)(u,{translateId:""})}},74703:(e,t,a)=>{a.d(t,{O:()=>m});var s=a(74874),n=a.n(s),r=a(16224),i=a(78220),o=a(19687),l=a(14041),c=a(91307),u=a(67116),d=a(31085);const p=n()(r.g2,["ocrService"]);function h(){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{children:"正在从截图中提取文本，请稍候……"}),(0,d.jsx)("div",{className:`${i.E4k} ${i.KJG}`,children:(0,d.jsx)("div",{style:{marginTop:4},children:(0,d.jsx)("a",{href:"https://hcfy.ai/docs/guides/screenshot#slow",target:"_blank",rel:"noreferrer",children:"为什么还没有提取成功？"})})})]})}function m(e){return(0,l.useCallback)((async t=>{const{ocrService:a}=await chrome.storage.local.get(p),s="tesseractocr"===a,n=e?.show({message:s?(0,d.jsx)(h,{}):"正在从截图中提取文本，请稍候……",timeout:0});return(0,u._)({action:"ocr",dataURI:t}).then((t=>(n&&e?.dismiss(n),t)),(t=>(e?.show({message:t?.message.includes("会员")?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{children:t.message}),(0,d.jsx)(o.$,{onClick:c.$,small:!0,children:"开通会员"})]}):`从图片中提取文字时发生了一个错误：${t?.message}`,intent:"warning",timeout:0},n),Promise.reject(t))))}),[e])}},41938:(e,t,a)=>{a.d(t,{_:()=>u});var s=a(70041),n=a(11234),r=a(19687);a(69375);const i=[],o=[{text:"中文(简体)",value:"chi_sim"},{text:"中文(繁体)",value:"chi_tra"},{text:"英语",value:"eng"},{text:"日语",value:"jpn"},{text:"法语",value:"fra"},{text:"韩语",value:"kor"},{text:"德语",value:"deu"},{text:"俄语",value:"rus"},{text:"泰语",value:"tha"},{text:"南非语",value:"afr"},{text:"阿姆哈拉语",value:"amh"},{text:"阿拉伯语",value:"ara"},{text:"阿萨姆语",value:"asm"},{text:"阿塞拜疆语",value:"aze"},{text:"阿塞拜疆语(西里尔)",value:"aze_cyrl"},{text:"白俄罗斯语",value:"bel"},{text:"孟加拉语",value:"ben"},{text:"藏语",value:"bod"},{text:"波斯尼亚语",value:"bos"},{text:"保加利亚语",value:"bul"},{text:"加泰罗尼亚语(瓦伦西亚)",value:"cat"},{text:"宿务语",value:"ceb"},{text:"捷克语",value:"ces"},{text:"切罗基语",value:"chr"},{text:"威尔士语",value:"cym"},{text:"丹麦语",value:"dan"},{text:"宗喀语",value:"dzo"},{text:"希腊语(现代)",value:"ell"},{text:"中古英语",value:"enm"},{text:"世界语",value:"epo"},{text:"爱沙尼亚语",value:"est"},{text:"巴斯克语",value:"eus"},{text:"波斯语",value:"fas"},{text:"芬兰语",value:"fin"},{text:"德文尖角体",value:"frk"},{text:"中古法语",value:"frm"},{text:"爱尔兰语",value:"gle"},{text:"希腊语(古代)",value:"grc"},{text:"古吉拉特语",value:"guj"},{text:"海地克里奥尔语",value:"hat"},{text:"希伯来语",value:"heb"},{text:"印地语",value:"hin"},{text:"克罗地亚语",value:"hrv"},{text:"匈牙利语",value:"hun"},{text:"因纽特语",value:"iku"},{text:"印度尼西亚语",value:"ind"},{text:"冰岛语",value:"isl"},{text:"意大利语",value:"ita"},{text:"意大利语(古代)",value:"ita_old"},{text:"爪哇语",value:"jav"},{text:"坎纳达语",value:"kan"},{text:"格鲁吉亚语",value:"kat"},{text:"格鲁吉亚语(古代)",value:"kat_old"},{text:"哈萨克语",value:"kaz"},{text:"高棉语",value:"khm"},{text:"吉尔吉斯语",value:"kir"},{text:"库尔德语",value:"kur"},{text:"老挝语",value:"lao"},{text:"拉丁语",value:"lat"},{text:"拉脱维亚语",value:"lav"},{text:"立陶宛语",value:"lit"},{text:"马拉雅拉姆语",value:"mal"},{text:"马拉地语",value:"mar"},{text:"马其顿语",value:"mkd"},{text:"马耳他语",value:"mlt"},{text:"马来语",value:"msa"},{text:"缅甸语",value:"mya"},{text:"尼泊尔语",value:"nep"},{text:"荷兰语(弗拉芒)",value:"nld"},{text:"挪威语",value:"nor"},{text:"奥里亚语",value:"ori"},{text:"旁遮普语",value:"pan"},{text:"波兰语",value:"pol"},{text:"葡萄牙语",value:"por"},{text:"普什图语",value:"pus"},{text:"罗马尼亚语",value:"ron"},{text:"梵语",value:"san"},{text:"僧伽罗语",value:"sin"},{text:"斯洛伐克语",value:"slk"},{text:"斯洛维尼亚语",value:"slv"},{text:"西班牙语",value:"spa"},{text:"西班牙语(古代)",value:"spa_old"},{text:"阿尔巴尼亚语",value:"sqi"},{text:"塞尔维亚语",value:"srq"},{text:"塞尔维亚语(拉丁)",value:"srq_latn"},{text:"斯瓦希里语",value:"swa"},{text:"瑞典语",value:"swe"},{text:"叙利亚语",value:"syr"},{text:"泰米尔语",value:"tam"},{text:"泰卢固语",value:"tel"},{text:"塔吉克",value:"tgk"},{text:"他加禄语",value:"tgl"},{text:"提格里尼亚",value:"tir"},{text:"土耳其语",value:"tur"},{text:"维吾尔语",value:"uig"},{text:"乌克兰语",value:"ukr"},{text:"乌尔都语",value:"urd"},{text:"乌兹别克语",value:"uzb"},{text:"乌兹别克语(西里尔)",value:"uzb_cyrl"},{text:"越南语",value:"vie"},{text:"意第绪语",value:"yid"}].reduce(((e,t)=>(i.push(t.value),e[t.value]=t.text,e)),{});var l=a(31085);const c=(e,{handleClick:t,modifiers:a})=>a.matchesPredicate?(0,l.jsx)(n.D,{onClick:t,active:a.active,text:o[e]},e):null;function u(e){const{value:t,onChange:a,isSmall:n,isLarge:u,portalContainer:d}=e;return(0,l.jsx)(s.l,{filterable:!1,activeItem:t,items:i,itemRenderer:c,onItemSelect:a,popoverProps:{portalContainer:d,targetTagName:"span"},children:(0,l.jsx)(r.$,{rightIcon:"caret-down",small:n,large:u,children:o[t]})})}},16224:(e,t,a)=>{a.d(t,{Ne:()=>x,g2:()=>g,o0:()=>m});var s=a(94903),n=a(18785),r=a(54712),i=a(20551),o=a(86045),l=a(19235),c=a(38251),u=a(50657),d=a(49726),p=a(37721),h=a(7634);let m=function(e){return e.ctrlEnter="ctrl-enter",e.enter="enter",e}({});const g={multiClick:"close",button:!0,buttonAutoClose:!0,buttonOffsetTop:0,buttonOffsetLeft:0,closeAfterMove:!1,charsLimit:0,disableInTextarea:!1,domainBlackList:[],domainWhiteList:[],textList:[{name:"忽略中文",readonly:!0,enabled:!1,value:"[\\u4e00-\\u9fa5]",description:"如果划选的文本当中包含中文，则不显示翻译按钮或翻译结果。"},{name:"忽略字符",readonly:!0,enabled:!0,value:"^[\\s.\\-0-9()•+]+$",description:"如果划选的文本全部都是由数字、点、括号、空格、横线、加号和圆点（即 •，多用于密码框）组成的，则不显示翻译按钮或翻译结果。"}],placement:"bottom",pin:!1,pinAfterDrag:!1,pinPos:null,pinEnhance:!0,pinIgnoreDomainList:!0,darkMode:"system",pdfAuto:!1,pdfSnifferEnable:!0,pdfStandalone:!1,width:290,source:"",destination:"中文(简体)",secondDestination:"英语",secondDestinationLatestSource:!1,showTextArea:!1,textAreaAuto:!1,textAreaShortKey:m.enter,selectedAPIs:["GoogleWeb","DeepLWeb","Yandex","BingDictWeb"],collapsedAPIs:[],selectedExternalLinks:[],autoClipboard:null,autoClipboardImage:null,autoPlay:!1,autoCopy:!1,autoPaste:!0,recentUseLangFrom:[""],recentUseLangTo:["中文(简体)"],tipPanelSettingsClosed:!1,tipBlockedPDFClosed:!1,tipIncognitoPDFClosed:!1,tipOcrChangeClosed:!0,tipForeverVIPClosed:!0,tipQuickLinksClosed:!1,tipNewProfessionalClosed:!1,tipTextareaBtnClosed:!0,tipForSTTClosed:!1,tipForPinAfterDragClosed:!0,tipForPageTrsNoLoadingClosed:!0,tipForSlowDeepLPageTrsClosed:!1,tipForPageTrsClosed:!1,panelPos:{width:270,height:500,left:100,top:100},panelFocus:!0,panelSize:"small",panelButtons:["media","microphone"],panelCustomStyle:"",notifySyncOptions:!0,sourceTransformNoBr:!1,sourceTransformNCaml:!1,sourceTransformNoComment:!1,sourceLower:!1,sourceTransformRegExps:[],historyEnabled:!1,favoritesEnabled:!0,modifierKeys:[],modifierKeyPressedAction:"",modifierKeyTranslate:!1,modifierKeyLink:!1,audioVolume:100,audioRate:1,systemTTS:"aid",systemTTSAccent:{},systemTTSVoice:{},localOCR:{lang:"eng"},pageTrsApi:"GoogleWeb",pageTrsHighlight:!0,pageTrsResultStyleId:"STYLE_LINE",pageTrsResultStyleMainColor:null,pageTrsResultStyleTextColor:null,pageTrsResultStyleTextSize:null,pageTrsResultStyleTextWeight:null,pageTrsResultStyleCustom:"",pageTrsApiOptions:n.B.map((e=>e.id)),pageTrsJumpTwo:!1,pageTrsEditable:!0,googleRegion:"com",googleType:"fast",googleMirror:"",googleHidePhonetic:!1,quickLinks:[{name:"谷歌搜索",link:"https://www.google.com/search?q=%s",menu:!0,panel:!0},{name:"维基百科",link:"https://zh.wikipedia.org/w/index.php?search=%s",menu:!0,panel:!0},{name:"剑桥词典",link:"https://dictionary.cambridge.org/dictionary/english-chinese-simplified/%s",menu:!0,panel:!0}],noticesRead:[],customAPI:"",customAPINames:[],pointsEnabled:[],baiduDomain:null,aliDomain:null,ocrService:"tesseractocr",contextMenus:r.$,popupAction:"show-popup",pageTrsSource:"",pageTrsDest:["中文(简体)"],pageTrsPanelPos:"bottom-right",chatGPTPrompt:"",chatGPTEndpoint:"",chatGPTModel:"gpt-3.5-turbo",claudePrompt:"",claudeEndpoint:"",claudeModel:"claude-3-haiku-20240307",tongYiPrompt:"",tongYiEndpoint:"",tongYiModel:"qwen-turbo",lingYiPrompt:"",lingYiEndpoint:"",lingYiModel:"yi-medium",moonshotPrompt:"",moonshotEndpoint:"",moonshotModel:"moonshot-v1-8k",deepSeekPrompt:"",deepSeekEndpoint:"",deepSeekModel:"deepseek-chat",zhiPuPrompt:"",zhiPuEndpoint:"",zhiPuModel:"glm-4-flash",miniMaxPrompt:"",miniMaxEndpoint:"",miniMaxModel:"abab5.5s-chat",baiChuanPrompt:"",baiChuanEndpoint:"",baiChuanModel:"baichuan2-turbo",douBaoPrompt:"",douBaoEndpoint:"",douBaoModel:"",wenXinPrompt:"",wenXinEndpoint:"",wenXinModel:"ernie_speed",hunYuanPrompt:"",hunYuanEndpoint:"",hunYuanModel:"hunyuan-lite",siliConflowPrompt:"",siliConflowEndpoint:"",siliConflowModel:"Qwen/Qwen2-7B-Instruct",geminiPrompt:"",geminiEndpoint:"",geminiModel:"gemini-1.0-pro",deeplEndpoint:""},x={chatGPTConversationInfo:null,hoverTranslate:!1,latestSource:"",pageTrsAuto:!1,pageTrsType:s.a.both,tipForShortKeyForPageTrsTypeClosed:!1,tipForFullTextClosed:!1,tipForDeepLLimitClosed:!1,user:null,optionsSyncAt:null,disabledNofiByBrowserUI:!1,favoritesSyncAt:null,historiesSyncAt:null,deeplKey:[],deeplPoints:h.rc,baiDuAppKey:[],bdPoints:c.p4,bdProPoints:c.cG,baiDuOCRKey:[],bdOcrPoints:u.pR,youDaoAppKey:[],ydPoints:i.Gu,aLiApiKey:[],aliPoints:o.Dx,aliProPoints:o.Qy,qqApiKey:[],qqPoints:d.fH,hsApiKey:[],hsPoints:p.Gs,soGouApiKey:[],cyApiToken:[],cyPoints:l.n8,chatGPTKey:[],claudeKey:[],tongYiKey:[],lingYiKey:[],moonshotKey:[],deepSeekKey:[],zhiPuKey:[],miniMaxKey:[],baiChuanKey:[],douBaoKey:[],wenXinKey:[],hunYuanKey:[],siliConflowKey:[],geminiKey:[],ocrLimit:{date:0,times:0},pdfLimit:{date:0,times:0},pageTranslateLimit:{date:0,times:0},sttLimit:{date:0,times:0},videoLimit:{date:0,times:0},panelTranslateLimit:{date:0,times:0},crossTranslateLimit:{date:0,times:0},pdfZoom:"",noticesUnreadNum:0,noticesFiltered:[],tipForFirstExportClosed:!1,tipForPasteTranslateClosed:!1,tipForDropTranslateClosed:!1,tipForAddJumpTwoClosed:!0,tipForServicesUpdateClosed:!0,tipForGoogleTranslateClosed:!1,tipForSaveSourceSelectClosed:!0}},54712:(e,t,a)=>{a.d(t,{$:()=>s});const s=[{value:"translate",label:"翻译这段文本"},{value:"open-link-in-viewer",label:"在划词翻译中打开此 PDF"},{value:"screen-translate",label:"截图翻译"},{value:"page-translate",label:"网页全文翻译"},{value:"video-translate",label:"音视频翻译"}].map((e=>e.value))},81215:(e,t,a)=>{a.d(t,{W:()=>r});a(47146);const s=/^[A-Z]?[a-z]+([A-Z][a-z]*)+$/,n=/^([A-Za-z]+_)+[A-Za-z]+$/;function r(e,t){let a=e.trim();return t&&(t.sourceTransformNoBr&&(a=a.replace(/\r?\n/g," ")),t.sourceTransformNoComment&&(a=a.replace(/\/\//g," ")),t.sourceTransformRegExps&&(a=t.sourceTransformRegExps.reduce(((e,t)=>{let a;try{a=new RegExp(t.pattern,t.flags)}catch(t){return e}return e.replace(a,t.replaceTo||"")}),a)),t.sourceTransformNCaml&&(s.test(a)?a=a.replace(/[A-Z]/g,((e,t)=>0===t?e.toLowerCase():" "+e.toLowerCase())):n.test(a)&&(a=a.replace(/_/g," "))),t.sourceLower&&(a=a.toLowerCase())),a}},12128:(e,t,a)=>{a.d(t,{y:()=>h});var s=a(74874),n=a.n(s),r=a(16224),i=a(7662),o=a(10421),l=a(21637),c=a(27429),u=a(20124),d=a.n(u);class p extends c.b{#e;max;dateStart;dateDuration;dateEndOfDay;end;#t;constructor(e){super(),this.#t=u("Counter"),this.#e=e?.count||0,this.dateStart=e?.date?.start?new Date(e.date.start):null,this.max=e?.max||1/0,this.dateDuration=e?.date?.duration,this.dateEndOfDay=e?.date?.endOfDay,this.end=null,this.#t("初始状态：%o",{count:this.#e,max:this.max,start:this.dateStart,duration:this.dateDuration,endOfDay:this.dateEndOfDay}),this.#a(!0)}#s(){if(null!=this.end)return this.end;if(this.dateStart&&this.dateDuration){let e=(0,i.W)(this.dateStart,this.dateDuration);return this.dateEndOfDay&&(e=(0,o.D)(e)),this.end=e}return this.end=null}#a(e){if(this.#t("开始刷新计数。刷新前状态：%o",{count:this.#e,max:this.max,start:this.dateStart,duration:this.dateDuration,endOfDay:this.dateEndOfDay}),this.dateStart){const t=this.#s();if(t){const a=new Date;(0,l.d)(a,t)&&(this.#e=0,this.dateStart=null,this.end=null,e&&this.emit("change"))}}this.#t("开始刷新计数。刷新后状态：%o",{count:this.#e,max:this.max,start:this.dateStart,duration:this.dateDuration,endOfDay:this.dateEndOfDay})}isOver(e=0){return this.#a(),this.#e+e>this.max}add(e=1){this.#a(),this.dateStart||(this.dateStart=new Date),this.#e+=e,this.emit("change")}get status(){return{count:this.#e,max:this.max,start:this.dateStart,end:this.#s(),duration:this.dateDuration}}}class h{#t;#n;constructor(e,t){this.storageKey=e,this.max=t,this.#t=d()(`FunctionLimit:${e}`)}async isOver(e){const t=this.storageKey,a=n()(r.Ne,["user",t]),s=await chrome.storage.local.get(a),i=s[t];this.#t("读取了使用情况：开始日期 %o，已使用次数 %d，最大使用次数 %d",i.date?new Date(i.date).toLocaleString():"无",i.times,this.max);const o=new p({count:i.times,max:this.max,date:{start:i.date,duration:{weeks:1}}});this.#n=o.status,o.on("change",(()=>{this.#t("计数状态发生变化，新状态为 %o",o.status),this.#n=o.status,chrome.storage.local.set({[t]:{date:o.status.start?.getTime(),times:o.status.count}})}));const l=o.isOver(1);return e&&!l&&(this.#t("指定了 add 参数且未超过限额，所以次数加 1"),o.add(1)),this.#t("最终计数状态: %o",o.status),!s.user?.vipActivated&&l}async addOne(){const e=n()(r.Ne,["user",this.storageKey]),t=(await chrome.storage.local.get(e))[this.storageKey];t.times=(t?.times||0)+1,t.date||(t.date=Date.now()),this.#t("使用 addOne 增加了一次次数，现在为 %d",t.times),await chrome.storage.local.set({[this.storageKey]:t})}get dateEnd(){const e=this.#n?.end?.toLocaleString()||"获取结束时间时发生未知错误";return this.#t("获取结束时间：%s",e),e}}},29842:(e,t,a)=>{a.d(t,{Fw:()=>s.F,H8:()=>n.H,VC:()=>r.V,xh:()=>i.x});var s=a(17368),n=a(34426),r=a(1783),i=a(23298)},34426:(e,t,a)=>{a.d(t,{H:()=>i});var s=a(17368),n=a(46123),r=a.n(n);function i(e){if(e instanceof s.F)return e;if(e instanceof Error)return new s.F(e.message,{type:null});const t=r()(e,"message");return"string"==typeof t?new s.F(t,{type:null}):new s.F("划词翻译内部出现了一个预期之外的错误，如果你看到了这条消息，请反馈给我。",{type:null})}},7276:(e,t,a)=>{a.d(t,{cN:()=>c});a(61412),a(91883),a(70286);var s=a(29842),n=a(5090),r=a(20124);const i=a.n(r)()("hcfy:axiosForAPI");let o=function(e){return e.VIP_OUTDATED="VIP_OUTDATED",e}({});let l=null;function c(e,t,a){const r=new URL(e,"https://hs-api.limingkai.cn/").toString();return(0,n.Z5)(r,t).then((async e=>{const t=e.clone(),n=await t.text();let r;i("接口返回的数据（text 形式）",n);try{r=JSON.parse(n)}catch(c){return a?e:n}if(c=r,c?.isError){i("接口的错误处理",r),r.errorCode===o.VIP_OUTDATED&&chrome.storage.local.set({user:r.data});const e=new s.Fw(r.message,{type:r.errorCode});if(l)return l(e);throw e}var c;return a?e:r}),(e=>{if((0,n.NF)(e)){const t=e.response?.status;if(304===t)return a?e.response:"";401===t&&chrome.storage.local.remove(["user","optionsSyncAt","favoritesSyncAt","historiesSyncAt"])}return l?l(e):Promise.reject(e)}))}},3161:(e,t,a)=>{a(61412),a(91883),a(70286)},38232:(e,t,a)=>{a(23810),a(3161)}}]);