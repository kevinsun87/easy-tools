"use strict";(globalThis.webpackChunkbrowser_extension=globalThis.webpackChunkbrowser_extension||[]).push([[579],{90274:(e,u,t)=>{t.d(u,{B:()=>F});var n=t(27429),o=t(46343),i=t.n(o);function s(){if(window.self===window.top)return"top";const e=[];let u=window.self;do{const t=u.parent;if(!t)return"isolation";const n=Array.prototype.indexOf.call(t.frames,u);if(n<0)return"isolation";e.unshift(n),u=t}while(u!==window.top);return e}let r;class F extends n.A{constructor(){if(r)return r;super(),r=this,chrome.runtime.onMessage.addListener((e=>{"forward between frames"===e?.action&&function(e){const u=e.target,t=s();return"all"===u?!i()(e.senderFramePosition,t):"top"===u?"top"===t:"string"!=typeof t&&t.length===u.length&&t.every(((e,t)=>e===u[t]))}(e)&&this.emit("message",e.data,e.senderFramePosition,e.target)}))}tell(e,u){const t=s();if("parent"===u){if("top"===t||"isolation"===t)return Promise.reject(new Error(t+" 窗口不能发送消息给 parent。"));(u=t.slice(0,-1)).length||(u="top")}const n={action:"forward between frames",target:u,data:e,senderFramePosition:t};return chrome.runtime.sendMessage(n)}}},43785:(e,u,t)=>{t.d(u,{Z:()=>M});var n=t(74874),o=t.n(n),i=t(65040),s=(t(69375),t(6747));const r=/[\x00\x01\x02\x03\x04\x05\x06\x07\b\t\v\f\x0E\x0F\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1A\x1B\x1C\x1D\x1E\x1F\x7F-\x9F\xAD\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/g,F=(0,s.Ay)(location.href);function d(e){return"INPUT"===e.nodeName}function l(e){return"TEXTAREA"===e.nodeName}let c;const E=/\n/g;let a=()=>{},A=()=>{};function C(e){function u(){const u=e.getBoundingClientRect();c.style.top=u.top+window.pageYOffset+"px",c.style.left=u.left+window.pageXOffset+"px",c.style.width=u.width+"px",c.style.height=u.height+"px";const t=window.getComputedStyle(e);c.style.padding=t.padding,c.style.border=`${t.borderWidth} solid black`,c.style.lineHeight=t.lineHeight,c.style.fontSize=t.fontSize,c.style.fontFamily=t.fontFamily}function t(){c.scrollTop=e.scrollTop,c.scrollLeft=e.scrollLeft}c||(c=document.createElement("div"),c.style.pointerEvents="none",c.style.visibility="hidden",c.style.position="absolute",c.style.overflow="scroll",c.style.boxSizing="border-box",document.documentElement.appendChild(c)),a(),A(),u(),setTimeout(t),window.addEventListener("resize",u),e.addEventListener("scroll",t),a=()=>{window.removeEventListener("resize",u)},A=()=>{e.removeEventListener("scroll",t)};const n=e.value;var o;c.innerHTML=(o=n,o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")).replace(E,"<br>");const i=n.matchAll(E),s=[];let r,F,d,l,C=0;for(const e of i)C!==e.index&&s.push(n.slice(C,e.index)),s.push("\n"),C=e.index+1;C!==n.length&&s.push(n.slice(C));let h=0;const B=e.selectionStart||0,m=e.selectionEnd||0;s.some(((e,u)=>{const t=h+e.length;if(r||t>B&&(r=c.childNodes[u],F=B-h),r&&t>=m)return d=c.childNodes[u],l=m-h,!0;h=t}));const D=document.createRange();return D.setStart(r,F),D.setEnd(d,l),D}var h=t(98087),B=t.n(h);function m(e,u){const t=window.getSelection();if(!t)return;const n=function(e=window.getSelection()){const u=document.activeElement;if(u&&d(u)&&"password"===u.type)return"";let t=e?.toString();if(t)F&&(t=t.replace(/\r?\n/g," "));else if(u&&(l(u)||d(u))){const{selectionStart:e,selectionEnd:n}=u;null!=e&&null!=n&&(e||n)&&(t=u.value.slice(e,n))}return t?t.trim().replace(r,""):""}(t);if(!n)return;let s,c=!1,E=t.rangeCount>0?t.getRangeAt(0):void 0;if(!E||E.collapsed){const u=document.activeElement;u&&(d(u)||l(u))?(E=C(u),c=!0):e&&e.composed&&(e.composedPath?e.composedPath():e.path||[]).some((e=>{if(e.nodeType===Node.DOCUMENT_FRAGMENT_NODE)return E=function(e){const u=e.getSelection();if(!u||!u.rangeCount)return;const t=u.getRangeAt(0);return t.collapsed?void 0:t}(e),!0}))||(E=void 0)}s=!c&&(!!document.activeElement&&!!document.activeElement.closest('[contenteditable="true"]'));const a=!E&&e?{x:e.clientX,y:e.clientY,initScrollTop:window.pageYOffset,initScrollLeft:window.pageXOffset}:void 0,A=E||{getBoundingClientRect(){if(a){const e=a.y-(window.pageYOffset-a.initScrollTop),u=a.x-(window.pageXOffset-a.initScrollLeft);return{height:0,width:0,top:e,bottom:e,left:u,right:u}}return{top:100,left:100,width:10,height:10,right:110,bottom:110}}};return{text:n,multiClick:!!u,isTop:i.$,event:e&&o()(e,["altKey","metaKey","shiftKey","ctrlKey","clientX","clientY","target"]),isInTextarea:c,isInContentEditable:s,rect:i.$?function(){return A.getBoundingClientRect()}:A.getBoundingClientRect()}}function D(){return{frameIndex:i.$?-1:Array.prototype.indexOf.call(window.parent.frames,window),href:window.location.href,scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset}}function p(e,u,t){return{type:"HCFY_SELECTION_EVENT_BUBBLE_SELECTION_INFO",data:{selection:m(t,u),path:[D()]},meta:e}}const f=document.createElement("style");function g(e){e.target.closest("a")&&(e.preventDefault(),e.stopImmediatePropagation())}f.textContent="a{text-decoration:none !important;cursor:text !important}";var w=t(81100),v=t(69675),T=t(23593),_=t(16224),y=t(20124),N=t.n(y),I=t(90274),L=t(27429);class x extends L.b{count;timer;d;holding;holdingInfo;getElement;interval;constructor(e){let u;if(super(),this.count=0,e?.element)if("function"==typeof e.element)u=e.element;else{const t=e.element;u=()=>t}else u=()=>document;this.getElement=u,this.interval=e?.interval||500,e?.debug&&(this.d=y("@hcfyapp/multi-click"),this.d.enabled=!0),document.addEventListener("pointerdown",this.handleDown),this.d?.("初始化完成")}handleDown=e=>{if(!this.getElement().contains(e.target))return void this.d?.("pointerdown 事件发生在不在监听范围内的元素上，忽略。",this.getElement,e.target);this.holding=!0;const u=this.count+=1;1===u?(this.d?.("------------\n首次触发 pointerdown 事件，监听 pointermove 和 pointerup 事件并触发 start 事件"),document.addEventListener("pointermove",this.handleMove),document.addEventListener("pointerup",this.handleUp),this.emit("start",{count:this.count,event:e,reason:"down"})):this.d?.("------------\n触发 pointerdown 事件，连击次数为 %d",u),this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{if(this.holding)this.d?.("%d 毫秒内没有抬起鼠标，所以将在下一次 pointerup 触发 end 事件并重置状态，次数为 %d",this.interval,this.count),this.holdingInfo={count:this.count,event:e,reason:"timeout:holding"};else{const u={count:this.count,event:e,reason:"timeout:down"};this.d?.("%d 毫秒内没有再次触发 pointerdown 事件，所以触发 end 事件并重置状态。事件信息：%o",this.interval,u),this.emit("end",u),this.reset()}}),this.interval)};handleMove=e=>{if(this.holding)this.holdingInfo={count:1,event:e,reason:"move:holding"},this.d?.("监测到在按下鼠标没放的时候触发了 pointermove 事件，所以将在下一次 pointerup 时触发 end 事件并重置状态，次数固定为 1。事件信息：%o",this.holdingInfo);else{const u={count:this.count,event:e,reason:"move:released"};this.d?.("监测到在鼠标抬起后触发了 pointermove 事件，所以立刻触发 end 事件并重置状态。事件信息：%o",u),this.emit("end",u),this.reset()}};handleUp=e=>{if(delete this.holding,this.holdingInfo){this.d?.("由于在鼠标按下的过程中出现了中断的情况，所以触发一次连击事件，并紧跟着触发一次 end 事件，然后重置状态。中断原因：%o",this.holdingInfo);const u=this.holdingInfo;return delete this.holdingInfo,u.event=e,this.emit("multi click",u),this.emit("end",u),void this.reset()}this.d?.("触发连击事件，目前的次数为 %d",this.count),this.emit("multi click",{count:this.count,event:e,reason:"up"})};reset(){this.d?.("重置状态\n---------------"),delete this.holding,delete this.holdingInfo,this.count=0,null!=this.timer&&(clearTimeout(this.timer),delete this.timer),document.removeEventListener("pointerup",this.handleUp),document.removeEventListener("pointermove",this.handleMove)}}class b extends x{strategy;constructor(e){super(e),this.strategy=e?.strategy||"close",this.on("multi click",(e=>{const u=u=>{this.emit("selection",{...e,precise:u})};if("move:holding"!==e.reason)switch(this.strategy){case"close":u(!1);break;case"double":2===e.count?u(!0):3===e.count&&u(!1);break;case"triple":3===e.count&&u(!0)}else u(!1)})),this.on("end",(e=>{"triple"!==this.strategy||2!==e.count||"timeout:down"!==e.reason&&"move:released"!==e.reason||this.emit("selection",{...e,precise:!1})}))}}const S=N()(i.$?"top frame detector worker":"detector worker"),O=o()(_.g2,["modifierKeys"]);class M{constructor(e){this.messagePassingBetweenFrames=new I.B,this.postMsgToTopmostFrame=e?u=>{e(u)}:e=>{this.messagePassingBetweenFrames.tell(e,"top")},window.addEventListener("keyup",(e=>{27===e.keyCode&&this.postMsgToTopmostFrame({type:"HCFY_SELECTION_EVENT_ESC_KEY"})})),document.addEventListener("pointerdown",(e=>{i.$&&"__hcfy__"===e.target.id||this.postMsgToTopmostFrame({type:"HCFY_SELECTION_EVENT_MOUSEDOWN",event:o()(e,["target.id"])})}),!0),window.addEventListener("scroll",(e=>{this.postMsgToTopmostFrame({type:"HCFY_SELECTION_EVENT_SCROLL",event:i.$?e:void 0})}),!0);const u=o()(_.g2,["multiClick"]),t=new b({strategy:u.multiClick,element:()=>document.body});(0,v.A)(u,(({multiClick:e})=>{e&&(t.strategy=e)})),t.on("selection",(e=>{setTimeout((()=>{const u=p({reason:"mouseup"},e.precise,e.event);this.bubbleInfoMsg(u)}))})),(0,v.A)(O,(({modifierKeys:e})=>{this.removeModifierKeys&&this.removeModifierKeys(),e&&e.length&&(this.removeModifierKeys=(0,T.ot)(e,(()=>{this.postMsgToTopmostFrame({type:"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_ACTIVE"})}),(()=>{this.postMsgToTopmostFrame({type:"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_RELEASED"})}),(()=>{this.postMsgToTopmostFrame({type:"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_INTERRUPTED"})})))})),this.messagePassingBetweenFrames.on("message",(e=>{const u=e;if(u)if("HCFY_SELECTION_EVENT_BUBBLE_SELECTION_INFO"===u.type){S("接收到子 worker 上报的划词信息",u);const e=function(e){const u=e.data,t=B()(u.path);if(!t)return;const n=document.querySelectorAll("iframe,frame");let o;const i=window.frames[t.frameIndex];if(i?Array.prototype.some.call(n,(e=>{if(e.contentWindow===i)return o=e,!0})):console.error("【划词翻译】window.frames[childFrameInfo.frameIndex] 为空"),!o)return void console.error("【划词翻译】找不到对应的 iframe 元素。",t);t.rect=o.getBoundingClientRect();const s=window.getComputedStyle(o);return t.computedStyles={paddingLeft:Number(s.paddingLeft.slice(0,-2)),paddingTop:Number(s.paddingTop.slice(0,-2)),borderLeftWidth:Number(s.borderLeftWidth.slice(0,-2)),borderTopWidth:Number(s.borderTopWidth.slice(0,-2))},u.path.push(D()),e}(u);e&&this.bubbleInfoMsg(e)}else i.$||this.sendMsg(u)}))}sendMsg(e){switch(S(i.$?"接收到来自顶层窗口直接发送的消息":"接收到来自 message 事件的消息",e),e.type){case"HCFY_SELECTION_EVENT_REPORT_INFO_PROACTIVE":const u=p({reason:"proactive",mid:e.mid});return i.$||this.bubbleInfoMsg(u),u;case"HCFY_SELECTION_EVENT_DISABLE_LINK":return document.head.appendChild(f),void window.addEventListener("click",g,!0);case"HCFY_SELECTION_EVENT_ENABLE_LINK":return document.head.contains(f)&&document.head.removeChild(f),void window.removeEventListener("click",g,!0);case"HCFY_SELECTION_EVENT_ENABLE_HOVER_TRANSLATE":return void(this.hs=new w.A((()=>{this.bubbleInfoMsg(p({reason:"hover"}))}),500));case"HCFY_SELECTION_EVENT_DISABLE_HOVER_TRANSLATE":return this.hs?.destroy(),void delete this.hs}}bubbleInfoMsg(e){if(i.$){const u={type:"HCFY_SELECTION_EVENT_RECEIVE_SELECTION_INFO",data:e.data,meta:e.meta};this.postMsgToTopmostFrame(u)}else this.messagePassingBetweenFrames.tell(e,"parent")}}},65040:(e,u,t)=>{t.d(u,{$:()=>n});const n=window.top===window},6747:(e,u,t)=>{t.d(u,{Ay:()=>r});t(61412),t(91883),t(70286);var n=t(74874),o=t.n(n),i=t(16224);const s=chrome.runtime.getURL("/pdf-viewer/web/viewer.html");o()(i.g2,["pdfStandalone"]);function r(e){return e.startsWith(s)}},2643:(e,u,t)=>{function n(e){return"object"==typeof e&&null!=e}t.d(u,{Z:()=>n})}}]);