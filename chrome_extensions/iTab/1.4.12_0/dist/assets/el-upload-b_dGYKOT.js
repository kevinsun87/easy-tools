import{k as e,N as t,m as s,a,c as l,p as o,G as i,H as r,q as n,F as u,y as d,z as c,u as p,bF as f,A as m,J as v,t as y,bH as g,I as h,B as b,C as k,a2 as w,aB as F,s as R,bN as E,d as S,w as x,j,aY as $,bi as C,af as T,K as _}from"./index-CyyLRP8W.js";import{ElIcon as L}from"./index-D4GlTUBi.js";import{aF as U,b as P,H as O,a as B,ab as H,aj as q,r as D}from"./todo-nv2WtoEp.js";import{E as A}from"./el-progress-Cnh9MicU.js";import{t as K,d as z}from"./scroll-3JEGyj3w.js";import{m as M}from"./types-Ci7ev57k.js";import{b as N,d as X,u as G}from"./index-B3sKL47p.js";import{m as J}from"./typescript-CRqm1_SZ.js";import{_ as I,w as W}from"./plugin-vue_export-helper-O3gUY6pX.js";import{u as Y}from"./index-CXKOYI6o.js";import{c as Q}from"./use-form-item-CUGNa-4i.js";import{e as V}from"./use-global-config-DcVlDyFX.js";import{i as Z}from"./isEqual-DOZxeYFr.js";import{d as ee}from"./index-BrMlOSMZ.js";const te=Symbol("uploadContextKey");class se extends Error{constructor(e,t,s,a){super(e),this.name="UploadAjaxError",this.status=t,this.method=s,this.url=a}}function ae(e,t,s){let a;return a=s.response?`${s.response.error||s.response}`:s.responseText?`${s.responseText}`:`fail to ${t.method} ${e} ${s.status}`,new se(a,s.status,t.method,e)}const le=["text","picture","picture-card"];let oe=1;const ie=()=>Date.now()+oe++,re=N({action:{type:String,default:"#"},headers:{type:X(Object)},method:{type:String,default:"post"},data:{type:X([Object,Function,Promise]),default:()=>J({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:X(Array),default:()=>J([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:le,default:"text"},httpRequest:{type:X(Function),default:t=>{"undefined"==typeof XMLHttpRequest&&K("ElUpload","XMLHttpRequest is undefined");const s=new XMLHttpRequest,a=t.action;s.upload&&s.upload.addEventListener("progress",(e=>{const s=e;s.percent=e.total>0?e.loaded/e.total*100:0,t.onProgress(s)}));const l=new FormData;if(t.data)for(const[i,r]of Object.entries(t.data))e(r)&&r.length?l.append(i,...r):l.append(i,r);l.append(t.filename,t.file,t.file.name),s.addEventListener("error",(()=>{t.onError(ae(a,t,s))})),s.addEventListener("load",(()=>{if(s.status<200||s.status>=300)return t.onError(ae(a,t,s));t.onSuccess(function(e){const t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(s){return t}}(s))})),s.open(t.method,a,!0),t.withCredentials&&"withCredentials"in s&&(s.withCredentials=!0);const o=t.headers||{};if(o instanceof Headers)o.forEach(((e,t)=>s.setRequestHeader(t,e)));else for(const[e,i]of Object.entries(o))M(i)||s.setRequestHeader(e,String(i));return s.send(l),s}},disabled:Boolean,limit:Number}),ne=N({...re,beforeUpload:{type:X(Function),default:t},beforeRemove:{type:X(Function)},onRemove:{type:X(Function),default:t},onChange:{type:X(Function),default:t},onPreview:{type:X(Function),default:t},onSuccess:{type:X(Function),default:t},onProgress:{type:X(Function),default:t},onError:{type:X(Function),default:t},onExceed:{type:X(Function),default:t},crossorigin:{type:X(String)}}),ue=N({files:{type:X(Array),default:()=>J([])},disabled:{type:Boolean,default:!1},handlePreview:{type:X(Function),default:t},listType:{type:String,values:le,default:"text"},crossorigin:{type:X(String)}}),de=["onKeydown"],ce=["src","crossorigin"],pe=["onClick"],fe=["title"],me=["onClick"],ve=["onClick"],ye=s({name:"ElUploadList"});var ge=I(s({...ye,props:ue,emits:{remove:e=>!!e},setup(e,{emit:t}){const s=e,{t:F}=Y(),R=G("upload"),E=G("icon"),S=G("list"),x=Q(),j=a(!1),$=l((()=>[R.b("list"),R.bm("list",s.listType),R.is("disabled",s.disabled)])),C=e=>{t("remove",e)};return(e,t)=>(o(),i(w,{tag:"ul",class:c(p($)),name:p(S).b()},{default:r((()=>[(o(!0),n(u,null,d(e.files,(s=>(o(),n("li",{key:s.uid||s.name,class:c([p(R).be("list","item"),p(R).is(s.status),{focusing:j.value}]),tabindex:"0",onKeydown:f((e=>!p(x)&&C(s)),["delete"]),onFocus:t[0]||(t[0]=e=>j.value=!0),onBlur:t[1]||(t[1]=e=>j.value=!1),onClick:t[2]||(t[2]=e=>j.value=!1)},[m(e.$slots,"default",{file:s},(()=>["picture"===e.listType||"uploading"!==s.status&&"picture-card"===e.listType?(o(),n("img",{key:0,class:c(p(R).be("list","item-thumbnail")),src:s.url,crossorigin:e.crossorigin,alt:""},null,10,ce)):v("v-if",!0),"uploading"===s.status||"picture-card"!==e.listType?(o(),n("div",{key:1,class:c(p(R).be("list","item-info"))},[y("a",{class:c(p(R).be("list","item-name")),onClick:g((t=>e.handlePreview(s)),["prevent"])},[h(p(L),{class:c(p(E).m("document"))},{default:r((()=>[h(p(U))])),_:1},8,["class"]),y("span",{class:c(p(R).be("list","item-file-name")),title:s.name},b(s.name),11,fe)],10,pe),"uploading"===s.status?(o(),i(p(A),{key:0,type:"picture-card"===e.listType?"circle":"line","stroke-width":"picture-card"===e.listType?6:2,percentage:Number(s.percentage),style:k("picture-card"===e.listType?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):v("v-if",!0)],2)):v("v-if",!0),y("label",{class:c(p(R).be("list","item-status-label"))},["text"===e.listType?(o(),i(p(L),{key:0,class:c([p(E).m("upload-success"),p(E).m("circle-check")])},{default:r((()=>[h(p(P))])),_:1},8,["class"])):["picture-card","picture"].includes(e.listType)?(o(),i(p(L),{key:1,class:c([p(E).m("upload-success"),p(E).m("check")])},{default:r((()=>[h(p(O))])),_:1},8,["class"])):v("v-if",!0)],2),p(x)?v("v-if",!0):(o(),i(p(L),{key:2,class:c(p(E).m("close")),onClick:e=>C(s)},{default:r((()=>[h(p(B))])),_:2},1032,["class","onClick"])),v(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),v(" This is a bug which needs to be fixed "),v(" TODO: Fix the incorrect navigation interaction "),p(x)?v("v-if",!0):(o(),n("i",{key:3,class:c(p(E).m("close-tip"))},b(p(F)("el.upload.deleteTip")),3)),"picture-card"===e.listType?(o(),n("span",{key:4,class:c(p(R).be("list","item-actions"))},[y("span",{class:c(p(R).be("list","item-preview")),onClick:t=>e.handlePreview(s)},[h(p(L),{class:c(p(E).m("zoom-in"))},{default:r((()=>[h(p(H))])),_:1},8,["class"])],10,me),p(x)?v("v-if",!0):(o(),n("span",{key:0,class:c(p(R).be("list","item-delete")),onClick:e=>C(s)},[h(p(L),{class:c(p(E).m("delete"))},{default:r((()=>[h(p(q))])),_:1},8,["class"])],10,ve))],2)):v("v-if",!0)]))],42,de)))),128)),m(e.$slots,"append")])),_:3},8,["class","name"]))}}),[["__file","upload-list.vue"]]);const he=N({disabled:{type:Boolean,default:!1}}),be={file:t=>e(t)},ke=["onDrop","onDragover"],we="ElUploadDrag",Fe=s({name:we});var Re=I(s({...Fe,props:he,emits:be,setup(e,{emit:t}){F(te)||K(we,"usage: <el-upload><el-upload-dragger /></el-upload>");const s=G("upload"),l=a(!1),i=Q(),r=e=>{if(i.value)return;l.value=!1,e.stopPropagation();const s=Array.from(e.dataTransfer.files);t("file",s)},u=()=>{i.value||(l.value=!0)};return(e,t)=>(o(),n("div",{class:c([p(s).b("dragger"),p(s).is("dragover",l.value)]),onDrop:g(r,["prevent"]),onDragover:g(u,["prevent"]),onDragleave:t[0]||(t[0]=g((e=>l.value=!1),["prevent"]))},[m(e.$slots,"default")],42,ke))}}),[["__file","upload-dragger.vue"]]);const Ee=N({...re,beforeUpload:{type:X(Function),default:t},onRemove:{type:X(Function),default:t},onStart:{type:X(Function),default:t},onSuccess:{type:X(Function),default:t},onProgress:{type:X(Function),default:t},onError:{type:X(Function),default:t},onExceed:{type:X(Function),default:t}}),Se=["onKeydown"],xe=["name","multiple","accept"],je=s({name:"ElUploadContent",inheritAttrs:!1});var $e=I(s({...je,props:Ee,setup(e,{expose:t}){const s=e,a=G("upload"),l=Q(),u=R({}),d=R(),v=e=>{if(0===e.length)return;const{autoUpload:t,limit:a,fileList:l,multiple:o,onStart:i,onExceed:r}=s;if(a&&l.length+e.length>a)r(e,l);else{o||(e=e.slice(0,1));for(const s of e){const e=s;e.uid=ie(),i(e),t&&h(e)}}},h=async e=>{if(d.value.value="",!s.beforeUpload)return b(e);let t,a={};try{const l=s.data,o=s.beforeUpload(e);a=E(s.data)?D(s.data):s.data,t=await o,E(s.data)&&Z(l,a)&&(a=D(s.data))}catch(o){t=!1}if(!1===t)return void s.onRemove(e);let l=e;t instanceof Blob&&(l=t instanceof File?t:new File([t],e.name,{type:e.type})),b(Object.assign(l,{uid:e.uid}),a)},b=async(e,t)=>{const{headers:a,data:l,method:o,withCredentials:i,name:r,action:n,onProgress:d,onSuccess:c,onError:p,httpRequest:f}=s;try{t=await(async(e,t)=>S(e)?e(t):e)(null!=t?t:l,e)}catch(g){return void s.onRemove(e)}const{uid:m}=e,v={headers:a||{},withCredentials:i,file:e,data:t,method:o,filename:r,action:n,onProgress:t=>{d(t,e)},onSuccess:t=>{c(t,e),delete u.value[m]},onError:t=>{p(t,e),delete u.value[m]}},y=f(v);u.value[m]=y,y instanceof Promise&&y.then(v.onSuccess,v.onError)},k=e=>{const t=e.target.files;t&&v(Array.from(t))},w=()=>{l.value||(d.value.value="",d.value.click())},F=()=>{w()};return t({abort:e=>{V(u.value).filter(e?([t])=>String(e.uid)===t:()=>!0).forEach((([e,t])=>{t instanceof XMLHttpRequest&&t.abort(),delete u.value[e]}))},upload:h}),(e,t)=>(o(),n("div",{class:c([p(a).b(),p(a).m(e.listType),p(a).is("drag",e.drag)]),tabindex:"0",onClick:w,onKeydown:f(g(F,["self"]),["enter","space"])},[e.drag?(o(),i(Re,{key:0,disabled:p(l),onFile:v},{default:r((()=>[m(e.$slots,"default")])),_:3},8,["disabled"])):m(e.$slots,"default",{key:1}),y("input",{ref_key:"inputRef",ref:d,class:c(p(a).e("input")),name:e.name,multiple:e.multiple,accept:e.accept,type:"file",onChange:k,onClick:t[0]||(t[0]=g((()=>{}),["stop"]))},null,42,xe)],42,Se))}}),[["__file","upload-content.vue"]]);const Ce="ElUpload",Te=e=>{var t;(null==(t=e.url)?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(e.url)},_e=s({name:"ElUpload"});const Le=W(I(s({..._e,props:ne,setup(e,{expose:t}){const s=e,a=Q(),u=R(),{abort:d,submit:c,clearFiles:f,uploadFiles:y,handleStart:g,handleError:b,handleRemove:k,handleSuccess:w,handleProgress:F,revokeFileObjectURL:E}=((e,t)=>{const s=ee(e,"fileList",void 0,{passive:!0}),a=e=>s.value.find((t=>t.uid===e.uid));function l(e){var s;null==(s=t.value)||s.abort(e)}return x((()=>e.listType),(t=>{"picture-card"!==t&&"picture"!==t||(s.value=s.value.map((t=>{const{raw:a,url:l}=t;if(!l&&a)try{t.url=URL.createObjectURL(a)}catch(o){e.onError(o,t,s.value)}return t})))})),x(s,(e=>{for(const t of e)t.uid||(t.uid=ie()),t.status||(t.status="success")}),{immediate:!0,deep:!0}),{uploadFiles:s,abort:l,clearFiles:function(e=["ready","uploading","success","fail"]){s.value=s.value.filter((t=>!e.includes(t.status)))},handleError:(t,l)=>{const o=a(l);o&&(o.status="fail",s.value.splice(s.value.indexOf(o),1),e.onError(t,o,s.value),e.onChange(o,s.value))},handleProgress:(t,l)=>{const o=a(l);o&&(e.onProgress(t,o,s.value),o.status="uploading",o.percentage=Math.round(t.percent))},handleStart:t=>{M(t.uid)&&(t.uid=ie());const a={name:t.name,percentage:0,status:"ready",size:t.size,raw:t,uid:t.uid};if("picture-card"===e.listType||"picture"===e.listType)try{a.url=URL.createObjectURL(t)}catch(l){z(Ce,l.message),e.onError(l,a,s.value)}s.value=[...s.value,a],e.onChange(a,s.value)},handleSuccess:(t,l)=>{const o=a(l);o&&(o.status="success",o.response=t,e.onSuccess(t,o,s.value),e.onChange(o,s.value))},handleRemove:async t=>{const o=t instanceof File?a(t):t;o||K(Ce,"file to be removed not found");const i=t=>{l(t);const a=s.value;a.splice(a.indexOf(t),1),e.onRemove(t,a),Te(t)};e.beforeRemove?!1!==await e.beforeRemove(o,s.value)&&i(o):i(o)},submit:function(){s.value.filter((({status:e})=>"ready"===e)).forEach((({raw:e})=>{var s;return e&&(null==(s=t.value)?void 0:s.upload(e))}))},revokeFileObjectURL:Te}})(s,u),S=l((()=>"picture-card"===s.listType)),L=l((()=>({...s,fileList:y.value,onStart:g,onProgress:F,onSuccess:w,onError:b,onRemove:k})));return j((()=>{y.value.forEach(E)})),$(te,{accept:C(s,"accept")}),t({abort:d,submit:c,clearFiles:f,handleStart:g,handleRemove:k}),(e,t)=>(o(),n("div",null,[p(S)&&e.showFileList?(o(),i(ge,{key:0,disabled:p(a),"list-type":e.listType,files:p(y),crossorigin:e.crossorigin,"handle-preview":e.onPreview,onRemove:p(k)},T({append:r((()=>[h($e,_({ref_key:"uploadRef",ref:u},p(L)),{default:r((()=>[e.$slots.trigger?m(e.$slots,"trigger",{key:0}):v("v-if",!0),!e.$slots.trigger&&e.$slots.default?m(e.$slots,"default",{key:1}):v("v-if",!0)])),_:3},16)])),_:2},[e.$slots.file?{name:"default",fn:r((({file:t})=>[m(e.$slots,"file",{file:t})]))}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):v("v-if",!0),!p(S)||p(S)&&!e.showFileList?(o(),i($e,_({key:1,ref_key:"uploadRef",ref:u},p(L)),{default:r((()=>[e.$slots.trigger?m(e.$slots,"trigger",{key:0}):v("v-if",!0),!e.$slots.trigger&&e.$slots.default?m(e.$slots,"default",{key:1}):v("v-if",!0)])),_:3},16)):v("v-if",!0),e.$slots.trigger?m(e.$slots,"default",{key:2}):v("v-if",!0),m(e.$slots,"tip"),!p(S)&&e.showFileList?(o(),i(ge,{key:3,disabled:p(a),"list-type":e.listType,files:p(y),crossorigin:e.crossorigin,"handle-preview":e.onPreview,onRemove:p(k)},T({_:2},[e.$slots.file?{name:"default",fn:r((({file:t})=>[m(e.$slots,"file",{file:t})]))}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):v("v-if",!0)]))}}),[["__file","upload.vue"]]));export{Le as E};
