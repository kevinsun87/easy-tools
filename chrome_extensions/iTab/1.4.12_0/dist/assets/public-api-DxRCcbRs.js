const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./indexdb-D6yYQ1E4.js","./localforage-BVRgvwJc.js","./index-BU0epQJo.js","./index-CyyLRP8W.js","./index-4Dsu8OkH.css","./index-BrMlOSMZ.js","./types-Ci7ev57k.js","./index-B3sKL47p.js","./plugin-vue_export-helper-O3gUY6pX.js","./style-BBQwFGbP.js","./index-DjlyN6je.js","./index-D4GlTUBi.js","./typescript-CRqm1_SZ.js","./icon-Dsqoi_oS.js","./todo-nv2WtoEp.js","./todo-Dkv1bMMm.css","./use-global-config-DcVlDyFX.js","./index-CXKOYI6o.js","./_baseGet-DEcaJYAt.js","./isSymbol-Bt1TyP4H.js","./index-CB1eEFAV.js","./aria-BUADUvnR.js","./config-provider-Bf5G9WCh.js","./index-BFuAB0_P.js"])))=>i.map(i=>d[i]);
import{o as e,m as t,N as a,O as o,I as n,n as i,P as s,_ as l,G as g}from"./todo-nv2WtoEp.js";import{d as c}from"./localforage-BVRgvwJc.js";import{b as r}from"./baseRequest-CU9cTnaC.js";import{d}from"./website-CoEF8fmW.js";import{dToast as f}from"./index-DvjFJXYU.js";import u from"./indexdb-D6yYQ1E4.js";import p from"./eventBus-BB4cUTPt.js";import{u as m}from"./userInfo-CZAB7rZN.js";const h=(e={})=>r.get("/user/login",{params:e}),b=(e={})=>r.get("/user/info",{params:e}),y=(e={})=>r.post("/user/registry",e),v=(e={})=>r.post("/user/sendVerifyCode",e),w=(e={})=>r.get("/itab/config",{params:e}),_=e(),x=t(),C=a(),T=o(),k=n(),j=[{key:"baidu",title:"百度",href:"https://www.baidu.com/s?&tn=52176495_dg&ch=2&wd="},{key:"google",title:"Google",href:"https://www.google.com/search?q="},{key:"bing",title:"必应",href:"https://www.bing.com/search?q="},{key:"metaso",title:"秘塔AI",href:"https://metaso.cn/?s=itab1&q="}];!C.value&&(C.value=[]),!T.value&&(T.value=[]);const A=e=>{var t,a,o;e.baseConfig&&(e.baseConfig.searchEngine||(e.baseConfig.searchEngine=j),e.baseConfig.open||(e.baseConfig.open={searchBlank:null==(a=null==(t=e.baseConfig)?void 0:t.search)?void 0:a.blank,iconBlank:null==(o=x.value.search)?void 0:o.blank}),x.value=e.baseConfig),e.navConfig&&(_.value=e.navConfig,localStorage.setItem("dataCleansing","")),e.todo&&(u.set("todo",e.todo),C.value=e.todo.slice(0,5)),e.todoFolder&&u.set("todoFolder",e.todoFolder),e.notes&&(u.set("notes",e.notes),T.value=e.notes.slice(0,3),s.value=e.notes.filter((e=>e&&e.fixed))),e.stocks&&(k.value=e.stocks),e.exchangerate&&p.emit("app-exchangerate-icon",e.exchangerate.icon,e.exchangerate.config,!0),localStorage.setItem("dataCleansing","null")};window.addEventListener("storage",(t=>{if("navConfig"===t.key){let t=i.get("navConfig")||[];t.length&&(_.value=t,e().value=t)}}));const E=(e,t)=>{i.get("token")&&(i.set("asyncTime",t),e||(e={baseConfig:1,navConfig:1,notes:1,todo:1,todoFolder:1,exchangerate:1}),f("同步中","loading"),w(e).then((e=>{f("同步成功","check");let t=e.data;t&&t.iTabConfig&&(t=JSON.parse(t.iTabConfig)),t&&A(t)})))},O=t(),I=m(),D=async()=>{let e=await l((()=>import("./indexdb-D6yYQ1E4.js")),__vite__mapDeps([0,1]),import.meta.url);e=e.default;let t=await e.get("todayBing"),a=c().format("YYYYMMDD");if(t&&t.enddate==a)return t;let o=await r.get("/api/bing"),n=o.data||{};return e.get("updateDefaultUseSearch").then((t=>{let a=n.updateBaidu;t!=a&&(O.value.useSearch="baidu",e.set("updateDefaultUseSearch",a))})),e.set("todayBing",o.data||{}),i.set("todayBing",{thumb:n.thumb,copyright:n.copyright}),n||{}};async function B(e,t){for(let a=0;a<e.length;a++)await t(e[a],a,e)}const F=["baseConfig","navConfig","notes","todo","todoFolder","stocks","exchangerate"],S=async e=>{let t=await l((()=>import("./indexdb-D6yYQ1E4.js")),__vite__mapDeps([0,1]),import.meta.url);t=t.default,t.get("configHistory").then((async e=>{let a=e||[],o={};await B(F,(async e=>{if("exchangerate"===e){let a={icon:await t.get("app-exchangerate-icon"),config:i.get("app-exchangerate-config")};o[e]=a}else if(["notes","todo","todoFolder"].includes(e)){let a=await t.get(e)||i.get(e)||[];o[e]=a}else o[e]=i.get(e)})),a.unshift({data:o||[],ct:c().valueOf()}),t.set("configHistory",a.slice(0,10)).then((e=>{}))}))},L=async(e,t)=>{let a=await l((()=>import("./indexdb-D6yYQ1E4.js")),__vite__mapDeps([0,1]),import.meta.url);if(a=a.default,a.get("configHistory").then((async t=>{let o=t||[];if("navConfig"===e||!e){let e={};await B(F,(async t=>{if("exchangerate"===t){let o={icon:await a.get("app-exchangerate-icon"),config:i.get("app-exchangerate-config")};e[t]=o}else if(["notes","todo","todoFolder"].includes(t)){let o=await a.get(t)||i.get(t)||[];e[t]=o}else e[t]=i.get(t)})),o.unshift({data:e||[],ct:c().valueOf()}),a.set("configHistory",o.slice(0,10))}})),!i.get("token"))return;let o={},n={saveType:t},s=I.value.itabAsyncTime||{};if(e){let t=c().valueOf(),l=["notes","todo","todoFolder"];if("exchangerate"===e){let t={icon:await a.get("app-exchangerate-icon"),config:i.get("app-exchangerate-config")};n[e]=t}else if(l.includes(e)){let t=await a.get(e)||i.get(e)||[];n[e]=t}else n[e]=i.get(e);s[e]=t,o[`itabAsyncTime.${e}`]=t}else{let e=c().valueOf();await B(F,(async t=>{s[t]=e;if("exchangerate"===t){let e={icon:await a.get("app-exchangerate-icon"),config:i.get("app-exchangerate-config")};n[t]=e}else if(["notes","todo"].includes(t)){let e=await a.get(t)||i.get(t)||[];n[t]=e}else n[t]=i.get(t);o[`itabAsyncTime.${t}`]=e}))}f("备份中...","loading"),((e={})=>r.post("/itab/update",e))(n).then((()=>{((e={})=>{r.post("/user/update",e)})(o),i.set("asyncTime",s),setTimeout((()=>{f("备份成功","check")}),260),I.value.itabAsyncTime=s})).catch((()=>{f("备份失败","close"),l((()=>import("./index-BU0epQJo.js")),__vite__mapDeps([2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]),import.meta.url).then((e=>{e.ElMessage({type:"error",message:"备份失败，稍后请手动尝试",duration:0,showClose:!0})}))}))},P=Object.freeze(Object.defineProperty({__proto__:null,asyncConfig:async e=>{if(!I.value._id)return{};if(i.get("asyncTime")[e]==I.value.itabAsyncTime[e])return{};f("同步中","loading");let t={};t[e]=1;let a=await w(t);return f("同步成功","check"),a},delIcon:async e=>{if(e&&e.includes("user_")){let t=[e.replace("https://files.codelife.cc/","")];d({paths:t})}},getTodayBing:D,getUserInfo:()=>{i.get("token")?b({from:"itab",t:(new Date).getTime()}).then((e=>{I.value=e.data||{};let t=i.get("asyncTime"),a={};for(let o in e.data.itabAsyncTime)t[o]!=e.data.itabAsyncTime[o]&&(a[o]=1);g(a)||E(a,e.data.itabAsyncTime)})):I.value={}},saveConfig:L,saveLocalConfig:S},Symbol.toStringTag,{value:"Module"}));export{E as A,h as a,S as b,v as c,y as d,D as g,P as p,L as s,b as u,A as w};
