import{a as s,b4 as e,p as i,G as t,H as a,t as o,v as l,B as n,u as r,I as m,L as p,x as c,q as d,J as u,F as j,y as f,K as v,E as g}from"./index-CyyLRP8W.js";import{b as x}from"./baseRequest-CU9cTnaC.js";import{n as b,L as y,M as h}from"./todo-nv2WtoEp.js";import{D as k}from"./d-tabs-x-fZyCMJeT.js";import{t as C}from"./timeFormat-qtCApzlE.js";import{w}from"./public-api-DxRCcbRs.js";/* empty css            */import"./css-DsIEOZKU.js";/* empty css                  *//* empty css                 *//* empty css                   */import"./css-D3Kd0WPg.js";import{E as H}from"./el-dialog-BoL22f5R.js";import"./css-X-yl6Ffy.js";import{SAVE_CONFIG as Y}from"./save_config-BtHImbsT.js";import _ from"./indexdb-D6yYQ1E4.js";import{D}from"./Delete16Regular-DgH01z7r.js";import{E as M}from"./index-CMn5lzXr.js";import{ElMessage as I}from"./index-BU0epQJo.js";import{ElLoading as E}from"./index-C3VYT6fr.js";import"./userInfo-CZAB7rZN.js";import"./localforage-BVRgvwJc.js";import"./version-DYnJBHiW.js";import"./website-CoEF8fmW.js";import"./index-DvjFJXYU.js";import"./index-D4GlTUBi.js";import"./index-B3sKL47p.js";import"./plugin-vue_export-helper-O3gUY6pX.js";import"./types-Ci7ev57k.js";import"./style-BBQwFGbP.js";import"./eventBus-BB4cUTPt.js";import"./index-CdRnR6wp.js";import"./scroll-3JEGyj3w.js";import"./vnode-CwyaGvUL.js";import"./use-dialog-0gmd-idO.js";import"./icon-Dsqoi_oS.js";import"./event-BwRzfsZt.js";import"./index-CB1eEFAV.js";import"./_baseGet-DEcaJYAt.js";import"./isSymbol-Bt1TyP4H.js";import"./focus-trap-D8QWET1-.js";import"./aria-BUADUvnR.js";import"./use-global-config-DcVlDyFX.js";import"./index-CXKOYI6o.js";import"./isUndefined-DgmxjSXK.js";import"./index-hc1PwDik.js";import"./index-DjlyN6je.js";import"./debounce-Dd9nEzpy.js";import"./index-BvBbK8nS.js";import"./use-form-item-CUGNa-4i.js";import"./constants-Dnj8X3EN.js";import"./index-BPnMED6p.js";import"./index-BrMlOSMZ.js";import"./typescript-CRqm1_SZ.js";import"./index-kxe6IHwf.js";import"./hasIn-y6DbaUwA.js";import"./index-DsFsGggn.js";import"./aria-C-hsWcn7.js";import"./validator-DvohupZ1.js";import"./config-provider-Bf5G9WCh.js";import"./index-BFuAB0_P.js";const T=o("div",{class:"ac f18 b mb10"},"历史备份节点列表",-1),q=o("p",{class:"f12 d-sub ac mb20 pr20 pl20"},[p(" 我们为您保留云端和本机各5个备份节点，云端历史备份需要登录后手动备份 "),o("br"),p(" 数据修复请联系开发者微信：xdlumia ")],-1),B={class:"p50 al f12",style:{"padding-top":"10px"}},F={class:"d-flex-between mt15"},G={class:"d-sub"},J={class:"d-icon f14",style:{"vertical-align":"-3px","margin-right":"4px"}},K={class:"d-flex-x mt10"},L={class:"mt20 mb10"},R=o("h2",{class:"d-main f16 b"},"云端历史备份节点",-1),U={key:0,class:"d-sub"},V={class:"history-list"},z={class:"d-sub"},N=["onClick"],O={class:"mr5 d-icon f14",style:{"vertical-align":"-3px"}},P=["onClick"],Q={key:0,class:"ac d-sub"},S=o("div",{class:"mt20 mb10"},[o("h2",{class:"d-main f16 b"},"本机历史备份节点"),o("p",{class:"d-sub"},"此历史列表备份只包含本机历史备份的列表")],-1),$={class:"history-list"},A={class:"d-sub"},W=["onClick"],Z={class:"mr5 d-icon f14",style:{"vertical-align":"-2px"}},X=["onClick"],ss={key:0,class:"ac d-sub"},es={__name:"hisBackup",setup(es){const is=s([]),ts=s(null),as=s([]),os=s("cloud");function ls(s){"cloud"==s.id?rs():ms()}const ns=s(!1);function rs(){ps()&&(ns.value=!0,((s={})=>x.get("/itab/userConfigHistory/list",{params:s}))({size:10}).then((s=>{is.value=s.data||[]})).finally((()=>{ns.value=!1})),((s={})=>x.get("/itab/config",{params:s}))({updateTime:1}).then((s=>{ts.value=s.data.updateTime})))}function ms(){_.get("configHistory").then((s=>{as.value=s||[]}))}function ps(){return!!b.get("token")}function cs(s){M.confirm("此操作将会删除云端历史备份数据, 是否继续?","删除数据",{center:!0,type:"warning"}).then((()=>{((s={})=>x.delete("/itab/userConfigHistory/del",{params:s}))({_id:s}).then((e=>{e.data.deletedCount&&(is.value.splice(is.value.findIndex((e=>e._id===s)),1),I({showClose:!0,message:"删除成功",type:"success"}))}))}))}function ds(s){M.confirm("此操作将会覆盖本地数据, 是否继续?","恢复数据",{center:!0,type:"warning"}).then((()=>{const e=E.service({lock:!0,text:"恢复备份节点",background:"rgba(0, 0, 0, 0.7)"});((s={})=>x.get("/itab/userConfigHistory/info",{params:s}))({_id:s}).then((s=>{let i=s.data;w(i),e.close(),I({showClose:!0,message:"恢复成功",type:"success"})}))}))}return rs(),ms(),(s,x)=>{const b=e("loading");return i(),t(r(H),v({class:"notion-dialog","close-on-press-escape":!1,width:"640px","append-to-body":""},s.$attrs),{default:a((()=>[T,q,o("div",B,[l(o("li",F,[o("span",G,"上次备份时间："+n(r(C)(ts.value,"YYYY年MM月DD日 HH:mm:ss")),1),o("span",{onClick:x[0]||(x[0]=s=>{M.confirm("将本地数据备份到云端?","备份数据",{center:!0,type:"warning"}).then((()=>{Y(null,100,"manua"),setTimeout((()=>{rs()}),200)}))}),class:"d-pointer d-main"},[o("i",J,[m(r(y))]),p("立即备份 ")])],512),[[c,ps()]]),o("div",K,[m(k,{modelValue:os.value,"onUpdate:modelValue":x[1]||(x[1]=s=>os.value=s),onTabClick:ls,data:[{name:"云端历史备份",id:"cloud"},{name:"本机历史备份",id:"local"}]},null,8,["modelValue"])]),l(o("div",null,[o("div",L,[R,ps()?u("",!0):(i(),d("p",U," 此功能需要登录使用，登录后可以查看多设备之间历史节点 "))]),l((i(),d("ul",V,[(i(!0),d(j,null,f(is.value,(s=>(i(),d("li",{class:"d-flex-between mt20",key:s},[o("span",z,n(r(C)(s.createTime,"YYYY年MM月DD日 HH:mm:ss")),1),o("div",null,[o("span",{class:"d-main d-pointer d-hover",onClick:e=>ds(s._id)},[o("i",O,[m(r(h))]),p("从此节点恢复 ")],8,N),o("i",{onClick:e=>cs(s._id),title:"删除当前备份",class:"ml5 d-icon f16 d-pointer d-hover",style:{"vertical-align":"-3px"}},[m(r(D))],8,P)])])))),128)),is.value.length?u("",!0):(i(),d("p",Q,"暂无历史节点备份"))])),[[b,ns.value]])],512),[[c,"cloud"===os.value]]),l(o("div",null,[S,o("ul",$,[(i(!0),d(j,null,f(as.value,(s=>(i(),d("li",{class:"d-flex-between mt20",key:s},[o("span",A,n(r(C)(s.ct,"YYYY年MM月DD日 HH:mm:ss")),1),o("div",null,[o("span",{class:"d-main d-pointer d-hover",onClick:e=>{return i=s.ct,void M.confirm("此操作将会覆盖本地数据, 是否继续?","恢复数据",{center:!0,type:"warning"}).then((()=>{let s=as.value.find((s=>s.ct===i));w(g(s.data)),I({showClose:!0,message:"恢复成功",type:"success"})}));var i}},[o("i",Z,[m(r(h))]),p("从此节点恢复 ")],8,W),o("i",{onClick:e=>{return i=s.ct,void M.confirm("此操作将会删除本地历史备份数据, 是否继续?","删除数据",{center:!0,type:"warning"}).then((()=>{let s=as.value.findIndex((s=>s.ct===i));as.value.splice(s,1),_.set("configHistory",g(as.value))}));var i},title:"删除当前备份",class:"ml5 d-icon f16 d-pointer d-hover",style:{"vertical-align":"-3px"}},[m(r(D))],8,X)])])))),128)),as.value.length?u("",!0):(i(),d("p",ss,"暂无历史节点备份"))])],512),[[c,"local"===os.value]])])])),_:1},16)}}};export{es as default};
