import{u as e}from"./index-BrMlOSMZ.js";import{m as a,aI as l,a as s,as as t,s as o,c as n,w as i,n as r,o as c,p as u,G as d,I as v,H as f,t as m,z as p,u as g,C as y,bH as b,J as k,q as w,F as x,b5 as h,y as z,v as I,x as C,A as _,a1 as S,Z as O,bn as N,B as j,K as A,i as T}from"./index-CyyLRP8W.js";import{ElIcon as L}from"./index-D4GlTUBi.js";import{a6 as E,a7 as R,a as B,a8 as Y,a9 as $,aa as X,ab as F,ac as H,ad as M}from"./todo-nv2WtoEp.js";import{b as P,d as D,u as G}from"./index-B3sKL47p.js";import{m as V}from"./typescript-CRqm1_SZ.js";import{g as q,c as J,j as K,o as W}from"./types-Ci7ev57k.js";import{_ as Z,w as Q}from"./plugin-vue_export-helper-O3gUY6pX.js";import{u as U}from"./index-CXKOYI6o.js";import{u as ee}from"./index-CB1eEFAV.js";import{E as ae}from"./aria-BUADUvnR.js";import{k as le}from"./use-global-config-DcVlDyFX.js";import{t as se}from"./throttle-1HGvzIm8.js";import{u as te}from"./index-DsFsGggn.js";import{i as oe}from"./position-C03YnYn2.js";import{g as ne}from"./scroll-3JEGyj3w.js";const ie=P({urlList:{type:D(Array),default:()=>V([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:D(String)}}),re={close:()=>!0,switch:e=>q(e),rotate:e=>q(e)},ce=["src","crossorigin"],ue=a({name:"ElImageViewer"});const de=Q(Z(a({...ue,props:ie,emits:re,setup(a,{expose:N,emit:j}){var A;const T=a,P={CONTAIN:{name:"contain",icon:l(E)},ORIGINAL:{name:"original",icon:l(R)}},{t:D}=U(),V=G("image-viewer"),{nextZIndex:q}=ee(),J=s(),K=s([]),W=t(),Z=s(!0),Q=s(T.initialIndex),te=o(P.CONTAIN),oe=s({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ne=s(null!=(A=T.zIndex)?A:q()),ie=n((()=>{const{urlList:e}=T;return e.length<=1})),re=n((()=>0===Q.value)),ue=n((()=>Q.value===T.urlList.length-1)),de=n((()=>T.urlList[Q.value])),ve=n((()=>[V.e("btn"),V.e("prev"),V.is("disabled",!T.infinite&&re.value)])),fe=n((()=>[V.e("btn"),V.e("next"),V.is("disabled",!T.infinite&&ue.value)])),me=n((()=>{const{scale:e,deg:a,offsetX:l,offsetY:s,enableTransition:t}=oe.value;let o=l/e,n=s/e;switch(a%360){case 90:case-270:[o,n]=[n,-o];break;case 180:case-180:[o,n]=[-o,-n];break;case 270:case-90:[o,n]=[-n,o]}const i={transform:`scale(${e}) rotate(${a}deg) translate(${o}px, ${n}px)`,transition:t?"transform .3s":""};return te.value.name===P.CONTAIN.name&&(i.maxWidth=i.maxHeight="100%"),i}));function pe(){W.stop(),j("close")}function ge(){Z.value=!1}function ye(e){Z.value=!1,e.target.alt=D("el.image.error")}function be(a){if(Z.value||0!==a.button||!J.value)return;oe.value.enableTransition=!1;const{offsetX:l,offsetY:s}=oe.value,t=a.pageX,o=a.pageY,n=se((e=>{oe.value={...oe.value,offsetX:l+e.pageX-t,offsetY:s+e.pageY-o}})),i=e(document,"mousemove",n);e(document,"mouseup",(()=>{i()})),a.preventDefault()}function ke(){oe.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function we(){if(Z.value)return;const e=le(P),a=Object.values(P),l=te.value.name,s=(a.findIndex((e=>e.name===l))+1)%e.length;te.value=P[e[s]],ke()}function xe(e){const a=T.urlList.length;Q.value=(e+a)%a}function he(){re.value&&!T.infinite||xe(Q.value-1)}function ze(){ue.value&&!T.infinite||xe(Q.value+1)}function Ie(e,a={}){if(Z.value)return;const{minScale:l,maxScale:s}=T,{zoomRate:t,rotateDeg:o,enableTransition:n}={zoomRate:T.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":oe.value.scale>l&&(oe.value.scale=Number.parseFloat((oe.value.scale/t).toFixed(3)));break;case"zoomIn":oe.value.scale<s&&(oe.value.scale=Number.parseFloat((oe.value.scale*t).toFixed(3)));break;case"clockwise":oe.value.deg+=o,j("rotate",oe.value.deg);break;case"anticlockwise":oe.value.deg-=o,j("rotate",oe.value.deg)}oe.value.enableTransition=n}return i(de,(()=>{r((()=>{const e=K.value[0];(null==e?void 0:e.complete)||(Z.value=!0)}))})),i(Q,(e=>{ke(),j("switch",e)})),c((()=>{var a,l;!function(){const a=se((e=>{switch(e.code){case ae.esc:T.closeOnPressEscape&&pe();break;case ae.space:we();break;case ae.left:he();break;case ae.up:Ie("zoomIn");break;case ae.right:ze();break;case ae.down:Ie("zoomOut")}})),l=se((e=>{Ie((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:T.zoomRate,enableTransition:!1})}));W.run((()=>{e(document,"keydown",a),e(document,"wheel",l)}))}(),null==(l=null==(a=J.value)?void 0:a.focus)||l.call(a)})),N({setActiveItem:xe}),(e,a)=>(u(),d(O,{to:"body",disabled:!e.teleported},[v(S,{name:"viewer-fade",appear:""},{default:f((()=>[m("div",{ref_key:"wrapper",ref:J,tabindex:-1,class:p(g(V).e("wrapper")),style:y({zIndex:ne.value})},[m("div",{class:p(g(V).e("mask")),onClick:a[0]||(a[0]=b((a=>e.hideOnClickModal&&pe()),["self"]))},null,2),k(" CLOSE "),m("span",{class:p([g(V).e("btn"),g(V).e("close")]),onClick:pe},[v(g(L),null,{default:f((()=>[v(g(B))])),_:1})],2),k(" ARROW "),g(ie)?k("v-if",!0):(u(),w(x,{key:0},[m("span",{class:p(g(ve)),onClick:he},[v(g(L),null,{default:f((()=>[v(g(Y))])),_:1})],2),m("span",{class:p(g(fe)),onClick:ze},[v(g(L),null,{default:f((()=>[v(g($))])),_:1})],2)],64)),k(" ACTIONS "),m("div",{class:p([g(V).e("btn"),g(V).e("actions")])},[m("div",{class:p(g(V).e("actions__inner"))},[v(g(L),{onClick:a[1]||(a[1]=e=>Ie("zoomOut"))},{default:f((()=>[v(g(X))])),_:1}),v(g(L),{onClick:a[2]||(a[2]=e=>Ie("zoomIn"))},{default:f((()=>[v(g(F))])),_:1}),m("i",{class:p(g(V).e("actions__divider"))},null,2),v(g(L),{onClick:we},{default:f((()=>[(u(),d(h(g(te).icon)))])),_:1}),m("i",{class:p(g(V).e("actions__divider"))},null,2),v(g(L),{onClick:a[3]||(a[3]=e=>Ie("anticlockwise"))},{default:f((()=>[v(g(H))])),_:1}),v(g(L),{onClick:a[4]||(a[4]=e=>Ie("clockwise"))},{default:f((()=>[v(g(M))])),_:1})],2)],2),k(" CANVAS "),m("div",{class:p(g(V).e("canvas"))},[(u(!0),w(x,null,z(e.urlList,((a,l)=>I((u(),w("img",{ref_for:!0,ref:e=>K.value[l]=e,key:a,src:a,style:y(g(me)),class:p(g(V).e("img")),crossorigin:e.crossorigin,onLoad:ge,onError:ye,onMousedown:be},null,46,ce)),[[C,l===Q.value]]))),128))],2),_(e.$slots,"default")],6)])),_:3})],8,["disabled"]))}}),[["__file","image-viewer.vue"]])),ve=P({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:D([String,Object])},previewSrcList:{type:D(Array),default:()=>V([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:D(String)}}),fe={load:e=>e instanceof Event,error:e=>e instanceof Event,switch:e=>q(e),close:()=>!0,show:()=>!0},me=["src","loading","crossorigin"],pe={key:0},ge=a({name:"ElImage",inheritAttrs:!1});const ye=Q(Z(a({...ge,props:ve,emits:fe,setup(a,{emit:l}){const t=a;let o="";const{t:v}=U(),b=G("image"),h=N(),z=te(),I=s(),C=s(!1),S=s(!0),O=s(!1),L=s(),E=s(),R=J&&"loading"in HTMLImageElement.prototype;let B,Y;const $=n((()=>[b.e("inner"),H.value&&b.e("preview"),S.value&&b.is("loading")])),X=n((()=>h.style)),F=n((()=>{const{fit:e}=t;return J&&e?{objectFit:e}:{}})),H=n((()=>{const{previewSrcList:e}=t;return Array.isArray(e)&&e.length>0})),M=n((()=>{const{previewSrcList:e,initialIndex:a}=t;let l=a;return a>e.length-1&&(l=0),l})),P=n((()=>"eager"!==t.loading&&(!R&&"lazy"===t.loading||t.lazy))),D=()=>{J&&(S.value=!0,C.value=!1,I.value=t.src)};function V(e){S.value=!1,C.value=!1,l("load",e)}function q(e){S.value=!1,C.value=!0,l("error",e)}function Z(){oe(L.value,E.value)&&(D(),ae())}const Q=W(Z,200,!0);async function ee(){var a;if(!J)return;await r();const{scrollContainer:l}=t;K(l)?E.value=l:T(l)&&""!==l?E.value=null!=(a=document.querySelector(l))?a:void 0:L.value&&(E.value=ne(L.value)),E.value&&(B=e(E,"scroll",Q),setTimeout((()=>Z()),100))}function ae(){J&&E.value&&Q&&(null==B||B(),E.value=void 0)}function le(e){if(e.ctrlKey)return e.deltaY<0||e.deltaY>0?(e.preventDefault(),!1):void 0}function se(){H.value&&(Y=e("wheel",le,{passive:!1}),o=document.body.style.overflow,document.body.style.overflow="hidden",O.value=!0,l("show"))}function ie(){null==Y||Y(),document.body.style.overflow=o,O.value=!1,l("close")}function re(e){l("switch",e)}return i((()=>t.src),(()=>{P.value?(S.value=!0,C.value=!1,ae(),ee()):D()})),c((()=>{P.value?ee():D()})),(e,a)=>(u(),w("div",{ref_key:"container",ref:L,class:p([g(b).b(),e.$attrs.class]),style:y(g(X))},[C.value?_(e.$slots,"error",{key:0},(()=>[m("div",{class:p(g(b).e("error"))},j(g(v)("el.image.error")),3)])):(u(),w(x,{key:1},[void 0!==I.value?(u(),w("img",A({key:0},g(z),{src:I.value,loading:e.loading,style:g(F),class:g($),crossorigin:e.crossorigin,onClick:se,onLoad:V,onError:q}),null,16,me)):k("v-if",!0),S.value?(u(),w("div",{key:1,class:p(g(b).e("wrapper"))},[_(e.$slots,"placeholder",{},(()=>[m("div",{class:p(g(b).e("placeholder"))},null,2)]))],2)):k("v-if",!0)],64)),g(H)?(u(),w(x,{key:2},[O.value?(u(),d(g(de),{key:0,"z-index":e.zIndex,"initial-index":g(M),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"url-list":e.previewSrcList,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:ie,onSwitch:re},{default:f((()=>[e.$slots.viewer?(u(),w("div",pe,[_(e.$slots,"viewer")])):k("v-if",!0)])),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):k("v-if",!0)],64)):k("v-if",!0)],6))}}),[["__file","image.vue"]]));export{ye as E};
