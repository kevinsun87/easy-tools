import{u as t}from"./main-DJB5iAKQ.js";import{g as e}from"./weatherApi-CW4P18LR.js";import{getLocation as o}from"./baseApi-BUYbzNW3.js";import i from"./indexdb-D6yYQ1E4.js";import{n as a}from"./todo-nv2WtoEp.js";import{d as r}from"./localforage-BVRgvwJc.js";import"./modulepreload-polyfill-Dqv5PPZA.js";import"./index-CyyLRP8W.js";import"./getAudio-D_HGGnT2.js";import"./baseRequest-CU9cTnaC.js";import"./userInfo-CZAB7rZN.js";import"./version-DYnJBHiW.js";const n=t(),s=async(t,s,m=!0)=>{let l=await i.getItem("weather");if(!!t&&!s&&!l.isExp)return l.data||{};let d=t;if(!d||!d.id){let t=null;if(a.get("weather").location.id){let e=new Promise(((t,e)=>{navigator.geolocation.getCurrentPosition((e=>{t(e.coords)}),(e=>{t(e)}),{timeout:2e3})}));const o=await e;o.longitude&&(t=`${o.longitude},${o.latitude}`)}let e=await o({lang:"cn",coords:t});if(1==e.status)return;d=e.data||{}}let u={location:d.id,type:d.type},c=n.value;if(c=(await e(u)).data,"ok"!=c.status)return{now:{},location:{}};let p={adm1:d.adm1,adm2:d.adm2,name:d.name,id:d.id,ip:d.ip,country:d.country,location:d.location,isAuto:!d};return c.location=p,c.moment=(({rise:t,set:e})=>{if(!t||!e)return"d";let o=r().format("YYYY-MM-DD");t=new Date(`${o} ${t}`).getTime(),e=new Date(`${o} ${e}`).getTime();let i=r().valueOf();return i>t&&i<e?"d":"n"})(c.sun||{}),c.updateTime=r().valueOf(),t||i.set("weather-default-city",c,18e5),m&&(i.set("weather",c,6e5),n.value={daily_forecast:c.daily_forecast,location:c.location,now:c.now,moment:c.moment,air_now_city:c.air_now_city}),c};export{s as getWeather};
